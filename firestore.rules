rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    // ============================================================================
    // Transaction Access - Owner Only
    // Simplified after Epic 14c-refactor: Cross-user shared group access removed
    // ============================================================================
    match /artifacts/{appId}/users/{userId}/transactions/{transactionId} {
      // Owner can read and write their own transactions
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }

    // ============================================================================
    // Collection Group Query - Denied
    // Client-side collection group queries disabled for security (2026-01-17)
    // ============================================================================
    match /{path=**}/transactions/{transactionId} {
      allow read: if false;
    }

    // ============================================================================
    // User Data Isolation
    // Each user can only access their own data (all subcollections)
    // ============================================================================
    match /artifacts/{appId}/users/{userId}/{document=**} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }

    // ============================================================================
    // Shared Groups - Disabled until Epic 14d
    // Epic 14c-refactor: All shared group functionality stubbed
    // Will be rebuilt with proper architecture in Epic 14d
    // ============================================================================
    match /sharedGroups/{groupId} {
      allow read, write: if false;
    }

    // ============================================================================
    // Pending Invitations - Disabled until Epic 14d
    // Epic 14c-refactor: All invitation functionality stubbed
    // Will be rebuilt with proper architecture in Epic 14d
    // ============================================================================
    match /pendingInvitations/{invitationId} {
      allow read, write: if false;
    }

    // ============================================================================
    // Default Deny - All other paths
    // ============================================================================
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
