# generated: 2025-12-09
# project: boletapp
# project_key: boletapp
# tracking_system: file-system
# story_location: docs/sprint-artifacts

# STATUS DEFINITIONS:
# ==================
# Epic Status:
#   - backlog: Epic exists in epic file but not contexted
#   - contexted: Next epic tech context created by *epic-tech-context (required)
#
# Story Status:
#   - backlog: Story only exists in epic file
#   - drafted: Story file created in stories folder by *create-story
#   - ready-for-dev: Draft approved and story context created by *story-ready
#   - in-progress: Developer actively working on implementation by *dev-story
#   - review: Implementation complete, ready for review by *code-review
#   - done: Story completed by *story-done
#
# Retrospective Status:
#   - optional: Can be completed but not required
#   - completed: Retrospective has been done by *retrospective
#
# WORKFLOW NOTES:
# ===============
# - Epics should be 'contexted' before stories can be 'drafted'
# - SM typically drafts next story ONLY after previous one is 'done' to incorporate learnings
# - Dev moves story to 'review', dev reviews, then Dev moves to 'done'

generated: 2025-12-09
project: boletapp
project_key: boletapp
tracking_system: file-system
story_location: docs/sprint-artifacts

development_status:
  # Epic 1: Production Deployment Readiness
  epic-1: contexted
  1-1-refactor-to-modular-architecture: done
  1-2-production-build-configuration: done
  1-3-git-repository-setup: done
  1-4-firebase-deployment-infrastructure: done
  1-5-production-deployment-verification: done
  epic-1-retrospective: completed

  # Epic 2: Testing Infrastructure & Documentation
  epic-2: contexted
  2-1-documentation-epic-evolution: done
  2-2-test-environment-setup: done
  2-3-testing-framework-configuration: done
  2-4-authentication-security-tests: done
  2-5-core-workflow-tests: done
  2-6-cicd-pipeline-coverage-baseline: done
  epic-2-retrospective: completed

  # Epic 3: Production-Grade Quality & Testing Completion
  epic-3: contexted
  3-1-process-governance-setup: done
  3-2-e2e-auth-navigation-workflow: done
  3-3-e2e-transaction-management-workflow: done
  3-4-e2e-analytics-export-workflow: done
  3-5-accessibility-testing-framework: done
  3-6-performance-baselines-lighthouse-ci: done
  3-7-coverage-enforcement-quality-gates: done
  epic-3-retrospective: completed

  # Epic 4: Security Hardening & Penetration Testing
  epic-4: contexted
  4-1-secrets-detection-prevention: done
  4-2-gemini-api-protection: done
  4-3-dependency-static-security: done
  4-4-security-documentation: done
  epic-4-retrospective: completed  # Completed 2025-11-29

  # Epic 4.5: Receipt Image Storage (defined in Epic 4 retrospective)
  epic-4-5: contexted  # Tech-spec completed 2025-11-29
  4-5-1-firebase-storage-infrastructure: done  # 3 points - Code Review APPROVED 2025-11-30
  4-5-2-cloud-function-image-processing: done  # 5 points - Code Review APPROVED 2025-11-30
  4-5-3-client-updates-ui: done  # 3 points - Code Review APPROVED 2025-12-01
  4-5-4-cascade-delete-documentation: done  # 2 points - Code Review APPROVED 2025-12-01
  epic-4-5-retrospective: completed  # Completed after 4.5-4

  # Epic 5: Data Download & Export
  # Tech-spec completed 2025-12-02, PRD completed 2025-12-02
  # DEPLOYED TO PRODUCTION: 2025-12-03
  epic-5: contexted
  5-1-csv-export-utilities: done  # Context generated 2025-12-02, Dev completed 2025-12-02, Code Review APPROVED 2025-12-02
  5-2-basic-data-export-settings: done  # Context generated 2025-12-02, Dev completed 2025-12-02, Code Review APPROVED 2025-12-02
  5-3-subscription-tier-check-infrastructure: done  # Context generated 2025-12-02, Dev completed 2025-12-03, Code Review APPROVED 2025-12-03
  5-4-premium-transaction-export: done  # Context generated 2025-12-03, Dev completed 2025-12-03, Code Review APPROVED 2025-12-03
  5-5-premium-statistics-export-upgrade-prompt: done  # Context generated 2025-12-03, Dev completed 2025-12-03, Code Review APPROVED 2025-12-03, Deployed 2025-12-03
  epic-5-retrospective: completed  # Completed 2025-12-03

  # Epic 6: Smart Category Learning
  # Infrastructure pre-requisite: CI/CD Auto-Deploy (from Epic 5 retro)
  # Tech-spec completed 2025-12-03
  epic-6: contexted  # Started 2025-12-03
  6-0-cicd-auto-deploy-firebase: done  # Infrastructure story - Code Review APPROVED 2025-12-03
  6-1-category-mapping-infrastructure: done  # 3 points - Types, Firestore service, security rules - Code Review APPROVED 2025-12-03
  6-2-fuzzy-matching-engine: done  # 3 points - fuse.js integration, matcher logic - Code Review APPROVED 2025-12-03
  6-3-category-learning-prompt: done  # 2 points - UI prompt on category edit - Code Review APPROVED 2025-12-03
  6-4-auto-apply-on-receipt-scan: done  # 3 points - Apply mappings to Gemini results - Code Review APPROVED 2025-12-03
  6-5-mappings-management-ui: done  # 3 points - Settings section for viewing/editing/deleting - Code Review APPROVED 2025-12-03
  6-6-epic-release-deployment: done  # 1 point - Code Review APPROVED 2025-12-04
  epic-6-retrospective: completed  # Completed 2025-12-04

  # Epic 7: Analytics UX Redesign
  # PRD and Architecture documents created 2025-12-05
  # Tech-spec completed 2025-12-05
  # Dual-axis navigation, Quarter/Week views, Chart dual mode, consistent UI
  epic-7: contexted  # Tech-spec generated 2025-12-05
  7-1-analytics-navigation-context: done  # Foundation - AnalyticsContext, useAnalyticsNavigation hook - Code Review APPROVED 2025-12-05
  7-2-temporal-breadcrumb-component: done  # Collapsible temporal breadcrumb (Year/Quarter/Month/Week/Day) - Code Review APPROVED 2025-12-05
  7-3-category-breadcrumb-component: done  # Collapsible category breadcrumb - Code Review APPROVED 2025-12-05
  7-4-chart-mode-toggle-registry: done  # ChartModeToggle, chart registry pattern - Code Review APPROVED 2025-12-07
  7-5-drill-down-cards-grid: done  # DrillDownCard, DrillDownGrid components - Code Review APPROVED 2025-12-07
  7-6-quarter-week-date-utilities: done  # getQuartersInYear(), getWeeksInMonth() utilities - Code Review APPROVED 2025-12-07
  7-7-trendsview-integration: done  # Refactor TrendsView using new components - Code Review APPROVED 2025-12-07
  7-8-bug-fixes-polish: done  # FR1-4 fixes, visual consistency, i18n - Code Review APPROVED 2025-12-07
  7-9-ux-breadcrumb-alignment: done  # UX alignment - breadcrumbs, chart toggle - Code Review APPROVED 2025-12-07
  7-10-ux-cards-visual-alignment: done  # UX alignment - drill-down cards, legend, nav labels - Code Review APPROVED 2025-12-07
  7-11-floating-download-fab: done  # UX enhancement - floating download button - Code Review APPROVED 2025-12-08
  7-12-app-wide-theme-consistency: done  # App-wide theme + color theme selector (Default/Ghibli) - Code Review APPROVED 2025-12-08
  7-13-stacked-bar-chart-comparison: done  # Stacked bars + correct temporal grouping (Q/M/W/D) - Code Review APPROVED 2025-12-08
  7-14-analytics-header-layout-fixes: done  # Code Review APPROVED 2025-12-08 - AC #1 superseded by design decision to keep back arrow
  7-15-seamless-chart-background: done  # Remove card background from chart area for seamless look - Code Review APPROVED 2025-12-08
  7-16-drill-down-section-toggle: done  # Add Temporal/Category toggle for drill-down cards section - Code Review APPROVED 2025-12-08
  7-17-stacked-bar-tooltip-ux: done  # Fix tooltip readability + renamed themes (Ghibli→Normal, Default→Professional) - Completed 2025-12-08
  7-18-drilldown-card-progress-bar: done  # Add thin progress bar below label showing percentage visually - Code Review APPROVED 2025-12-09
  7-99-epic-release-deployment: done  # Deploy, test, document - Code Review APPROVED 2025-12-09, Deployed 2025-12-09
  epic-7-retrospective: completed  # Completed 2025-12-10

  # Epic 8: Scan Testing & Tuning Infrastructure
  # PRD: docs/sprint-artifacts/epic8/prd-epic8-scan-testing.md
  # Purpose: Developer testing infrastructure to evaluate, tune, and improve scan accuracy
  epic-8: contexted  # Tech-spec completed 2025-12-10
  8-1-shared-prompts-library: done  # Shared prompts + image pre-processing optimization - Deployed 2025-12-11, Code Review APPROVED 2025-12-11
  8-2-test-data-schema-structure: done  # Test data JSON schema and directory structure - Code Review APPROVED 2025-12-11
  8-3-test-harness-core-cli: done  # CLI framework for running scan tests - Code Review APPROVED 2025-12-11
  8-4-result-comparison-engine: done  # Compare actual vs expected results - Code Review APPROVED 2025-12-11
  8-5-accuracy-reporting: done  # Generate accuracy metrics and reports - Code Review APPROVED 2025-12-11
  8-6-generate-validate-commands: done  # CLI commands for test data generation/validation - Code Review APPROVED 2025-12-12
  8-7-ab-prompt-comparison-analysis: done  # Compare prompt versions side-by-side - Code Review APPROVED 2025-12-12
  8-8-starter-test-data-documentation: done  # Initial test dataset + documentation - Merged to develop (PR #44) 2025-12-12
  8-9-cicd-pipeline-optimization: done  # Parallelize CI jobs, cache browsers/CLI, optimize Lighthouse - PR #51 MERGED 2025-12-12
  epic-8-retrospective: completed  # Comprehensive retro: CI/CD standards, security lessons, test harness outcomes

  # Future Epics (from Epic 7 retrospective - roadmap revised 2025-12-10, Epic 9 inserted 2025-12-12)
  # See docs/planning/epics.md for full epic definitions

  # Epic 9: Scan Enhancement & Merchant Learning (NEW - inserted after Epic 8)
  # - Integrate v2.6.0 prompt fields into Transaction type and UI
  # - Add merchant name learning (like category learning)
  # PRD: docs/sprint-artifacts/epic9/prd-epic9-scan-enhancement.md
  # Tech-Spec: docs/sprint-artifacts/epic9/tech-spec-epic-9.md
  # Architecture: docs/sprint-artifacts/epic9/architecture-epic9.md
  epic-9: contexted  # Scan Enhancement & Merchant Learning - Stories drafted 2025-12-12
  9-1-transaction-type-extension: done  # 3 points - Add v2.6.0 fields to Transaction type - Code Review APPROVED 2025-12-13
  9-2-transaction-item-category-fields: done  # 2 points - Proper typing for item categories - Code Review APPROVED 2025-12-13
  9-3-edit-view-field-display: done  # 3 points - Display new fields + "Learned" badge - Code Review APPROVED 2025-12-13
  9-4-merchant-mapping-infrastructure: done  # 3 points - Types, service, security rules - Code Review APPROVED 2025-12-13
  9-5-merchant-fuzzy-matching: done  # 3 points - Fuse.js matcher with configurable threshold - Code Review APPROVED 2025-12-13
  9-6-merchant-learning-prompt: done  # 2 points - Dialog on merchant edit - Code Review APPROVED 2025-12-13
  9-7-merchant-mappings-management-ui: done  # 2 points - Settings UI for mappings - Code Review APPROVED 2025-12-13
  9-8-scan-advanced-options: done  # 5 points - Pre-scan options (currency, store type) - Code Review APPROVED 2025-12-13
  9-9-unified-transaction-flow: done  # 5 points - Unified scan+new transaction, cancel button, merchant/alias labels - Code Review APPROVED 2025-12-13
  9-10-persistent-scan-state: done  # 3 points - Persistent scan state across navigation, credit placeholder (900) - Code Review APPROVED 2025-12-13
  9-11-transaction-card-unification: done  # 5 points - Unified card display, duplicate detection, legacy defaults - Code Review APPROVED 2025-12-13
  9-12-ui-content-translation: done  # 2 points - Translate categories/subcategories to user's language - Code Review APPROVED 2025-12-14
  9-13-drilldown-analytics-validation: done  # 3 points - Fix drill-down totals and stop at correct level - Code Review APPROVED 2025-12-14
  9-14-pwa-installation-support: done  # 3 points - PWA support for mobile installation - Code Review APPROVED 2025-12-16
  9-15-subcategory-learning-and-management: done  # 5 points - Subcategory learning, editing, and Settings UI - Code Review APPROVED 2025-12-16
  9-16-learning-prompt-loading-state: done  # 1 point - Bug fix: prevent duplicate transactions from double-clicking - Code Review APPROVED 2025-12-16
  9-17-location-select-alphabetical-cities: done  # 0.5 points - Code Review APPROVED 2025-12-16
  9-18-pwa-push-notifications: done  # 5 points - PWA push notifications with Firebase Cloud Messaging - Code Review APPROVED 2025-12-16
  9-19-history-transaction-filters: done  # 5 points - Temporal, category, and location filters for History view - Code Review APPROVED 2025-12-16
  9-20-analytics-transaction-count-navigation: done  # 3 points - Transaction count badge on analytics cards with navigation to filtered History - Code Review APPROVED 2025-12-16
  9-99-epic-release-deployment: done  # 2 points - Production deployment, E2E verification - Completed 2025-12-16
  epic-9-retrospective: done  # Completed 2025-12-16 - docs/sprint-artifacts/epic-9-retro-2025-12-16.md

  # ============================================================================
  # LAUNCH BACKBONE ROADMAP (Epics 10-16)
  # Updated: 2025-12-16 per Epic 9 retrospective
  # Full definitions: docs/planning/epics.md
  # ============================================================================

  # Epic 10: Foundation + Engagement & Insight Engine (~35 points, 3-4 weeks)
  # Transform from "data entry tool" to "financial awareness companion"
  # Architecture: docs/sprint-artifacts/epic10/architecture-epic10-insight-engine.md
  # Brainstorming: docs/sprint-artifacts/epic10/epic-10-insight-engine-brainstorm.md
  # Key ADRs: ADR-015 (Client-side engine), ADR-016 (Hybrid storage), ADR-017 (Phase-based priority)
  epic-10: contexted  # Architecture complete 2025-12-17, stories drafted and aligned
  10-0-foundation-sprint: done  # 8 points - Refactor analytics, filtering service, App.tsx cleanup - DEPLOYED 2025-12-18
  10-1-insight-engine-service-interface: done  # 3 points - types/insight.ts, services/insightEngineService.ts - DEPLOYED 2025-12-18
  10-2-phase-detection-user-profile: done  # 3 points - calculateUserPhase(), UserInsightProfile Firestore doc - Code Review APPROVED 2025-12-18
  10-3-transaction-intrinsic-insights: done  # 5 points - 7 cold-start insight generators - Code Review APPROVED 2025-12-18
  10-4-pattern-detection-insights: done  # 5 points - 5 history-based generators + precomputed aggregates - Code Review APPROVED 2025-12-18
  10-5-selection-algorithm-sprinkle: done  # 3 points - selectInsight() with phase-based priority - DEPLOYED 2025-12-19 (PR #102)
  10-6-scan-complete-insight-card: done  # 3 points - InsightCard.tsx, BuildingProfileCard.tsx fallback - DEPLOYED 2025-12-19 (PR #102)
  10-7-batch-mode-summary: done  # 3 points - BatchSummary.tsx for multi-receipt sessions - DEPLOYED 2025-12-19 (PR #102)
  10-99-epic-release-deployment: done  # 2 points - Production deployment via PR #102 - DEPLOYED 2025-12-19
  epic-10-retrospective: completed  # Combined retro 2025-12-22

  # Epic 10a: UX Consolidation - Home & Insights Tabs (~13 points, 1 week)
  # Merge Dashboard + History into unified Home, repurpose Receipts tab as Insights History
  # Architecture: docs/sprint-artifacts/epic10a/tech-context-epic10a.md
  # Origin: User feedback session 2025-12-20 - insight history feature request
  epic-10a: contexted  # Tech context complete 2025-12-20
  10a-1-home-screen-consolidation: done  # 5 points - Merge Dashboard + History views - Code Review APPROVED 2025-12-20
  10a-2-this-month-fix: done  # 1 point - This Month card navigation fix - Code Review APPROVED 2025-12-21
  10a-3-nav-tab-rename: done  # 1 point - Receipts → Insights tab - Code Review APPROVED 2025-12-21
  10a-4-insights-history-view: done  # 5 points - New InsightsView component - Code Review APPROVED 2025-12-21 (5 MEDIUM issues fixed)
  10a-5-insight-record-storage: done  # 1 point - Extend InsightRecord schema - Code Review APPROVED 2025-12-21
  epic-10a-retrospective: completed  # Combined retro 2025-12-22

  # Epic 11: Quick Save & Scan Flow Optimization (~22 points, 2 weeks)
  # Reduce scan-to-save friction to <15 seconds for 90% of users
  # Tech Context: docs/sprint-artifacts/epic11/tech-context-epic11.md
  #
  # PARALLEL WORK LANES:
  # ┌─────────────────────────────────────────────────────────────────┐
  # │  Lane A: 11.1 (3pts) ──────────────────────────┐                │
  # │                                                 │                │
  # │  Lane B: 11.5 (3pts) ──────────────────────────┤                │
  # │                                                 ▼                │
  # │                                           11.2 (5pts)           │
  # │                                                 │                │
  # │                              ┌──────────────────┴───────────┐   │
  # │                              ▼                              ▼   │
  # │                         11.3 (3pts)                   11.4 (5pts)│
  # │                              │                              │   │
  # │                              └──────────────┬───────────────┘   │
  # │                                             ▼                   │
  # │                                       11.99 (2pts)              │
  # └─────────────────────────────────────────────────────────────────┘
  #
  epic-11: contexted  # Tech context created 2025-12-21
  11-1-one-image-one-transaction: done  # 3 pts - PARALLEL with 11.5 - Code Review APPROVED 2025-12-21, v9.4.0
  11-2-quick-save-card: done  # 5 pts - Depends on 11.1 + 11.5 - Code Review APPROVED 2025-12-21
  11-3-animated-item-reveal: done  # 3 pts - PARALLEL with 11.4, depends on 11.2 - Code Review APPROVED 2025-12-21
  11-4-trust-merchant-system: done  # 5 pts - PARALLEL with 11.3, depends on 11.2 - Code Review APPROVED 2025-12-22
  11-5-scan-status-clarity: done  # 3 pts - PARALLEL with 11.1 - Code Review APPROVED 2025-12-22, reduced motion fixes
  11-6-responsive-viewport-adaptation: done  # 3 pts - Code Review APPROVED 2025-12-22
  11-99-epic-release-deployment: done  # 2 pts - DEPLOYED 2025-12-22, PRs #119→#120→#121, v9.5.0
  epic-11-retrospective: completed  # Combined retro 2025-12-22

  # Epic 12: Batch Mode (~25 points, 2 weeks)
  # Multi-image capture with parallel processing and batch review
  # Tech Context: docs/sprint-artifacts/epic12/tech-context-epic12.md
  #
  # PARALLEL WORK LANES:
  # ┌─────────────────────────────────────────────────────────────────┐
  # │  Lane A: 12.1 (5pts) ─────┐                                     │
  # │                           │                                     │
  # │  Lane B: 12.4 (3pts) ─────┤                                     │
  # │                           ▼                                     │
  # │                      12.2 (5pts)                                │
  # │                           │                                     │
  # │                           ▼                                     │
  # │                      12.3 (5pts)                                │
  # │                           │                                     │
  # │                           ▼                                     │
  # │                      12.5 (3pts)                                │
  # │                           │                                     │
  # │                           ▼                                     │
  # │                      12.99 (2pts)                               │
  # └─────────────────────────────────────────────────────────────────┘
  #
  epic-12: contexted  # Tech context created 2025-12-22
  12-1-batch-capture-ui: done  # 5 pts - PARALLEL with 12.4 - Camera + preview strip - Code Review APPROVED 2025-12-22, DEPLOYED
  12-2-parallel-processing-service: done  # 5 pts - Depends on 12.1 - Concurrent API calls - Code Review APPROVED 2025-12-22, DEPLOYED
  12-3-batch-review-queue: done  # 5 pts - Depends on 12.2 - Summary cards + edit capability - Code Review APPROVED 2025-12-22, DEPLOYED
  12-4-credit-warning-system: done  # 3 pts - PARALLEL with 12.1 - Pre-batch credit check - Code Review APPROVED 2025-12-22, DEPLOYED
  12-5-batch-save-and-insights: done  # 3 pts - Depends on 12.3 - Save all + aggregate insight - Code Review APPROVED 2025-12-23
  12-99-epic-release-deployment: done  # 2 pts - Production deployment - DEPLOYED 2025-12-23, Atlas Code Review APPROVED 2025-12-23
  epic-12-retrospective: done  # Combined retro 2026-01-15 (Epics 12, 13, 14)

  # ============================================================================
  # REVISED EPIC 13-15 ROADMAP (from Brainstorming Session 2025-12-22)
  # Full Application UX Redesign: "From Reactive to Alive"
  # Brainstorming doc: docs/analysis/brainstorming-session-2025-12-22.md
  # Total scope: ~128 points across 3 epics
  # ============================================================================

  # Epic 13: UX Design & Mockups (~41 points)
  # RESTRUCTURED 2025-12-27: Using design-system-mockup-builder workflow
  # Phase 1: Extract design system reference | Phase 2: Build each screen independently
  # Workflow: _bmad/bmm/workflows/design-system-mockup-builder
  # Personas: María (parent), Diego (young pro), Rosa (abuelita), Tomás (drifter)
  # Tech Context: docs/sprint-artifacts/epic13/tech-context-epic13.md (2025-12-23)
  # UX Spec Update: docs/ux-design-specification.md Section 10 (2025-12-23)
  epic-13: done  # Completed 2025-12-31 - All mockups approved

  # Foundation (Specification Documents) - COMPLETED
  13-1-critical-use-cases-document: done  # 3 pts - E2E scenarios - Atlas Code Review APPROVED 2025-12-23
  13-2-voice-tone-guidelines: done  # 2 pts - Non-judgmental voice - Atlas Code Review APPROVED 2025-12-23
  13-3-motion-design-system-spec: done  # 3 pts - "Everything Breathes" - Atlas Code Review APPROVED 2025-12-23

  # Design System Foundation
  13-4-design-system-html-components: done  # 5 pts - Build design-system-final.html with ALL components - Atlas Code Review APPROVED 2025-12-27
  13-5-extract-design-system-reference: done  # 2 pts - Workflow Phase 1: Atlas Code Review APPROVED 2025-12-27

  # Screen Mockups (Each uses Workflow Phase 2 independently - prevents context overflow)
  # UNBLOCKED by 13.5 completion (2025-12-27) - All ready for parallel development
  13-6-mockup-home-dashboard: done  # 3 pts - Atlas Code Review APPROVED 2025-12-29
  13-7-mockup-analytics-polygon: done  # 5 pts - Includes Dynamic Polygon - Complete 2025-12-30
  13-8-mockup-transaction-list: done  # 3 pts - Transaction items + filters - Complete 2025-12-30
  13-9-mockup-scan-overlay: done  # 3 pts - Camera overlay flow - Complete 2025-12-29
  13-10-mockup-goals-gps: done  # 3 pts - Savings GPS visualization - Complete 2025-12-31
  13-11-mockup-reports: done  # 3 pts - Weekly report cards - Complete 2025-12-31
  13-12-mockup-insights: done  # 3 pts - Insights history view - Complete 2025-12-31
  13-13-mockup-settings: done  # 2 pts - Settings screen - Complete 2025-12-29

  # Review Gate
  13-14-design-review-approval-gate: done  # 1 pt - Design consistency review - APPROVED 2025-12-31
  epic-13-retrospective: done  # Combined retro 2026-01-15 (Epics 12, 13, 14)

  # Epic 14: Core Implementation (~48 points)
  # Implement approved mockups with animation framework
  # Key features: Polygon, Scan flow, Reports, Celebrations
  # UNBLOCKED by Epic 13 completion (2025-12-31) - Ready for development
  # Atlas Feature Mapping: Animation system, Polygon visualization, Celebrations
  # Workflow Chains: Extends Scan Flow (#1), Analytics (#2), Quick Save (#6)
  epic-14: done  # Started 2025-12-31, COMPLETED 2026-01-15 - All stories done

  # Foundation Layer (must be completed first)
  14-1-animation-framework: done  # 5 pts - Core animation utilities - Atlas Code Review APPROVED 2025-12-31
  14-2-screen-transition-system: done  # 3 pts - Staggered entry, breathing - Atlas Code Review APPROVED 2025-12-31

  # Scan Flow Enhancement
  14-3-scan-overlay-flow: done  # 5 pts - Non-blocking overlay [EXTENDS: Quick Save Flow #6] - Atlas Code Review APPROVED 2025-12-31
  14-4-quick-save-path: done  # 3 pts - Progressive item reveal [EXTENDS: Quick Save Flow #6] - Atlas Code Review APPROVED 2026-01-01

  # Analytics & Visualization (can parallelize after 14.1)
  14-5-dynamic-polygon-component: done  # 5 pts - 3-6 sided spending shape [NEW FEATURE: Polygon] - Atlas Code Review APPROVED 2025-12-31
  14-6-polygon-dual-mode: done  # 3 pts - Merchant categories + item groups [DEPENDS: 14.5] - Atlas Code Review APPROVED 2026-01-01
  14-7-expanding-lava-visual: done  # 3 pts - Inverted metaphor [DEPENDS: 14.5] - Atlas Code Review APPROVED 2026-01-01
  14-8-enhanced-existing-charts: done  # 3 pts - Pie, Bar, Stacked improvements [EXTENDS: Analytics #2] - Atlas Code Review APPROVED 2026-01-01
  14-9-swipe-time-navigation: done  # 3 pts - Left/right for week/month [EXTENDS: Analytics #2] - Atlas Code Review APPROVED 2026-01-01

  # ============================================================================
  # PHASE 2: NAVIGATION INFRASTRUCTURE (do NEXT - foundational for all views)
  # ============================================================================
  # These must be done BEFORE view integration - all views depend on navigation
  14-10-top-header-bar: done  # 3 pts - App-wide header (logo, title, menu) [BLOCKS: all view stories] - Atlas Code Review APPROVED 2026-01-02
  14-11-bottom-nav-redesign: done  # 3 pts - Redesign Nav.tsx to match mockups [BLOCKS: all view stories] - Atlas Code Review APPROVED 2026-01-02

  # ============================================================================
  # PHASE 3: VIEW INTEGRATION (wire components into actual views)
  # ============================================================================
  # These make the mockups visible in the app - BLOCKED by 14.10 + 14.11
  14-12-home-dashboard-refresh: deployed  # 5 pts - Update DashboardView with new design [MOCKUP: home-dashboard.html] - DEPLOYED 2026-01-03 (PR #135, #136, #137 UI refinements)
  14-13-analytics-explorer-redesign: done  # 8 pts - Complete TrendsView redesign to "Explora" [MOCKUP: analytics-polygon.html] - COMPLETE 2026-01-11 (21 sessions)
  14-13-2-tendencia-slide-redesign: done  # 8 pts (13→8 reduced scope) - Period comparison for Tendencia slide; Sankey + drill-down deferred - 2026-01-11
  14-13-3-tendencia-sankey-diagram: done  # 8 pts - Sankey flow diagram alternate view (Store Cats → Item Cats) - COMPLETED 2026-01-12
  14-13a-multi-level-filter-support: done  # 5 pts - Track drill-down path, multi-dimension filtering - Atlas Code Review APPROVED 2026-01-09
  14-13b-header-clear-filter-buttons: done  # 3 pts - Clear "✕" button on Compras/Productos titles when filters active, multi-level manual filtering, filter persistence - Atlas Code Review APPROVED 2026-01-10
  14-14-transaction-list-redesign: done  # 3 pts - Update HistoryView with card design [MOCKUP: transaction-list.html] - Completed 2026-01-04
  14-14b-donut-chart-redesign: done  # 13 pts - Donut chart with drill-down navigation [MOCKUP: analytics-polygon.html] - Completed 2026-01-12
  14-15-scan-flow-integration: done  # 3 pts - Wire ScanOverlay + QuickSaveCard into ScanView [MOCKUP: scan-overlay.html] - Completed 2026-01-06
  14-15b-selection-mode-groups: done  # 5 pts - Transaction selection mode & groups [MOCKUP: transaction-list.html states 3-6] - Completed 2026-01-05
  14-15c-category-group-filters: done  # 3 pts - Category group filters in IconFilterBar [EXTENDS: 14.14, 14.21] - Completed 2026-01-05

  # ============================================================================
  # PHASE 4: REPORTS & INSIGHTS
  # ============================================================================
  14-16-weekly-report-story-format: done  # 5 pts - Instagram-style cards [MOCKUP: reports.html] - Completed 2026-01-07, Atlas Code Review APPROVED
  14-16b-semantic-color-system: done  # 5 pts - Apply semantic colors (trends, charts) across app [DEPENDS: 14.21] - Completed 2026-01-12
  14-17-intentional-or-accidental-pattern: done  # 2 pts - Non-judgmental prompts [EXTENDS: Insight Gen #5] - Atlas Code Review APPROVED 2026-01-12

  # ============================================================================
  # PHASE 5: CELEBRATIONS & ENGAGEMENT
  # ============================================================================
  14-18-celebration-system: done  # 3 pts - Confetti, haptics, sounds [NEW FEATURE: Celebrations] - Atlas Code Review APPROVED 2026-01-12
  14-19-personal-records-detection: done  # 3 pts - "Lowest restaurant week!" [EXTENDS: Insight Gen #5] - Atlas Code Review APPROVED 2026-01-12
  14-20-session-completion-messaging: done  # 2 pts - "Great check-in today" [NEW FEATURE: Session UX] - Atlas Code Review APPROVED 2026-01-12

  # Design System Consolidation
  14-21-category-color-consolidation: done  # 5 pts - Unified category colors for all themes/modes [TECH DEBT: Design System] - Completed 2026-01-04

  # Settings Redesign
  14-22-settings-view-redesign: done  # 8 pts - Hierarchical settings with sub-views + Custom Groups placeholder [MOCKUP: settings.html] - COMPLETE 2026-01-12

  # Transaction Editor Improvements
  14-23-unified-transaction-editor: done  # 5 pts - Unified editor for new/existing transactions - Completed 2026-01-06
  14-24-persistent-transaction-state: done  # 8 pts - Single active transaction paradigm, credit reserve pattern, read-only detail view - FEATURE COMPLETE 2026-01-07

  # ============================================================================
  # PHASE 6: FIRESTORE COST OPTIMIZATION (HIGH PRIORITY - $19/week spike)
  # ============================================================================
  # Root cause: Unlimited listeners fetching entire collections
  # Investigation: 2026-01-07 - Found 6+ listeners without limits
  14-25-firestore-listener-limits: done  # 3 pts - Add limit(100) to listeners [HIGH PRIORITY: Cost reduction] - Atlas Code Review APPROVED 2026-01-07
  14-26-firestore-query-optimization: done  # 2 pts - Add limit(1) to single-doc queries, batch deletes - Atlas Code Review APPROVED 2026-01-07
  14-27-transaction-pagination: done  # 5 pts - usePaginatedTransactions hook + HistoryView "Load more" - Atlas Code Review APPROVED 2026-01-07 (45 tests added)
  14-28-app-level-preferences: done  # 2 pts - Migrated to React Query caching - Atlas Code Review APPROVED 2026-01-07
  14-29-react-query-migration: done  # 8 pts - Atlas Code Review APPROVED 2026-01-07

  # ============================================================================
  # PHASE 7: TEST TECHNICAL DEBT (from React Query + UI refactoring)
  # ============================================================================
  # 71 failing tests from: React Query migration (missing QueryClientProvider),
  # UI refactoring (inline styles vs Tailwind classes), prompt library changes
  14-30-test-technical-debt: done  # 3 pts - CI optimization complete, tiered testing (14.43), all tests passing - DEPLOYED 2026-01-14
  14-30-5a-fix-preexisting-test-failures: done  # 2 pts - FIXED: 30 tests fixed (HistoryViewThumbnails filter issue, TopHeader translation keys) - VERIFIED 2026-01-14
  # Story 14.30.8: Fix test-components-misc timeout (LearnMerchantDialog infinite render loop)
  # ROOT CAUSE: Component used `itemNameChanges = []` default parameter which creates new array
  # reference each render, causing useEffect infinite loop. Fixed both component and test.
  # - Component: Use EMPTY_ITEM_CHANGES constant for stable reference
  # - Test: Use fake timers + stable array + fireEvent (not userEvent)
  # Result: components-misc now completes in ~8s instead of timing out at 7+ minutes
  14-30-8-components-misc-timeout: done  # 1 pt - Fix LearnMerchantDialog + useBatchReview infinite loops causing CI timeout - DEPLOYED 2026-01-14
  # Fixes: LearnMerchantDialog (default array param), useBatchReview (useMemo in useEffect deps)
  # Result: heavy-1 tests complete in ~1s instead of timing out
  # Deployed: PR #148 → develop → staging (PR #149) → main (production)
  14-31-items-history-view: done  # 8 pts - Items view similar to History view for item-level browsing - COMPLETED 2026-01-12
  14-32-usage-cost-audit: done  # 3 pts - Audit Firestore subscriptions, Cloud Functions, and database operations for cost leakage - AUDIT COMPLETE: No issues found

  # ============================================================================
  # PHASE 9: SCAN FLOW & LOCATION IMPROVEMENTS
  # ============================================================================
  # Bug fixes and UX improvements identified during 14.31 completion
  14-34-quicksave-currency-formatting: done  # 2 pts - Fix foreign currency display (USD/EUR/GBP) showing wrong decimals - COMPLETED 2026-01-12
  14-35-dynamic-location-data: done  # 5 pts - Fetch countries/cities from API, show localized names - Atlas Code Review APPROVED 2026-01-12
  14-35b-foreign-location-display: done  # 3 pts - Show country flag emoji for foreign transactions (city from different country than user's configured country) - COMPLETED 2026-01-12
  14-36-location-filter-hierarchy: done  # 5 pts - Add Location filter section to IconFilterBar with Country→City hierarchy - COMPLETED 2026-01-12
  14-37-toast-theming-font-scaling: done  # 5 pts - Toast theme integration + font size scaling system - Atlas Code Review PASSED 2026-01-13
  14-38-item-view-toggle: done  # 3 pts - Toggle grouped vs original order view in transaction editor - Atlas Code Review PASSED 2026-01-13
  14-39-dollar-sign-ocr-improvement: cancelled  # 2 pts - CANCELLED: V3 prompt already handles $ recognition correctly (tested 2026-01-13)
  14-40-category-statistics-popup: done  # 5 pts - Statistics popup when tapping category in treemap/donut/trend (min/max/avg/median prices) - Code reviewed 2026-01-13
  14-41-view-mode-edit-button: done  # 2 pts - Lock metadata fields in view mode, add edit button below thumbnail - Code reviewed 2026-01-13
  14-42-version-upgrade-auto-update: done  # 3 pts - Version bump to 1.0.0-beta.1, top banner update prompt with Update/Dismiss buttons - Code Review APPROVED 2026-01-14
  14-43-branch-specific-ci-testing: done  # 4 pts - Branch-specific CI tiers: develop=smoke (~3min), main=full (~5min) - Atlas Code Review PASSED, DEPLOYED 2026-01-14
  14-44-category-statistics-data-fix: done  # 3 pts - Fix category statistics for translated item categories - Atlas Code Review PASSED, DEPLOYED 2026-01-14

  # ============================================================================
  # PHASE 8: INSIGHTS VIEW REDESIGN (~14 points)
  # ============================================================================
  # Implement insights.html mockup - View switcher, carousel, airlock, celebrations
  # Gap identified: Epic 13 mockup exists but no implementation story was created
  # Backend ready: 14.17 (intentional prompts), 14.18 (celebrations), 14.19 (personal records)
  # Mockup: docs/uxui/mockups/01_views/insights.html
  14-33a-insight-card-types-styling: done  # 3 pts - 5 insight types (quirky/celebration/actionable/tradeoff/trend) with distinct styling - Atlas Code Review APPROVED 2026-01-12
  14-33a.1-insight-theme-colors: done  # 2 pts - Theme-aware CSS variables for all 5 insight types across 3 themes (Normal/Professional/Mono) - COMPLETED 2026-01-12
  14-33b-view-switcher-carousel: done  # 5 pts - View switcher (Lista/Destacados/Airlock/Logro) + carousel mode [DEPENDS: 14.33a] - Atlas Code Review APPROVED 2026-01-12 (5 fixes applied)
  14-33c-airlock-sequence: done  # 3 pts - 3-step progressive reveal UI (Curiosity → Brace → Reveal) [DEPENDS: 14.33b] - Atlas Code Review APPROVED 2026-01-12
  14-33c.1-airlock-generation-persistence: done  # 5 pts - Generate airlock with super credit, persist to Firestore, history list [DEPENDS: 14.33c] - Atlas Code Review APPROVED 2026-01-12 (77 tests, 7 issues fixed)
  14-33d-celebration-records-display: done  # 3 pts - Celebration cards + badge unlock display [DEPENDS: 14.33b, 14.18, 14.19] - COMPLETED 2026-01-12 (49 tests)

  epic-14-retrospective: done  # Combined retro 2026-01-15 (Epics 12, 13, 14)

  # ============================================================================
  # EPIC 14C: SHARED GROUPS - FAILED/REVERTED 2026-01-20
  # ============================================================================
  # STATUS: REVERTED to commit 68686f3 - Retrospective complete
  # OUTCOME: Epic failed due to architectural gaps in real-time sync
  # ROOT CAUSES: (1) Delta sync can't detect deletions, (2) State staleness after first op,
  #              (3) Cost explosion from full refetch fallback
  # DECISION: Reset epic, create 14c-refactor first, then retry as 14d
  # Retrospective: docs/sprint-artifacts/epic-14c-retro-2026-01-20.md
  #
  # NEXT STEPS:
  # 1. Epic 14c-refactor: Codebase cleanup (App.tsx, caching, cloud functions)
  # 2. Epic 14d: Shared Groups v2 with lessons learned
  # 3. Brainstorm session required before 14d implementation
  epic-14c: failed  # REVERTED 2026-01-20 - See retrospective for details

  # Phase 1: Foundation (Can Start Without Mockups) - 15 pts
  14c-1-create-shared-group: done  # 8 pts - Data model + security rules + create UI + invite by email - Code review PASSED ✅
  14c-2-accept-decline-invitation: done  # 4 pts - Pending invitations UI + accept/decline flow + notification badge - Code Review PASSED ✅
  14c-3-leave-manage-group: done  # 3 pts - Soft/hard leave + ownership transfer

  # Phase 2: Core UX (After Mockups) - 16 pts
  14c-4-view-mode-switcher: done  # 5 pts - Logo icon tap → group selector → filter all views - Code Review PASSED ✅
  14c-5-shared-group-transactions-view: done  # 8 pts - Infrastructure complete (Tasks 1-10). Cache staleness issues resolved by 14c.12
  14c-6-transaction-ownership-indicators: done  # 3 pts - Profile icon on cards + view-only mode - Atlas Code Review PASSED 2026-01-16

  # Phase 3: Features - 10 pts
  14c-7-tag-transactions-to-groups: done  # 3 pts - Custom group selector in Edit view - 34 tests passing
  14c-8-auto-tag-on-scan: done  # 2 pts - In group view, new scans auto-tagged - Atlas Code Review PASSED 2026-01-16
  14c-9-shared-group-analytics: done  # 5 pts - Polygon, sparkline, insights for group data - Atlas Code Review PASSED 2026-01-17 (46 tests, AC4 chart integrated into TrendsView)

  # Phase 4: Real-Time Sync (2026-01-17 Brainstorming Decision) - 13 pts
  # Decision: Hybrid Approach A+C - memberUpdates listener + VAPID Web Push notifications
  # Decision Doc: docs/sprint-artifacts/epic14c/BRAINSTORM-REALTIME-SYNC-DECISION.md
  # NOTE: 14c.12 RESOLVES cache invalidation issues from 14c.5 - this is the missing piece for cross-user sync
  # NOTE: 14c.13 pivoted from FCM to VAPID Web Push for reliable Android PWA background delivery
  14c-12-realtime-sync-complete-circuit: done  # 5 pts - onSnapshot + memberUpdates + cache invalidation - Atlas Code Review PASSED 2026-01-17 (4631 tests, security rules tightened, +20 new utility tests)
  14c-13-push-notifications: done  # 8 pts - VAPID Web Push for closed-app notifications + in-app notification history [DEPENDS: 14c.12] - 2026-01-18, Atlas Code Review APPROVED

  # Phase 5: Polish - 4 pts
  14c-10-empty-states-loading: done  # 2 pts - Skeleton UI, empty states, loading feedback
  14c-11-error-handling: done  # 2 pts - User not found, network errors, quota exceeded - Atlas Code Review APPROVED 2026-01-19

  # Phase 7: Bug Fixes & Tech Debt - 19 pts
  14c-16-cache-architecture-fix: done  # 5 pts - Fix circular dependency: fetch all transactions once, filter client-side, compute years from full cache [BUG: 2025 transactions not visible] - Atlas Code Review APPROVED 2026-01-19
  14c-17-share-link-deep-linking: done  # 5 pts - Handle /join/{shareCode} URLs, join confirmation dialog, unauthenticated flow [BUG FIX: nanoid URL-safe chars] - 58 tests
  14c-18-view-mode-user-persistence: done  # 5 pts - Persist view mode to Firestore, validate group on restore, fix race condition [BUG: Mode/data mismatch on login] - 38 tests
  14c-14-tech-debt-functions-config-migration: done  # 2 pts - Migrate functions.config() to env vars before March 2026 - DEPLOYED 2026-01-19
  14c-15-notification-tech-debt: done  # 2 pts - Consolidate NotificationClickData interface + VAPID public key to env var [FROM: 14c.13 code review] - Atlas Code Review APPROVED 2026-01-20
  14c-19-view-mode-persistence-bug-fix: done  # 3 pts - Fix group mode not restoring from Firestore [BUG: 14c.18 regression] - Atlas Code Review APPROVED 2026-01-20 - 8 tests
  14c-20-shared-group-cache-optimization: done  # 5 pts - Cache optimization: 1hr staleTime, 24hr gcTime, refetchOnMount/WindowFocus=false, manual sync button with 60s cooldown - 48 tests - Atlas Code Review APPROVED 2026-01-20

  # Phase 8: Final Polish - 10 pts
  14c-21-notification-bulk-actions: backlog  # 2 pts - Mark all read + Dismiss all buttons at bottom of NotificationsView
  14c-22-login-landing-page-redesign: backlog  # 8 pts - UX design phase (3 logo + 3 screen options) + implementation of chosen design

  # Phase 9: Revert & Stabilization - 3 pts
  14c-23-revert-to-stable-baseline: review  # 3 pts - Reverted to commit 68686f3, discarded 14c.20 cache optimization - DEPLOYED 2026-01-20

  # Phase 6: Release - 2 pts
  14c-99-epic-release-deployment: ready-for-dev  # 2 pts - Version bump (minor beta), CI/CD verification, staging/prod deployment

  epic-14c-retrospective: done  # 2026-01-20 - docs/sprint-artifacts/epic-14c-retro-2026-01-20.md

  # ============================================================================
  # EPIC 14c-REFACTOR: CODEBASE CLEANUP BEFORE SHARED GROUPS V2
  # ============================================================================
  # STATUS: NEW - Created from Epic 14c retrospective action items
  # PURPOSE: Clean foundation before Epic 14d (Shared Groups v2)
  # SCOPE: ~54 points across 19 stories
  # PREREQUISITE: Must complete before starting Epic 14d
  #
  # KEY OBJECTIVES:
  # 1. Remove broken shared groups sync implementation (preserve UI shells)
  # 2. Refactor App.tsx (~3800 lines → ~300 lines) - NON-SCAN portions only
  # 3. Simplify transaction caching to React Query only
  # 4. Unify view mode state
  # 5. Audit and optimize Firebase infrastructure
  #
  # PRIOR ART: Epic 14d-old (Scan Architecture Refactor) already completed:
  # - ScanContext, useScanStateMachine, batch processing state
  # - Stories 14c.9-14c.11 PRESERVE this work and only extract non-scan contexts
  # ============================================================================
  epic-14c-refactor: contexted  # Created 2026-01-21, tech context complete 2026-01-21

  # Part 1: Shared Groups Stub & Cleanup (8 stories, 18 pts)
  14c-refactor-1-stub-cloud-functions: done  # 2 pts - Delete getSharedGroupTransactions, sendSharedGroupNotification, undeploy
  14c-refactor-2-stub-services: done  # 3 pts - Replace services with stubs - Atlas Code Review APPROVED 2026-01-21
  14c-refactor-3-stub-hooks: done  # 2 pts - Replace hooks with empty-return stubs, delete useSharedGroupTransactions - Atlas Code Review APPROVED 2026-01-21
  14c-refactor-4-clean-indexeddb-cache: done  # 2 pts - Delete sharedGroupCache.ts, clear legacy IndexedDB - Atlas Code Review APPROVED 2026-01-21
  14c-refactor-5-placeholder-ui-states: done  # 3 pts - Disable UI with "Coming soon" tooltips
  14c-refactor-6-firestore-data-cleanup-script: done  # 3 pts - Manual script to delete sharedGroups/pendingInvitations, empty sharedGroupIds - Atlas Code Review APPROVED 2026-01-21
  14c-refactor-7-security-rules-simplification: done  # 1 pt - Deny all shared group access in firestore.rules - Atlas Code Review APPROVED 2026-01-21
  14c-refactor-8-remove-dead-code: ready-for-dev  # 2 pts - Delete memberUpdateDetection.ts, archive old migration scripts

  # Part 2: App Architecture Refactor (5 stories, 21 pts) - NON-SCAN ONLY
  14c-refactor-9-app-decomposition-contexts: ready-for-dev  # 5 pts - Extract Auth, Navigation, Theme, Notification, AppState contexts (PRESERVE ScanContext)
  14c-refactor-10-app-decomposition-hooks: ready-for-dev  # 5 pts - Extract useAppInitialization, useDeepLinking, usePushNotifications, useOnlineStatus, useAppLifecycle (PRESERVE scan hooks)
  14c-refactor-11-app-decomposition-components: ready-for-dev  # 3 pts - Create AppProviders, AppRoutes, AppLayout, AppErrorBoundary (compose with ScanProvider) - Story created 2026-01-21
  14c-refactor-12-transaction-service-simplification: backlog  # 5 pts - Remove IndexedDB/localStorage caching, React Query only
  14c-refactor-13-view-mode-state-unification: backlog  # 3 pts - Single source of truth for view mode (default to Personal)

  # Part 3: Firebase & Infrastructure (3 stories, 7 pts)
  14c-refactor-14-firebase-indexes-audit: backlog  # 2 pts - Remove sharedGroupIds indexes, document remaining
  14c-refactor-15-cloud-functions-audit: backlog  # 3 pts - Inventory, remove unused, document in cloud-functions.md
  14c-refactor-16-firestore-cost-monitoring: backlog  # 2 pts - Budget alerts + Cloud Monitoring dashboard

  # Part 4: Quality & Validation (3 stories, 8 pts)
  14c-refactor-17-test-suite-cleanup: backlog  # 3 pts - Delete removed file tests, add context/hook tests
  14c-refactor-18-integration-testing: backlog  # 3 pts - Full smoke test checklist
  14c-refactor-19-documentation-update: backlog  # 2 pts - Update architecture docs, archive old shared groups docs

  epic-14c-refactor-retrospective: optional
# | Command | Description |
# |---------|-------------|
# | `/bmad:bmm:workflows:atlas-code-review` | ADVERSARIAL code review with Atlas validation |
# | `/bmad:bmm:workflows:atlas-create-story` | Story creation with workflow chain analysis |
# | `/bmad:bmm:workflows:atlas-retrospective` | Epic retrospective with memory feeding |
# | `/bmad:bmm:workflows:atlas-e2e` | Persona-driven E2E test generation |
# | `/bmad:bmm:workflows:atlas-dev-story` | Story implementation with pattern guidance |
# | `/bmad:bmm:workflows:atlas-sprint-planning` | Sprint planning with Atlas context |
# | `/bmad:bmm:workflows:atlas-sprint-status` | Sprint status check |
# | `/bmad:bmm:workflows:atlas-correct-course` | Course correction during sprints |
# | `/bmad:bmm:workflows:atlas-deploy-story` | Story deployment with validation |
# | `/bmad:bmm:workflows:atlas-epic-tech-context` | Epic technical context preparation |
# | `/bmad:bmm:workflows:atlas-story-context` | Story context loading |
# | `/bmad:bmm:workflows:atlas-story-done` | Story completion marking |
# | `/bmad:bmm:workflows:atlas-story-ready` | Story readiness verification |
  # ============================================================================
  # EPIC 14d: SCAN ARCHITECTURE REFACTOR (~52 points)
  # ============================================================================
  # Refactor 31 scan state variables into unified state machine
  # Enables: Multi-mode scanning (single, batch, statement), clear FAB feedback
  # Planning Document: docs/sprint-artifacts/epic14d/scan-architecture-refactor-plan.md
  # Epic Document: docs/sprint-artifacts/epic14d/epic-14d-scan-architecture-refactor.md
  # Created: 2026-01-08 via Atlas planning session
  epic-14d-scan-architecture-refactor: done  # Started 2026-01-08, COMPLETED 2026-01-12 (11/11 stories)

  # Phase 1: State Machine Foundation (11 pts)
  14d-1-scan-state-machine-hook: done  # 5 pts - useScanStateMachine with useReducer pattern - 74 tests passing (code review complete 2026-01-08)
  14d-2-scan-context-provider: done  # 3 pts - App-wide ScanContext - 23 tests passing, Atlas Code Review APPROVED 2026-01-09
  14d-3-hybrid-navigation-blocking: done  # 3 pts - Custom Nav guard + browser back blocker - 40 tests (18 Nav + 22 NavigationBlocker)

  # Phase 2: Migrate Existing Flows (21 pts → 39 pts after 14d.4 breakdown)
  # Story 14d.4 DIVIDED into 4 sub-stories (2026-01-09) - ~107 setter usages required phased approach
  # See: docs/sprint-artifacts/epic14d/stories/story-14d.4-analysis.md
  14d-4-single-scan-refactor: done  # 8→18 pts - All 5 sub-stories complete + FAB icon fix (Camera for single, Layers for batch) 2026-01-12
  14d-4a-state-bridge-layer: done  # 3 pts - Foundation: useScanStateBridge hook - Atlas Code Review APPROVED 2026-01-09
  14d-4b-consumer-migration: done  # 5 pts - Migrate views/dialogs to use ScanContext - QA VERIFIED 2026-01-09 (fixed race conditions + theme colors)
  14d-4c-state-variable-removal: done  # 5 pts - Remove 8 state variables from App.tsx - Atlas Code Review PASSED 2026-01-10
  14d-4d-pending-scan-migration: done  # 5 pts - Storage migration complete, Atlas Code Review APPROVED 2026-01-10
  14d-4e-pendingscan-cleanup: done  # 3 pts - Full pendingScan removal (~35 usages) + credit exploit prevention - E2E VERIFIED 2026-01-10
  14d-5-batch-scan-refactor: done  # 8→21 pts - All sub-stories complete + race condition fix (batchReceipts atomic with BATCH_COMPLETE) 2026-01-12
  14d-5a-core-state-migration: done  # 5 pts - Phase 0-1 complete: imageUtils.ts extracted, BatchCaptureView uses ScanContext
  14d-5a-phase2-app-migration: done  # 3 pts - isBatchCaptureMode state REMOVED, all setters migrated to context - Atlas Code Review APPROVED 2026-01-11
  14d-5b-processing-integration: done  # 5 pts - Wire useBatchProcessing to dispatch ScanContext actions - Atlas Code Review PASSED 2026-01-11
  14d-5c-review-flow-migration: done  # 5 pts - Migrate batchReviewResults → ScanContext.results - Atlas Code Review PASSED 2026-01-11
  14d-5d-edit-dialog-state: done  # 3 pts - Migrate batchEditingReceipt, confirmation dialogs - Atlas Code Review PASSED 2026-01-11
  14d-5e-persistence-migration: done  # 3 pts - Migrate pendingBatch → ScanContext persistence - Unified batch persistence 2026-01-11
  14d-6-unified-dialog-handling: done  # 5 pts - Consolidate currency/total/quicksave dialogs - COMPLETED 2026-01-11

  # Phase 3: FAB & Mode Selection UX (12 pts)
  14d-7-mode-selector-popup: done  # 5 pts - Long-press FAB popup with 3 options - COMPLETED 2026-01-12
  14d-8-fab-visual-states: done  # 5 pts - Color + icon + shine animation per mode - Atlas Code Review APPROVED 2026-01-12
  14d-9-statement-placeholder-view: done  # 2 pts - "Próximamente" placeholder - Atlas Code Review PASSED 2026-01-12

  # Phase 4: Polish & Extension (8 pts)
  14d-10-state-machine-persistence: done  # 3 pts - OBSOLETE: Superseded by 14d.4d + 14d.5e (no-expiration architecture decision)
  14d-11-app-tsx-cleanup: done  # 2 pts (revised) - Deleted pendingBatchStorage.ts; other variables are component interfaces (see story) - Atlas Code Review PASSED 2026-01-12

  epic-14d-retrospective: done  # Combined retro 2026-01-15 (Epics 12, 13, 14, 14d)

  # Epic 15: Advanced Features (~38 points - revised after mockup verification 2025-12-31)
  # Goals system, learned thresholds, out-of-character detection, treemap, themeable skins
  # Key features: Savings GPS, Emotional Airlock, Treemap, Themeable Skins (Sankey/Sharing REMOVED - not in mockups)
  # BLOCKED by Epic 14 - Requires animation framework and polygon
  # Atlas Feature Mapping: Goals system, Pattern detection, Treemap viz
  # Workflow Chains: Extends Insight Gen (#5), Analytics (#2)
  epic-15: backlog

  # Goals System (new feature area)
  15-1-custom-goals-crud: backlog  # 3 pts - Name, emoji, amount, currency [NEW FEATURE: Goals] [MOCKUP: goals-gps.html]
  15-2-savings-gps-visualization: backlog  # 5 pts - ETA, alternate routes [DEPENDS: 15.1] [MOCKUP: goals-gps.html]
  15-3-hybrid-income-mode: backlog  # 3 pts - Smart + Precision modes [NEW FEATURE: Income tracking]
  15-4-goal-connected-insights: backlog  # 3 pts - "Coffee = 1 day from Tokyo" [EXTENDS: Insight Gen #5]

  # Learned Behavior (extends Insight Engine)
  15-5-learned-budget-thresholds: backlog  # 3 pts - App suggests limits [EXTENDS: Insight Gen #5] [MOCKUP: goals-gps.html budget-limit]
  15-6-threshold-proximity-alerts: backlog  # 2 pts - 75%, 90%, 100% warnings [DEPENDS: 15.5]
  15-7-out-of-character-detection: backlog  # 5 pts - Pattern deviation [EXTENDS: Insight Gen #5]
  15-8-emotional-airlock-flow: backlog  # 3 pts - Curiosity → Playful → Reveal [DEPENDS: 15.7] [MOCKUP: insights.html airlock sequence]

  # Advanced Visualizations
  15-9-treemap-implementation: backlog  # 5 pts - Proportional breakdown [MOCKUP: analytics-polygon.html, home-dashboard.html]
  # REMOVED 15.9-Sankey (CSS defined but not rendered), 15.12-Sharing (not in mockups)

  # Engagement & Personalization
  15-10-monthly-milestone-view: backlog  # 3 pts - Progress celebrations [DEPENDS: 14.12] [MOCKUP: goals-gps.html milestone markers]
  15-11-themeable-skins: backlog  # 3 pts - 3 themes: Professional Blue, Mono, Ni No Kuni [MOCKUP: settings.html PALETA DE COLOR]

  epic-15-retrospective: optional

  # Epic 16: Onboarding & Progressive Disclosure (~15 points)
  # Time-to-value <60 seconds, demo walkthrough, feature unlocking
  # (Formerly Epic 14, renumbered after brainstorming expansion)
  epic-16: backlog
  epic-16-retrospective: optional

  # Epic 17: Tags & Grouping (~18 points)
  # User-defined tags for trip tracking, project expenses
  # (Formerly Epic 15, renumbered after brainstorming expansion)
  epic-17: backlog
  epic-17-retrospective: optional

  # Epic 18: Achievements & Milestones (~12 points)
  # Ethical gamification - celebrate progress without shame
  # (Formerly Epic 16, renumbered after brainstorming expansion)
  epic-18: backlog
  epic-18-retrospective: optional

  # ============================================================================
  # FUTURE BACKLOG (Post-Launch)
  # These epics are deferred until after MVP launch
  # ============================================================================

  # Epic F1: Subscription & Monetization
  # 3-tier model (Free/Pro/Max), Mercado Pago integration
  epic-f1-subscription: future-backlog

  # Epic F2: Household Sharing - MOVED to Epic 14c (see above)
  # epic-f2-household-sharing: moved-to-14c

  # Epic F3: Card Statement Scanning
  # Upload card statement → extract multiple transactions
  epic-f3-card-statement: future-backlog

  # Epic F4: Mobile Native App
  # iOS + Android native apps
  epic-f4-mobile-native: future-backlog

  # Epic F5: Insight Avatars
  # Personality-based insight delivery
  epic-f5-insight-avatars: future-backlog

  # Epic F6: Analytics Dashboard & Scheduled Insights
  # Deferred features from Epic 10 architecture session (2025-12-17)
  # Includes: Weekly/Monthly Summary Views, Scheduled Push Notifications, Reports Section
  # Requires Cloud Functions for scheduling (beyond ADR-015 client-side scope)
  # Archived references: docs/sprint-artifacts/epic10/_archive/
  epic-f6-analytics-dashboard-scheduled-insights: future-backlog
