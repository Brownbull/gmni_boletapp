# generated: 2025-12-09
# project: boletapp
# project_key: boletapp
# tracking_system: file-system
# story_location: docs/sprint-artifacts

# STATUS DEFINITIONS:
# ==================
# Epic Status:
#   - backlog: Epic exists in epic file but not contexted
#   - contexted: Next epic tech context created by *epic-tech-context (required)
#
# Story Status:
#   - backlog: Story only exists in epic file
#   - drafted: Story file created in stories folder by *create-story
#   - ready-for-dev: Draft approved and story context created by *story-ready
#   - in-progress: Developer actively working on implementation by *dev-story
#   - review: Implementation complete, ready for review by *code-review
#   - done: Story completed by *story-done
#
# Retrospective Status:
#   - optional: Can be completed but not required
#   - completed: Retrospective has been done by *retrospective
#
# WORKFLOW NOTES:
# ===============
# - Epics should be 'contexted' before stories can be 'drafted'
# - SM typically drafts next story ONLY after previous one is 'done' to incorporate learnings
# - Dev moves story to 'review', dev reviews, then Dev moves to 'done'

generated: 2025-12-09
project: boletapp
project_key: boletapp
tracking_system: file-system
story_location: docs/sprint-artifacts

development_status:
  epic-1: docs/sprint-artifacts/sprint-status_epics1to13.yaml
  epic-2: docs/sprint-artifacts/sprint-status_epics1to13.yaml
  epic-3: docs/sprint-artifacts/sprint-status_epics1to13.yaml
  epic-4: docs/sprint-artifacts/sprint-status_epics1to13.yaml
  epic-5: docs/sprint-artifacts/sprint-status_epics1to13.yaml
  epic-6: docs/sprint-artifacts/sprint-status_epics1to13.yaml
  epic-7: docs/sprint-artifacts/sprint-status_epics1to13.yaml
  epic-8: docs/sprint-artifacts/sprint-status_epics1to13.yaml
  epic-9: docs/sprint-artifacts/sprint-status_epics1to13.yaml
  epic-10: docs/sprint-artifacts/sprint-status_epics1to13.yaml
  epic-11: docs/sprint-artifacts/sprint-status_epics1to13.yaml
  epic-12: docs/sprint-artifacts/sprint-status_epics1to13.yaml
  epic-13: docs/sprint-artifacts/sprint-status_epics1to13.yaml

  # Epic 14: Core Implementation (~48 points)
  # Implement approved mockups with animation framework
  # Key features: Polygon, Scan flow, Reports, Celebrations
  # UNBLOCKED by Epic 13 completion (2025-12-31) - Ready for development
  # Atlas Feature Mapping: Animation system, Polygon visualization, Celebrations
  # Workflow Chains: Extends Scan Flow (#1), Analytics (#2), Quick Save (#6)
  epic-14: done  # Started 2025-12-31, COMPLETED 2026-01-15 - All stories done

  # Foundation Layer (must be completed first)
  14-1-animation-framework: done  # 5 pts - Core animation utilities - Atlas Code Review APPROVED 2025-12-31
  14-2-screen-transition-system: done  # 3 pts - Staggered entry, breathing - Atlas Code Review APPROVED 2025-12-31

  # Scan Flow Enhancement
  14-3-scan-overlay-flow: done  # 5 pts - Non-blocking overlay [EXTENDS: Quick Save Flow #6] - Atlas Code Review APPROVED 2025-12-31
  14-4-quick-save-path: done  # 3 pts - Progressive item reveal [EXTENDS: Quick Save Flow #6] - Atlas Code Review APPROVED 2026-01-01

  # Analytics & Visualization (can parallelize after 14.1)
  14-5-dynamic-polygon-component: done  # 5 pts - 3-6 sided spending shape [NEW FEATURE: Polygon] - Atlas Code Review APPROVED 2025-12-31
  14-6-polygon-dual-mode: done  # 3 pts - Merchant categories + item groups [DEPENDS: 14.5] - Atlas Code Review APPROVED 2026-01-01
  14-7-expanding-lava-visual: done  # 3 pts - Inverted metaphor [DEPENDS: 14.5] - Atlas Code Review APPROVED 2026-01-01
  14-8-enhanced-existing-charts: done  # 3 pts - Pie, Bar, Stacked improvements [EXTENDS: Analytics #2] - Atlas Code Review APPROVED 2026-01-01
  14-9-swipe-time-navigation: done  # 3 pts - Left/right for week/month [EXTENDS: Analytics #2] - Atlas Code Review APPROVED 2026-01-01

  # ============================================================================
  # PHASE 2: NAVIGATION INFRASTRUCTURE (do NEXT - foundational for all views)
  # ============================================================================
  # These must be done BEFORE view integration - all views depend on navigation
  14-10-top-header-bar: done  # 3 pts - App-wide header (logo, title, menu) [BLOCKS: all view stories] - Atlas Code Review APPROVED 2026-01-02
  14-11-bottom-nav-redesign: done  # 3 pts - Redesign Nav.tsx to match mockups [BLOCKS: all view stories] - Atlas Code Review APPROVED 2026-01-02

  # ============================================================================
  # PHASE 3: VIEW INTEGRATION (wire components into actual views)
  # ============================================================================
  # These make the mockups visible in the app - BLOCKED by 14.10 + 14.11
  14-12-home-dashboard-refresh: done  # 5 pts - Update DashboardView with new design [MOCKUP: home-dashboard.html] - DEPLOYED 2026-01-03 (PR #135, #136, #137 UI refinements)
  14-13-analytics-explorer-redesign: done  # 8 pts - Complete TrendsView redesign to "Explora" [MOCKUP: analytics-polygon.html] - COMPLETE 2026-01-11 (21 sessions)
  14-13-2-tendencia-slide-redesign: done  # 8 pts (13→8 reduced scope) - Period comparison for Tendencia slide; Sankey + drill-down deferred - 2026-01-11
  14-13-3-tendencia-sankey-diagram: done  # 8 pts - Sankey flow diagram alternate view (Store Cats → Item Cats) - COMPLETED 2026-01-12
  14-13a-multi-level-filter-support: done  # 5 pts - Track drill-down path, multi-dimension filtering - Atlas Code Review APPROVED 2026-01-09
  14-13b-header-clear-filter-buttons: done  # 3 pts - Clear "✕" button on Compras/Productos titles when filters active, multi-level manual filtering, filter persistence - Atlas Code Review APPROVED 2026-01-10
  14-14-transaction-list-redesign: done  # 3 pts - Update HistoryView with card design [MOCKUP: transaction-list.html] - Completed 2026-01-04
  14-14b-donut-chart-redesign: done  # 13 pts - Donut chart with drill-down navigation [MOCKUP: analytics-polygon.html] - Completed 2026-01-12
  14-15-scan-flow-integration: done  # 3 pts - Wire ScanOverlay + QuickSaveCard into ScanView [MOCKUP: scan-overlay.html] - Completed 2026-01-06
  14-15b-selection-mode-groups: done  # 5 pts - Transaction selection mode & groups [MOCKUP: transaction-list.html states 3-6] - Completed 2026-01-05
  14-15c-category-group-filters: done  # 3 pts - Category group filters in IconFilterBar [EXTENDS: 14.14, 14.21] - Completed 2026-01-05

  # ============================================================================
  # PHASE 4: REPORTS & INSIGHTS
  # ============================================================================
  14-16-weekly-report-story-format: done  # 5 pts - Instagram-style cards [MOCKUP: reports.html] - Completed 2026-01-07, Atlas Code Review APPROVED
  14-16b-semantic-color-system: done  # 5 pts - Apply semantic colors (trends, charts) across app [DEPENDS: 14.21] - Completed 2026-01-12
  14-17-intentional-or-accidental-pattern: done  # 2 pts - Non-judgmental prompts [EXTENDS: Insight Gen #5] - Atlas Code Review APPROVED 2026-01-12

  # ============================================================================
  # PHASE 5: CELEBRATIONS & ENGAGEMENT
  # ============================================================================
  14-18-celebration-system: done  # 3 pts - Confetti, haptics, sounds [NEW FEATURE: Celebrations] - Atlas Code Review APPROVED 2026-01-12
  14-19-personal-records-detection: done  # 3 pts - "Lowest restaurant week!" [EXTENDS: Insight Gen #5] - Atlas Code Review APPROVED 2026-01-12
  14-20-session-completion-messaging: done  # 2 pts - "Great check-in today" [NEW FEATURE: Session UX] - Atlas Code Review APPROVED 2026-01-12

  # Design System Consolidation
  14-21-category-color-consolidation: done  # 5 pts - Unified category colors for all themes/modes [TECH DEBT: Design System] - Completed 2026-01-04

  # Settings Redesign
  14-22-settings-view-redesign: done  # 8 pts - Hierarchical settings with sub-views + Custom Groups placeholder [MOCKUP: settings.html] - COMPLETE 2026-01-12

  # Transaction Editor Improvements
  14-23-unified-transaction-editor: done  # 5 pts - Unified editor for new/existing transactions - Completed 2026-01-06
  14-24-persistent-transaction-state: done  # 8 pts - Single active transaction paradigm, credit reserve pattern, read-only detail view - FEATURE COMPLETE 2026-01-07

  # ============================================================================
  # PHASE 6: FIRESTORE COST OPTIMIZATION (HIGH PRIORITY - $19/week spike)
  # ============================================================================
  # Root cause: Unlimited listeners fetching entire collections
  # Investigation: 2026-01-07 - Found 6+ listeners without limits
  14-25-firestore-listener-limits: done  # 3 pts - Add limit(100) to listeners [HIGH PRIORITY: Cost reduction] - Atlas Code Review APPROVED 2026-01-07
  14-26-firestore-query-optimization: done  # 2 pts - Add limit(1) to single-doc queries, batch deletes - Atlas Code Review APPROVED 2026-01-07
  14-27-transaction-pagination: done  # 5 pts - usePaginatedTransactions hook + HistoryView "Load more" - Atlas Code Review APPROVED 2026-01-07 (45 tests added)
  14-28-app-level-preferences: done  # 2 pts - Migrated to React Query caching - Atlas Code Review APPROVED 2026-01-07
  14-29-react-query-migration: done  # 8 pts - Atlas Code Review APPROVED 2026-01-07

  # ============================================================================
  # PHASE 7: TEST TECHNICAL DEBT (from React Query + UI refactoring)
  # ============================================================================
  # 71 failing tests from: React Query migration (missing QueryClientProvider),
  # UI refactoring (inline styles vs Tailwind classes), prompt library changes
  14-30-test-technical-debt: done  # 3 pts - CI optimization complete, tiered testing (14.43), all tests passing - DEPLOYED 2026-01-14
  14-30-5a-fix-preexisting-test-failures: done  # 2 pts - FIXED: 30 tests fixed (HistoryViewThumbnails filter issue, TopHeader translation keys) - VERIFIED 2026-01-14
  # Story 14.30.8: Fix test-components-misc timeout (LearnMerchantDialog infinite render loop)
  # ROOT CAUSE: Component used `itemNameChanges = []` default parameter which creates new array
  # reference each render, causing useEffect infinite loop. Fixed both component and test.
  # - Component: Use EMPTY_ITEM_CHANGES constant for stable reference
  # - Test: Use fake timers + stable array + fireEvent (not userEvent)
  # Result: components-misc now completes in ~8s instead of timing out at 7+ minutes
  14-30-8-components-misc-timeout: done  # 1 pt - Fix LearnMerchantDialog + useBatchReview infinite loops causing CI timeout - DEPLOYED 2026-01-14
  # Fixes: LearnMerchantDialog (default array param), useBatchReview (useMemo in useEffect deps)
  # Result: heavy-1 tests complete in ~1s instead of timing out
  # Deployed: PR #148 → develop → staging (PR #149) → main (production)
  14-31-items-history-view: done  # 8 pts - Items view similar to History view for item-level browsing - COMPLETED 2026-01-12
  14-32-usage-cost-audit: done  # 3 pts - Audit Firestore subscriptions, Cloud Functions, and database operations for cost leakage - AUDIT COMPLETE: No issues found

  # ============================================================================
  # PHASE 9: SCAN FLOW & LOCATION IMPROVEMENTS
  # ============================================================================
  # Bug fixes and UX improvements identified during 14.31 completion
  14-34-quicksave-currency-formatting: done  # 2 pts - Fix foreign currency display (USD/EUR/GBP) showing wrong decimals - COMPLETED 2026-01-12
  14-35-dynamic-location-data: done  # 5 pts - Fetch countries/cities from API, show localized names - Atlas Code Review APPROVED 2026-01-12
  14-35b-foreign-location-display: done  # 3 pts - Show country flag emoji for foreign transactions (city from different country than user's configured country) - COMPLETED 2026-01-12
  14-36-location-filter-hierarchy: done  # 5 pts - Add Location filter section to IconFilterBar with Country→City hierarchy - COMPLETED 2026-01-12
  14-37-toast-theming-font-scaling: done  # 5 pts - Toast theme integration + font size scaling system - Atlas Code Review PASSED 2026-01-13
  14-38-item-view-toggle: done  # 3 pts - Toggle grouped vs original order view in transaction editor - Atlas Code Review PASSED 2026-01-13
  14-39-dollar-sign-ocr-improvement: done  # 2 pts - CANCELLED: V3 prompt already handles $ recognition correctly (tested 2026-01-13)
  14-40-category-statistics-popup: done  # 5 pts - Statistics popup when tapping category in treemap/donut/trend (min/max/avg/median prices) - Code reviewed 2026-01-13
  14-41-view-mode-edit-button: done  # 2 pts - Lock metadata fields in view mode, add edit button below thumbnail - Code reviewed 2026-01-13
  14-42-version-upgrade-auto-update: done  # 3 pts - Version bump to 1.0.0-beta.1, top banner update prompt with Update/Dismiss buttons - Code Review APPROVED 2026-01-14
  14-43-branch-specific-ci-testing: done  # 4 pts - Branch-specific CI tiers: develop=smoke (~3min), main=full (~5min) - Atlas Code Review PASSED, DEPLOYED 2026-01-14
  14-44-category-statistics-data-fix: done  # 3 pts - Fix category statistics for translated item categories - Atlas Code Review PASSED, DEPLOYED 2026-01-14

  # ============================================================================
  # PHASE 8: INSIGHTS VIEW REDESIGN (~14 points)
  # ============================================================================
  # Implement insights.html mockup - View switcher, carousel, airlock, celebrations
  # Gap identified: Epic 13 mockup exists but no implementation story was created
  # Backend ready: 14.17 (intentional prompts), 14.18 (celebrations), 14.19 (personal records)
  # Mockup: docs/uxui/mockups/01_views/insights.html
  14-33a-insight-card-types-styling: done  # 3 pts - 5 insight types (quirky/celebration/actionable/tradeoff/trend) with distinct styling - Atlas Code Review APPROVED 2026-01-12
  14-33a.1-insight-theme-colors: done  # 2 pts - Theme-aware CSS variables for all 5 insight types across 3 themes (Normal/Professional/Mono) - COMPLETED 2026-01-12
  14-33b-view-switcher-carousel: done  # 5 pts - View switcher (Lista/Destacados/Airlock/Logro) + carousel mode [DEPENDS: 14.33a] - Atlas Code Review APPROVED 2026-01-12 (5 fixes applied)
  14-33c-airlock-sequence: done  # 3 pts - 3-step progressive reveal UI (Curiosity → Brace → Reveal) [DEPENDS: 14.33b] - Atlas Code Review APPROVED 2026-01-12
  14-33c.1-airlock-generation-persistence: done  # 5 pts - Generate airlock with super credit, persist to Firestore, history list [DEPENDS: 14.33c] - Atlas Code Review APPROVED 2026-01-12 (77 tests, 7 issues fixed)
  14-33d-celebration-records-display: done  # 3 pts - Celebration cards + badge unlock display [DEPENDS: 14.33b, 14.18, 14.19] - COMPLETED 2026-01-12 (49 tests)

  epic-14-retrospective: done  # Combined retro 2026-01-15 (Epics 12, 13, 14)

  # ============================================================================
  # EPIC 14C: SHARED GROUPS - FAILED/REVERTED 2026-01-20
  # ============================================================================
  # STATUS: REVERTED to commit 68686f3 - Retrospective complete
  # OUTCOME: Epic failed due to architectural gaps in real-time sync
  # ROOT CAUSES: (1) Delta sync can't detect deletions, (2) State staleness after first op,
  #              (3) Cost explosion from full refetch fallback
  # DECISION: Reset epic, create 14c-refactor first, then retry as 14d
  # Retrospective: docs/sprint-artifacts/epic-14c-retro-2026-01-20.md
  #
  # NEXT STEPS:
  # 1. Epic 14c-refactor: Codebase cleanup (App.tsx, caching, cloud functions)
  # 2. Epic 14d: Shared Groups v2 with lessons learned
  # 3. Brainstorm session required before 14d implementation
  epic-14c: done  # REVERTED 2026-01-20 - See retrospective for details

  # Phase 1: Foundation (Can Start Without Mockups) - 15 pts
  14c-1-create-shared-group: done  # 8 pts - Data model + security rules + create UI + invite by email - Code review PASSED ✅
  14c-2-accept-decline-invitation: done  # 4 pts - Pending invitations UI + accept/decline flow + notification badge - Code Review PASSED ✅
  14c-3-leave-manage-group: done  # 3 pts - Soft/hard leave + ownership transfer

  # Phase 2: Core UX (After Mockups) - 16 pts
  14c-4-view-mode-switcher: done  # 5 pts - Logo icon tap → group selector → filter all views - Code Review PASSED ✅
  14c-5-shared-group-transactions-view: done  # 8 pts - Infrastructure complete (Tasks 1-10). Cache staleness issues resolved by 14c.12
  14c-6-transaction-ownership-indicators: done  # 3 pts - Profile icon on cards + view-only mode - Atlas Code Review PASSED 2026-01-16

  # Phase 3: Features - 10 pts
  14c-7-tag-transactions-to-groups: done  # 3 pts - Custom group selector in Edit view - 34 tests passing
  14c-8-auto-tag-on-scan: done  # 2 pts - In group view, new scans auto-tagged - Atlas Code Review PASSED 2026-01-16
  14c-9-shared-group-analytics: done  # 5 pts - Polygon, sparkline, insights for group data - Atlas Code Review PASSED 2026-01-17 (46 tests, AC4 chart integrated into TrendsView)

  # Phase 4: Real-Time Sync (2026-01-17 Brainstorming Decision) - 13 pts
  # Decision: Hybrid Approach A+C - memberUpdates listener + VAPID Web Push notifications
  # Decision Doc: docs/sprint-artifacts/epic14c/BRAINSTORM-REALTIME-SYNC-DECISION.md
  # NOTE: 14c.12 RESOLVES cache invalidation issues from 14c.5 - this is the missing piece for cross-user sync
  # NOTE: 14c.13 pivoted from FCM to VAPID Web Push for reliable Android PWA background delivery
  14c-12-realtime-sync-complete-circuit: done  # 5 pts - onSnapshot + memberUpdates + cache invalidation - Atlas Code Review PASSED 2026-01-17 (4631 tests, security rules tightened, +20 new utility tests)
  14c-13-push-notifications: done  # 8 pts - VAPID Web Push for closed-app notifications + in-app notification history [DEPENDS: 14c.12] - 2026-01-18, Atlas Code Review APPROVED

  # Phase 5: Polish - 4 pts
  14c-10-empty-states-loading: done  # 2 pts - Skeleton UI, empty states, loading feedback
  14c-11-error-handling: done  # 2 pts - User not found, network errors, quota exceeded - Atlas Code Review APPROVED 2026-01-19

  # Phase 7: Bug Fixes & Tech Debt - 19 pts
  14c-16-cache-architecture-fix: done  # 5 pts - Fix circular dependency: fetch all transactions once, filter client-side, compute years from full cache [BUG: 2025 transactions not visible] - Atlas Code Review APPROVED 2026-01-19
  14c-17-share-link-deep-linking: done  # 5 pts - Handle /join/{shareCode} URLs, join confirmation dialog, unauthenticated flow [BUG FIX: nanoid URL-safe chars] - 58 tests
  14c-18-view-mode-user-persistence: done  # 5 pts - Persist view mode to Firestore, validate group on restore, fix race condition [BUG: Mode/data mismatch on login] - 38 tests
  14c-14-tech-debt-functions-config-migration: done  # 2 pts - Migrate functions.config() to env vars before March 2026 - DEPLOYED 2026-01-19
  14c-15-notification-tech-debt: done  # 2 pts - Consolidate NotificationClickData interface + VAPID public key to env var [FROM: 14c.13 code review] - Atlas Code Review APPROVED 2026-01-20
  14c-19-view-mode-persistence-bug-fix: done  # 3 pts - Fix group mode not restoring from Firestore [BUG: 14c.18 regression] - Atlas Code Review APPROVED 2026-01-20 - 8 tests
  14c-20-shared-group-cache-optimization: done  # 5 pts - Cache optimization: 1hr staleTime, 24hr gcTime, refetchOnMount/WindowFocus=false, manual sync button with 60s cooldown - 48 tests - Atlas Code Review APPROVED 2026-01-20

  # Phase 8: Final Polish - 10 pts
  14c-21-notification-bulk-actions: backlog  # 2 pts - Mark all read + Dismiss all buttons at bottom of NotificationsView
  14c-22-login-landing-page-redesign: backlog  # 8 pts - UX design phase (3 logo + 3 screen options) + implementation of chosen design

  # Phase 9: Revert & Stabilization - 3 pts
  14c-23-revert-to-stable-baseline: review  # 3 pts - Reverted to commit 68686f3, discarded 14c.20 cache optimization - DEPLOYED 2026-01-20

  # Phase 6: Release - 2 pts
  14c-99-epic-release-deployment: ready-for-dev  # 2 pts - Version bump (minor beta), CI/CD verification, staging/prod deployment

  epic-14c-retrospective: done  # 2026-01-20 - docs/sprint-artifacts/epic-14c-retro-2026-01-20.md

  # ============================================================================
  # EPIC 14c-REFACTOR: CODEBASE CLEANUP BEFORE SHARED GROUPS V2
  # ============================================================================
  # STATUS: NEW - Created from Epic 14c retrospective action items
  # PURPOSE: Clean foundation before Epic 14d (Shared Groups v2)
  # SCOPE: ~54 points across 19 stories
  # PREREQUISITE: Must complete before starting Epic 14d
  #
  # KEY OBJECTIVES:
  # 1. Remove broken shared groups sync implementation (preserve UI shells)
  # 2. Refactor App.tsx (~3800 lines → ~300 lines) - NON-SCAN portions only
  # 3. Simplify transaction caching to React Query only
  # 4. Unify view mode state
  # 5. Audit and optimize Firebase infrastructure
  #
  # PRIOR ART: Epic 14d-old (Scan Architecture Refactor) already completed:
  # - ScanContext, useScanStateMachine, batch processing state
  # - Stories 14c.9-14c.11 PRESERVE this work and only extract non-scan contexts
  # ============================================================================
  epic-14c-refactor: contexted  # Created 2026-01-21, tech context complete 2026-01-21

  # Part 1: Shared Groups Stub & Cleanup (8 stories, 18 pts)
  14c-refactor-1-stub-cloud-functions: done  # 2 pts - Delete getSharedGroupTransactions, sendSharedGroupNotification, undeploy
  14c-refactor-2-stub-services: done  # 3 pts - Replace services with stubs - Atlas Code Review APPROVED 2026-01-21
  14c-refactor-3-stub-hooks: done  # 2 pts - Replace hooks with empty-return stubs, delete useSharedGroupTransactions - Atlas Code Review APPROVED 2026-01-21
  14c-refactor-4-clean-indexeddb-cache: done  # 2 pts - Delete sharedGroupCache.ts, clear legacy IndexedDB - Atlas Code Review APPROVED 2026-01-21
  14c-refactor-5-placeholder-ui-states: done  # 3 pts - Disable UI with "Coming soon" tooltips
  14c-refactor-6-firestore-data-cleanup-script: done  # 3 pts - Manual script to delete sharedGroups/pendingInvitations, empty sharedGroupIds - Atlas Code Review APPROVED 2026-01-21
  14c-refactor-7-security-rules-simplification: done  # 1 pt - Deny all shared group access in firestore.rules - Atlas Code Review APPROVED 2026-01-21
  14c-refactor-8-remove-dead-code: done  # 2 pts - Delete memberUpdateDetection.ts, archive old migration scripts - Atlas Code Review APPROVED 2026-01-21

  # Part 2: App Architecture Refactor (5 stories, 21 pts) - NON-SCAN ONLY
  14c-refactor-9-app-decomposition-contexts: done  # 5 pts - Extract Auth, Navigation, Theme, Notification, AppState contexts (PRESERVE ScanContext) - Atlas Code Review APPROVED 2026-01-21
  14c-refactor-10-app-decomposition-hooks: done  # 5 pts - Extract useAppInitialization, useDeepLinking, usePushNotifications, useOnlineStatus, useAppLifecycle (PRESERVE scan hooks) - Atlas Code Review APPROVED 2026-01-21
  14c-refactor-11-app-decomposition-components: done  # 3 pts - Create AppProviders, AppRoutes, AppLayout, AppErrorBoundary (compose with ScanProvider) - Atlas Code Review APPROVED 2026-01-21 (106 tests, smoke tests pass, line reduction deferred to 14c-refactor.20-22)
  14c-refactor-12-transaction-service-simplification: done  # 5 pts - Verify React Query cache, remove dead query keys - Atlas Code Review APPROVED 2026-01-21
  14c-refactor-13-view-mode-state-unification: done  # 3 pts - Single source of truth for view mode (default to Personal) - Atlas Code Review APPROVED 2026-01-21

  # Part 3: Firebase & Infrastructure (3 stories, 7 pts)
  14c-refactor-14-firebase-indexes-audit: done  # 2 pts - Remove sharedGroupIds indexes, document remaining - Atlas Code Review APPROVED 2026-01-21
  14c-refactor-15-cloud-functions-audit: done  # 3 pts - All 10 functions documented, JSDoc comments, orphan test deleted - Atlas Code Review APPROVED 2026-01-22
  14c-refactor-16-firestore-cost-monitoring: done  # 2 pts - Budget alerts + Cloud Monitoring dashboard - Atlas Code Review APPROVED 2026-01-22

  # Part 4: Quality & Validation (3 stories, 8 pts)
  14c-refactor-17-test-suite-cleanup: done  # 3 pts - Delete removed file tests, add context/hook tests - Atlas Code Review APPROVED 2026-01-22
  14c-refactor-18-integration-testing: done  # 3 pts - Full smoke test checklist - Atlas Code Review APPROVED 2026-01-22
  14c-refactor-19-documentation-update: done  # 2 pts - Update architecture docs, archive old shared groups docs - Completed 2026-01-22

  # Part 5: App.tsx Full Decomposition (3 stories, 11 pts) - Follow-up from 14c-refactor.11
  14c-refactor-20-app-handler-extraction: done  # 3 pts - Hooks created, integrated (20a), tested (20b) - COMPLETE 2026-01-22
  14c-refactor-20a-hook-integration: done  # 3 pts - Integrated useTransactionHandlers (147 lines removed). useScanHandlers deferred to 20b. [DEPENDS: 14c-refactor.20] [FROM: Code Review 2026-01-22]
  14c-refactor-20b-hook-unit-tests: done  # 3 pts - 101 tests created (36+65), all 5646 tests passing [DEPENDS: 14c-refactor.20] [FROM: Code Review 2026-01-22]
  14c-refactor-21-app-navigation-dialog-handlers: done  # 3 pts - Extract navigation + dialog handlers into useNavigationHandlers, useDialogHandlers [DEPENDS: 14c-refactor.20] - Atlas story created 2026-01-21, COMPLETE 2026-01-22
  14c-refactor-22-app-jsx-extraction-final-cleanup: done  # 5 pts - BLOCKED: Original ~200-300 line target unrealistic. Handler hooks require 26+ props each due to state remaining in App.tsx. See stories 22a-22e, 25, 26 for phased approach.
  14c-refactor-22a-interim-cleanup: done  # 1 pt - Tasks 1-2 DONE: useScanHandlers + useDialogHandlers integrated (91 tests). Tasks 3-5 split to stories 22b-22e (2026-01-22 Feature Review).
  14c-refactor-22b-viewrenderers-typescript: done  # 1 pt - Replace 63 `any` types with proper TypeScript interfaces [FROM: 22a Task 3.2] - COMPLETE 2026-01-22
  14c-refactor-22c-renderviewswitch: done  # 2 pts - Created renderViewSwitch + 5 new render functions + integrated insights/alerts views - COMPLETE 2026-01-22
  14c-refactor-22d-appoverlays: done  # 2 pts - Extract 15 overlay components to AppOverlays.tsx - COMPLETE 2026-01-22 [FROM: 22a Task 4]
  14c-refactor-22e-verification: done  # 1 pt - Dead code removal (-197 lines), 5787 tests pass, smoke test PASSED, Atlas Code Review APPROVED 2026-01-22
  14c-refactor-25-view-handlers-context: done  # 2 pts - ViewHandlersContext created, 15 tests, code review APPROVED + fixes applied 2026-01-22 [DEPENDS: 22e]
  14c-refactor-26-view-prop-composition-hooks: done  # 3 pts - 4 composition hooks created, 47 tests, App.tsx integration DEFERRED to story 27 [DEPENDS: 25] - COMPLETE 2026-01-22
  14c-refactor-27-view-context-migration: done  # 3 pts - Migrated 7/9 views to useViewHandlers(), InsightsView/ReportsView DEFERRED (complex patterns), Atlas Code Review 2026-01-23
  14c-refactor-28-app-comment-consolidation: done  # 1 pt - Removed 328 story refs, reduced 3850→3387 lines (-463), 832→343 comments (-489), all tests pass 2026-01-24
  14c-refactor-29-app-prop-composition-integration: done  # 5 pts - Integrated 4 composition hooks, removed deprecated handlers from migrated views. Line count 3,366 (target 1,500-2,000 not met due to hook naming mismatches - documented). Atlas Code Review APPROVED 2026-01-24 [DEPENDS: 26, 27]

  # Part 5.5: View Props Interface Alignment (6 stories, 29 pts) - FROM Story 29 Feature Review
  # ROOT CAUSE: Hooks have naming mismatches with view interfaces, preventing direct spreading
  # APPROACH: Update view interfaces to match hook outputs, expand hooks to cover ALL props
  14c-refactor-30-historyview-props-alignment: done  # SPLIT 2026-01-23: 5 tasks + 24 subtasks exceeded sizing guidelines → split into 30a, 30b, 30c
  14c-refactor-30a-historyview-interface-rename: done  # 2 pts - Rename historyTrans→transactions, hasMoreTransactions→hasMore in HistoryView interface [DEPENDS: 29]
  14c-refactor-30b-hook-expansion: done  # 2 pts - Expand useHistoryViewProps hook to include all missing props [DEPENDS: 30a] - DONE 2026-01-23 (bug fix: hooks before early returns)
  14c-refactor-30c-integration-verification: done  # 2 pts - App.tsx integration with spread + verification [DEPENDS: 30b] - DONE 2026-01-23 (36 lines reduced, code review passed)
  14c-refactor-31-trendsview-props-alignment: done  # SPLIT 2026-01-23: 5 tasks + 17 subtasks exceeded sizing guidelines → split into 31a, 31b, 31c
  14c-refactor-31a-trendsview-interface-rename: done  # 2 pts - Audit + clean TrendsViewProps interface [DEPENDS: 29] - Atlas Code Review APPROVED 2026-01-23
  14c-refactor-31b-trendsview-hook-expansion: done  # 2 pts - Expand useTrendsViewProps to cover all props [DEPENDS: 31a]
  14c-refactor-31c-trendsview-integration-verification: done  # 2 pts - App.tsx integration + verification [DEPENDS: 31b] - DONE 2026-01-23 (34 lines removed, code review passed)
  14c-refactor-32-batchreviewview-props-alignment: done  # SPLIT 2026-01-23: 4 tasks + 15 subtasks at sizing limit → split into 32a, 32b, 32c
  14c-refactor-32a-batchreviewview-interface-rename: done  # 2 pts - Interface props already aligned with hook output - no changes needed - Code Review APPROVED 2026-01-23 [DEPENDS: 29]
  14c-refactor-32b-batchreviewview-hook-expansion: done  # 2 pts - Expand hook to return all required props [DEPENDS: 32a] - Code Review PASSED 2026-01-23
  14c-refactor-32c-batchreviewview-integration-verification: done  # 2 pts - App.tsx integration + tests [DEPENDS: 32b] - Atlas Code Review PASSED 2026-01-23 (43 tests, 0 HIGH issues)
  14c-refactor-33-transactioneditorview-props-alignment: done  # SPLIT 2026-01-23: 4 tasks + 16 subtasks exceeded sizing guidelines → split into 33a, 33b, 33c
  14c-refactor-33a-transactioneditorview-interface-rename: done  # 2 pts - Audit + document props interface [DEPENDS: 29] - Atlas Code Review PASSED 2026-01-23 (5 fixes applied)
  14c-refactor-33b-transactioneditorview-hook-expansion: done  # 2 pts - Expand hook to return all required props [DEPENDS: 33a] - 17 callbacks added, 46 tests pass, Atlas Code Review PASSED 2026-01-23
  14c-refactor-33c-transactioneditorview-integration-verification: done  # 2 pts - App.tsx integration + verification [DEPENDS: 33b] - Atlas Dev PASSED 2026-01-23 (46 hook tests pass, single-spread pattern)
  14c-refactor-34-remaining-view-composition-hooks: done  # SPLIT 2026-01-23: 5 tasks + 31 subtasks exceeded sizing guidelines → split into 34a, 34b, 34c
  14c-refactor-34a-dashboard-composition-hook: done  # 3 pts - Create useDashboardViewProps hook [DEPENDS: 29] - Atlas Code Review PASSED 2026-01-23 (34 tests, 2 MEDIUM acceptable trade-offs)
  14c-refactor-34b-settings-composition-hook: done  # 3 pts - Create useSettingsViewProps hook (most complex - 15+ callbacks) [DEPENDS: 29] - Atlas Code Review PASSED 2026-01-23 (67 tests after fixes, naming + error handling tests added)
  14c-refactor-34c-items-composition-hook: done  # 2 pts - Create useItemsViewProps hook + final verification [DEPENDS: 34a, 34b] - Atlas Code Review PASSED 2026-01-23 (37 tests, 3 doc fixes applied)
  14c-refactor-35-final-app-line-count-target: done  # SPLIT 2026-01-23: 5 tasks + 23 subtasks exceeded sizing guidelines → split into 35a, 35b, 35c, 35d
  14c-refactor-35a-audit-documentation: done  # 1 pt - Audit remaining App.tsx code - Atlas Code Review APPROVED 2026-01-24
  14c-refactor-35b-view-render-functions: done  # 2 pts - Verification: 4/5 views already extracted, BatchCaptureView kept inline (documented) - Atlas Code Review PASSED 2026-01-24
  14c-refactor-35c-handler-hook-extraction: done  # 2 pts - ANALYSIS COMPLETE: No extractions needed (insight<50 lines, credit>10 props, session<50 lines) - Atlas Code Review PASSED 2026-01-24
  14c-refactor-35d-dead-code-verification: done  # 2 pts - Remove dead code (371 lines), document final architecture - Atlas Dev COMPLETE 2026-01-24

  # Part 5.6: Test Fixes (discovered during validation)
  14c-refactor-36-dashboardview-test-fixes: done  # 1 pt - Fix 7 failing DashboardView Full List View tests - Atlas Code Review PASSED 2026-01-24 (6 issues fixed, helper functions added)

  # Part 5: Project Cleanup & Organization (4 stories, 12 pts)
  14c-refactor-23-test-and-config-consolidation: done  # 3 pts - Move 22 vitest.config.ci.* files to tests/config/, move root docs, clean temp files - COMPLETE 2026-01-22
  14c-refactor-24-documentation-consolidation: done  # 3 pts - Consolidate docs/ structure, remove duplicates, archive obsolete, update indexes, add Project Structure to README - Code Review APPROVED 2026-01-22

  epic-14c-refactor-retrospective: optional

  # ============================================================================
  # EPIC 14e: FEATURE-BASED ARCHITECTURE (~73 points)
  # ============================================================================
  # Transform monolithic App.tsx (~3,387 lines) into feature-based architecture
  # Zustand-unified approach: Feature Slicing + Zustand stores (per ADR-018)
  # Target: App.tsx reduced to 500-800 lines
  # Epic Document: docs/sprint-artifacts/epic14e-feature-architecture/epics.md
  # Architecture Decision: docs/sprint-artifacts/epic14e-feature-architecture/architecture-decision.md
  # ADR-018: Zustand-only state management (XState rejected)
  # Created: 2026-01-24 from Epic 14c-refactor analysis
  # Updated: 2026-01-24 - Pre-dev review completed, XState removed per ADR-018
  epic-14e-feature-architecture: contexted  # Tech context complete 2026-01-24

  # Part 0: Cleanup (Pre-requisite, 1 story, 1 pt)
  14e-0-delete-bridge-dead-code: done  # 1 pt - Delete useScanStateBridge.ts (17KB dead code from 14d) - Atlas Code Review APPROVED 2026-01-24

  # Part 1: Foundation & Modal Manager (5 stories, 13 pts)
  14e-1-directory-structure-zustand-setup: done  # 2 pts - Create src/features/, src/managers/, install Zustand - Atlas Code Review PASSED 2026-01-24
  14e-2-modal-manager-zustand-store: done  # 3 pts - Zustand store for modal state management - Atlas Code Review APPROVED 2026-01-24 (29 tests)
  14e-3-modal-manager-component: done  # 2 pts - ModalManager component with registry - Atlas Code Review APPROVED 2026-01-24 (68 tests, stub-only registry)
  14e-4-migrate-simple-modals: done  # 3 pts - Migrate simple modals to ModalManager (SignOut, CreditInfo) - Completed 2026-01-25 (19 tests, 120+ LOC removed)
  14e-5-migrate-complex-modals: done  # 3 pts - Migrate complex modals (conflict, delete, learning) - Atlas Code Review APPROVED 2026-01-25 (7 modals, 217/218 tests)

  # Part 2: Scan Feature Extraction (6 stories, 21 pts → 9 stories, 25 pts after 14e-6 split) - Zustand store, NOT XState
  14e-6-scan-zustand-store-definition: split  # SPLIT 2026-01-24: 5 tasks + 47 subtasks exceeded limits → split into 14e-6a/b/c/d
  14e-6a-scan-zustand-store-foundation: done  # 3 pts - Create store structure + core actions (START/IMAGE/PROCESS) - Atlas Code Review APPROVED 2026-01-25
  14e-6b-scan-zustand-store-complete: done  # 3 pts - Remaining actions (DIALOG/SAVE/BATCH/CONTROL) [DEPENDS: 14e-6a] - Archie Review APPROVED 2026-01-25
  14e-6c-scan-zustand-selectors-exports: done  # 2 pts - 14 selector hooks + module exports [DEPENDS: 14e-6b] - Atlas Code Review APPROVED 2026-01-25
  14e-6d-scan-zustand-tests-verification: done  # 2 pts - Comprehensive tests covering all transitions [DEPENDS: 14e-6c] - Atlas Code Review APPROVED 2026-01-25
  14e-7-scan-store-selectors-hooks: consolidated  # Absorbed into 14e-6c (selectors + exports)
  14e-8-extract-processscan-handler: split  # SPLIT 2026-01-24: 5 tasks + 28 subtasks exceeded limits → split into 14e-8a/b/c
  14e-8a-processscan-audit-utilities: done  # 2 pts - Pre-audit + pure utilities [Part 1/3] - Atlas Code Review APPROVED 2026-01-25 (45 tests, 6 files)
  14e-8b-processscan-subhandlers: done  # 2 pts - Sub-handlers extraction [Part 2/3, DEPENDS: 14e-8a] - Atlas Code Review APPROVED 2026-01-25 (32 tests)
  14e-8c-processscan-handler-integration: done  # 3 pts - Main handler + App.tsx integration [Part 3/3, DEPENDS: 14e-8b] - COMPLETED 2026-01-25 (302 lines extracted, all 5424 tests pass)
  14e-9-scan-feature-components: split  # SPLIT 2026-01-24: 6 tasks + 37 subtasks exceeded limits → split into 14e-9a/b/c
  14e-9a-move-scan-components: done  # 2 pts - Move existing components + update imports [Part 1/3, DEPENDS: 14e-1] - COMPLETED 2026-01-25 (8 components, vitest alias fix, 5447 tests pass)
  14e-9b-zustand-component-update: done  # 3 pts - Update components to use Zustand store [Part 2/3, DEPENDS: 14e-9a, 14e-6c] - Atlas Code Review APPROVED 2026-01-26 (ScanCompleteModal migrated, 113 tests pass)
  14e-9c-state-components-tests: done  # 3 pts - Create state components + tests [Part 3/3, DEPENDS: 14e-9b] - Atlas Code Review APPROVED 2026-01-26 (4 state components, 86 tests)
  14e-10-scan-feature-orchestrator: done  # 3 pts - ScanFeature orchestrator [DEPENDS: 14e-9b, 14e-9c] - Archie Review APPROVED 2026-01-26 (322 lines, 29 tests, minor items→14e-11)
  14e-11-scancontext-migration-cleanup: done  # 2 pts - Delete old ScanContext/useScanStateMachine - Atlas Code Review APPROVED 2026-01-26 (1,578 lines removed, 12+ consumers migrated)

  # Part 3: Batch Review Feature (5 stories, 16 pts → 6 stories, 17 pts after 14e-12 split) - Zustand store, NOT XState
  14e-12-batch-review-zustand-store: split  # SPLIT 2026-01-25: Exceeded sizing limits → split into 14e-12a, 14e-12b
  14e-12a-batch-review-store-foundation: ready-for-dev  # 2 pts - Store structure, types, lifecycle/item actions [DEPENDS: 14e-1]
  14e-12b-batch-review-store-actions-tests: ready-for-dev  # 2 pts - Save/edit actions, phase guards, tests [DEPENDS: 14e-12a]
  14e-13-batch-review-store-selectors: ready-for-dev  # 2 pts - Typed selectors for batch store - Story created 2026-01-25
  14e-14-extract-batch-review-handlers: split  # SPLIT 2026-01-25: Exceeded sizing limits → split into 14e-14a/b/c/d
  14e-14a-batch-handler-types-navigation: ready-for-dev  # 2 pts - Types + navigation handlers [Part 1/4]
  14e-14b-batch-handler-edit-save: ready-for-dev  # 2 pts - Edit + save handlers [Part 2/4, DEPENDS: 14e-14a]
  14e-14c-batch-handler-discard-credit: ready-for-dev  # 2 pts - Discard + credit check handlers [Part 3/4, DEPENDS: 14e-14b]
  14e-14d-batch-handler-integration: ready-for-dev  # 2 pts - App.tsx integration [Part 4/4, DEPENDS: 14e-14c]
  14e-15-batch-review-feature-components: ready-for-dev  # 3 pts - Batch review components - Story created 2026-01-25
  14e-16-batch-review-feature-orchestrator: ready-for-dev  # 5 pts - BatchReviewFeature component - Story created 2026-01-25

# /bmad:bmm:workflows:atlas-dev-story 14e-12a
# /bmad:bmm:workflows:atlas-code-review
# /bmad:bmm:workflows:atlas-create-story
# /bmad:bmm:workflows:atlas-story-sizing
# /bmad:bmm:workflows:atlas-deploy-story

  # Part 4: Simple Features (4 stories, 12 pts)
  14e-17-categories-feature-extraction: ready-for-dev  # 3 pts - Extract categories to feature - Story created 2026-01-25
  14e-18-credit-feature-extraction: split  # SPLIT 2026-01-25: 6 tasks + 36 subtasks exceeded limits → split into 14e-18a/b/c
  14e-18a-credit-state-hook: ready-for-dev  # 2 pts - Feature structure + useCreditState hook [Part 1/3, DEPENDS: 14e-1] - Story created 2026-01-25
  14e-18b-credit-handlers: ready-for-dev  # 2 pts - Credit handlers extraction [Part 2/3, DEPENDS: 14e-18a] - Story created 2026-01-25
  14e-18c-credit-feature-integration: ready-for-dev  # 3 pts - CreditFeature orchestrator + App.tsx integration [Part 3/3, DEPENDS: 14e-18a, 14e-18b] - Story created 2026-01-25
  14e-19-transactions-feature-foundation: ready-for-dev  # 3 pts - Organize transactions as entity module - Story created 2026-01-25
  14e-20-remaining-ui-state-extraction: split  # SPLIT 2026-01-25: 4 tasks + 23 subtasks exceeded limits -> split into 14e-20a/b
  14e-20a-toast-hook-extraction: ready-for-dev  # 2 pts - Extract toast state to shared hook [Part 1/2, DEPENDS: 14e-1] - Story created 2026-01-25
  14e-20b-settings-store-extraction: ready-for-dev  # 2 pts - Extract settings to Zustand store [Part 2/2, DEPENDS: 14e-1] - Story created 2026-01-25

  # Part 5: App Shell Finalization (4 stories, 10 pts)
  14e-21-create-feature-orchestrator: ready-for-dev  # 3 pts - FeatureOrchestrator component - Story created 2026-01-25
  14e-22-appproviders-refactor: ready-for-dev  # 2 pts - Extract providers to AppProviders - Story created 2026-01-25
  14e-23-app-tsx-final-cleanup: ready-for-dev  # 3 pts - Final App.tsx cleanup (500-800 lines target) - Story created 2026-01-25
  14e-24-documentation-architecture-guide: ready-for-dev  # 2 pts - Architecture documentation - Story created 2026-01-25

  epic-14e-retrospective: optional

  # ============================================================================
  # EPIC 14d: SCAN ARCHITECTURE REFACTOR (~52 points)
  # ============================================================================
  # Refactor 31 scan state variables into unified state machine
  # Enables: Multi-mode scanning (single, batch, statement), clear FAB feedback
  # Planning Document: docs/sprint-artifacts/epic14d/scan-architecture-refactor-plan.md
  # Epic Document: docs/sprint-artifacts/epic14d/epic-14d-scan-architecture-refactor.md
  # Created: 2026-01-08 via Atlas planning session
  epic-14d-scan-architecture-refactor: done  # Started 2026-01-08, COMPLETED 2026-01-12 (11/11 stories)

  # Phase 1: State Machine Foundation (11 pts)
  14d-1-scan-state-machine-hook: done  # 5 pts - useScanStateMachine with useReducer pattern - 74 tests passing (code review complete 2026-01-08)
  14d-2-scan-context-provider: done  # 3 pts - App-wide ScanContext - 23 tests passing, Atlas Code Review APPROVED 2026-01-09
  14d-3-hybrid-navigation-blocking: done  # 3 pts - Custom Nav guard + browser back blocker - 40 tests (18 Nav + 22 NavigationBlocker)

  # Phase 2: Migrate Existing Flows (21 pts → 39 pts after 14d.4 breakdown)
  # Story 14d.4 DIVIDED into 4 sub-stories (2026-01-09) - ~107 setter usages required phased approach
  # See: docs/sprint-artifacts/epic14d/stories/story-14d.4-analysis.md
  14d-4-single-scan-refactor: done  # 8→18 pts - All 5 sub-stories complete + FAB icon fix (Camera for single, Layers for batch) 2026-01-12
  14d-4a-state-bridge-layer: done  # 3 pts - Foundation: useScanStateBridge hook - Atlas Code Review APPROVED 2026-01-09
  14d-4b-consumer-migration: done  # 5 pts - Migrate views/dialogs to use ScanContext - QA VERIFIED 2026-01-09 (fixed race conditions + theme colors)
  14d-4c-state-variable-removal: done  # 5 pts - Remove 8 state variables from App.tsx - Atlas Code Review PASSED 2026-01-10
  14d-4d-pending-scan-migration: done  # 5 pts - Storage migration complete, Atlas Code Review APPROVED 2026-01-10
  14d-4e-pendingscan-cleanup: done  # 3 pts - Full pendingScan removal (~35 usages) + credit exploit prevention - E2E VERIFIED 2026-01-10
  14d-5-batch-scan-refactor: done  # 8→21 pts - All sub-stories complete + race condition fix (batchReceipts atomic with BATCH_COMPLETE) 2026-01-12
  14d-5a-core-state-migration: done  # 5 pts - Phase 0-1 complete: imageUtils.ts extracted, BatchCaptureView uses ScanContext
  14d-5a-phase2-app-migration: done  # 3 pts - isBatchCaptureMode state REMOVED, all setters migrated to context - Atlas Code Review APPROVED 2026-01-11
  14d-5b-processing-integration: done  # 5 pts - Wire useBatchProcessing to dispatch ScanContext actions - Atlas Code Review PASSED 2026-01-11
  14d-5c-review-flow-migration: done  # 5 pts - Migrate batchReviewResults → ScanContext.results - Atlas Code Review PASSED 2026-01-11
  14d-5d-edit-dialog-state: done  # 3 pts - Migrate batchEditingReceipt, confirmation dialogs - Atlas Code Review PASSED 2026-01-11
  14d-5e-persistence-migration: done  # 3 pts - Migrate pendingBatch → ScanContext persistence - Unified batch persistence 2026-01-11
  14d-6-unified-dialog-handling: done  # 5 pts - Consolidate currency/total/quicksave dialogs - COMPLETED 2026-01-11

  # Phase 3: FAB & Mode Selection UX (12 pts)
  14d-7-mode-selector-popup: done  # 5 pts - Long-press FAB popup with 3 options - COMPLETED 2026-01-12
  14d-8-fab-visual-states: done  # 5 pts - Color + icon + shine animation per mode - Atlas Code Review APPROVED 2026-01-12
  14d-9-statement-placeholder-view: done  # 2 pts - "Próximamente" placeholder - Atlas Code Review PASSED 2026-01-12

  # Phase 4: Polish & Extension (8 pts)
  14d-10-state-machine-persistence: done  # 3 pts - OBSOLETE: Superseded by 14d.4d + 14d.5e (no-expiration architecture decision)
  14d-11-app-tsx-cleanup: done  # 2 pts (revised) - Deleted pendingBatchStorage.ts; other variables are component interfaces (see story) - Atlas Code Review PASSED 2026-01-12

  epic-14d-retrospective: done  # Combined retro 2026-01-15 (Epics 12, 13, 14, 14d)

  # ============================================================================
  # EPIC 14d-v2: SHARED GROUPS V2 (~138 points across 4 sub-epics)
  # ============================================================================
  # Rebuild shared groups from scratch with lessons learned from Epic 14c
  # Key changes: Single sharedGroupId (not array), changelog-driven sync,
  # double-gate privacy model, manual sync buttons, server-side analytics
  # Epic Document: docs/sprint-artifacts/epic14d-shared-groups-v2/epics.md
  # Architecture: docs/architecture/epic-14d-requirements-and-concerns.md
  # Created: 2026-01-22 from Epic 14c retrospective
  epic-14d-v2-shared-groups: backlog

  # Sub-Epic 1: Data Model & Group Foundation (14 stories, ~47 pts)
  14d-v2-1-1-legacy-cleanup: ready-for-dev  # 3 pts - Remove all Epic 14c code, preserve UI shells - Story created 2026-01-22
  14d-v2-1-2-transaction-type-migration: ready-for-dev  # 3 pts - Add sharedGroupId (single), deletedAt, updatedAt, version, periods
  14d-v2-1-3-changelog-infrastructure: ready-for-dev  # 5 pts - /groups/{groupId}/changelog/{changeId} subcollection - Story created 2026-01-22
  14d-v2-1-4-create-shared-group: ready-for-dev  # 5 pts - Group CRUD with transactionSharingEnabled toggle - Story created 2026-01-22
  14d-v2-1-5-invite-members: ready-for-dev  # 3 pts - Email + share link invitations - Story created 2026-01-22
  14d-v2-1-6-accept-decline-invitation: ready-for-dev  # 3 pts - Join flow with opt-in prompt - Story created 2026-01-22
  14d-v2-1-7-leave-manage-group: ready-for-dev  # 3 pts - Leave, ownership transfer, delete - Story created 2026-01-22
  14d-v2-1-8-cloud-function-changelog-writer: ready-for-dev  # 5 pts - Triggers on transaction changes - Story created 2026-01-22
  14d-v2-1-9-firestore-ttl-offline: ready-for-dev  # 2 pts - 30-day TTL, offline persistence - Story created 2026-01-22
  14d-v2-1-10-view-mode-switcher: ready-for-dev  # 3 pts - Personal/Group toggle - Story created 2026-01-22
  14d-v2-1-11-transaction-sharing-toggle-group: ready-for-dev  # 3 pts - Owner controls group-level sharing - Story created 2026-01-22
  14d-v2-1-12-user-transaction-sharing-preference: ready-for-dev  # 3 pts - Per-user opt-in per group - Atlas story created 2026-01-22
  14d-v2-1-13-user-group-preferences-document: ready-for-dev  # 2 pts - Firestore schema for user per-group preferences - Story created 2026-01-22
  14d-v2-1-14-join-flow-opt-in: ready-for-dev  # 3 pts - Prompt when joining sharing-enabled group - Atlas story created 2026-01-22

  # Sub-Epic 2: Changelog-Driven Sync (12 stories, ~45 pts)
  14d-v2-2-1-tag-transaction-to-group: backlog  # 3 pts - Assign sharedGroupId
  14d-v2-2-2-view-group-transactions: backlog  # 5 pts - Double-gate visibility
  14d-v2-2-3-90-day-changelog-sync: backlog  # 5 pts - Changelog-driven sync
  14d-v2-2-4-sync-button-cooldown: backlog  # 3 pts - 1min×3, then 15min
  14d-v2-2-5-pending-changes-badge: backlog  # 2 pts - Red dot indicator
  14d-v2-2-6-full-2-year-recovery-sync: backlog  # 3 pts - Settings recovery
  14d-v2-2-7-freshness-indicator: backlog  # 2 pts - "Last synced: X ago"
  14d-v2-2-8-offline-banner: backlog  # 2 pts - "Showing cached data"
  14d-v2-2-9-optimistic-updates-writer: backlog  # 3 pts - Instant feedback
  14d-v2-2-10-multi-operation-sync-tests: backlog  # 8 pts - Prevent 14c regression
  14d-v2-2-11-cloud-function-visibility-filtering: backlog  # 5 pts - Double-gate enforcement
  14d-v2-2-12-sharing-disabled-empty-state: backlog  # 2 pts - Clear UX
# | Command | Description |
# |---------|-------------|
# | `/bmad:bmm:workflows:atlas-dev-story` | Story implementation with pattern guidance |
# | `/bmad:bmm:workflows:atlas-story-sizing` |  |
# | `/bmad:bmm:workflows:atlas-code-review` | ADVERSARIAL code review with Atlas validation |
# | `/bmad:bmm:workflows:atlas-create-story` | Story creation with workflow chain analysis |
# | `/bmad:bmm:workflows:atlas-retrospective` | Epic retrospective with memory feeding |
# | `/bmad:bmm:workflows:atlas-e2e` | Persona-driven E2E test generation |
# | `/bmad:bmm:workflows:atlas-sprint-planning` | Sprint planning with Atlas context |
# | `/bmad:bmm:workflows:atlas-sprint-status` | Sprint status check |
# | `/bmad:bmm:workflows:atlas-correct-course` | Course correction during sprints |
# | `/bmad:bmm:workflows:atlas-deploy-story` | Story deployment with validation |
# | `/bmad:bmm:workflows:atlas-epic-tech-context` | Epic technical context preparation |
# | `/bmad:bmm:workflows:atlas-story-context` | Story context loading |
# | `/bmad:bmm:workflows:atlas-story-done` | Story completion marking |
# | `/bmad:bmm:workflows:atlas-story-ready` | Story readiness verification |
  # Sub-Epic 3: Server-Side Analytics (10 stories, ~34 pts)
  14d-v2-3-1-analytics-document-structure: backlog  # 3 pts - /groups/{groupId}/analytics/*
  14d-v2-3-2-immediate-sum-count-updates: backlog  # 3 pts - FieldValue.increment()
  14d-v2-3-3-debounced-breakdown-calculation: backlog  # 3 pts - 30-sec debounce
  14d-v2-3-4-median-calculation-cooldown: backlog  # 3 pts - 30-min cooldown
  14d-v2-3-5-nightly-reconciliation: backlog  # 3 pts - 2 AM recalculation
  14d-v2-3-6-analytics-ui-by-category: backlog  # 5 pts - Category breakdown
  14d-v2-3-7-analytics-ui-by-member: backlog  # 5 pts - Member breakdown
  14d-v2-3-8-period-views: backlog  # 3 pts - Week/month/quarter/year
  14d-v2-3-9-owner-force-recalculate: backlog  # 3 pts - 3×/day, 5min cooldown
  14d-v2-3-10-refresh-countdown-indicator: backlog  # 2 pts - Time to next refresh

  # Sub-Epic 4: Notifications & Engagement (5 stories, ~12 pts)
  14d-v2-4-1-push-notification-infrastructure: backlog  # 3 pts - Transaction change notifications
  14d-v2-4-2-notification-content-formatting: backlog  # 2 pts - Clear messaging
  14d-v2-4-3-badge-trigger-on-notification: backlog  # 2 pts - No auto-sync
  14d-v2-4-4-notification-history-view: backlog  # 3 pts - In-app history
  14d-v2-4-5-notification-settings: backlog  # 2 pts - Per-group toggles

  epic-14d-v2-retrospective: optional

  # Epic 15: Advanced Features (~38 points - revised after mockup verification 2025-12-31)
  # Goals system, learned thresholds, out-of-character detection, treemap, themeable skins
  # Key features: Savings GPS, Emotional Airlock, Treemap, Themeable Skins (Sankey/Sharing REMOVED - not in mockups)
  # BLOCKED by Epic 14 - Requires animation framework and polygon
  # Atlas Feature Mapping: Goals system, Pattern detection, Treemap viz
  # Workflow Chains: Extends Insight Gen (#5), Analytics (#2)
  epic-15: backlog

  # Goals System (new feature area)
  15-1-custom-goals-crud: backlog  # 3 pts - Name, emoji, amount, currency [NEW FEATURE: Goals] [MOCKUP: goals-gps.html]
  15-2-savings-gps-visualization: backlog  # 5 pts - ETA, alternate routes [DEPENDS: 15.1] [MOCKUP: goals-gps.html]
  15-3-hybrid-income-mode: backlog  # 3 pts - Smart + Precision modes [NEW FEATURE: Income tracking]
  15-4-goal-connected-insights: backlog  # 3 pts - "Coffee = 1 day from Tokyo" [EXTENDS: Insight Gen #5]

  # Learned Behavior (extends Insight Engine)
  15-5-learned-budget-thresholds: backlog  # 3 pts - App suggests limits [EXTENDS: Insight Gen #5] [MOCKUP: goals-gps.html budget-limit]
  15-6-threshold-proximity-alerts: backlog  # 2 pts - 75%, 90%, 100% warnings [DEPENDS: 15.5]
  15-7-out-of-character-detection: backlog  # 5 pts - Pattern deviation [EXTENDS: Insight Gen #5]
  15-8-emotional-airlock-flow: backlog  # 3 pts - Curiosity → Playful → Reveal [DEPENDS: 15.7] [MOCKUP: insights.html airlock sequence]

  # Advanced Visualizations
  15-9-treemap-implementation: backlog  # 5 pts - Proportional breakdown [MOCKUP: analytics-polygon.html, home-dashboard.html]
  # REMOVED 15.9-Sankey (CSS defined but not rendered), 15.12-Sharing (not in mockups)

  # Engagement & Personalization
  15-10-monthly-milestone-view: backlog  # 3 pts - Progress celebrations [DEPENDS: 14.12] [MOCKUP: goals-gps.html milestone markers]
  15-11-themeable-skins: backlog  # 3 pts - 3 themes: Professional Blue, Mono, Ni No Kuni [MOCKUP: settings.html PALETA DE COLOR]

  epic-15-retrospective: optional

  # Epic 16: Onboarding & Progressive Disclosure (~15 points)
  # Time-to-value <60 seconds, demo walkthrough, feature unlocking
  # (Formerly Epic 14, renumbered after brainstorming expansion)
  epic-16: backlog
  epic-16-retrospective: optional

  # Epic 17: Tags & Grouping (~18 points)
  # User-defined tags for trip tracking, project expenses
  # (Formerly Epic 15, renumbered after brainstorming expansion)
  epic-17: backlog
  epic-17-retrospective: optional

  # Epic 18: Achievements & Milestones (~12 points)
  # Ethical gamification - celebrate progress without shame
  # (Formerly Epic 16, renumbered after brainstorming expansion)
  epic-18: backlog
  epic-18-retrospective: optional

  # ============================================================================
  # FUTURE BACKLOG (Post-Launch)
  # These epics are deferred until after MVP launch
  # ============================================================================

  # Epic F1: Subscription & Monetization
  # 3-tier model (Free/Pro/Max), Mercado Pago integration
  epic-f1-subscription: future-backlog

  # Epic F2: Household Sharing - MOVED to Epic 14c (see above)
  # epic-f2-household-sharing: moved-to-14c

  # Epic F3: Card Statement Scanning
  # Upload card statement → extract multiple transactions
  epic-f3-card-statement: future-backlog

  # Epic F4: Mobile Native App
  # iOS + Android native apps
  epic-f4-mobile-native: future-backlog

  # Epic F5: Insight Avatars
  # Personality-based insight delivery
  epic-f5-insight-avatars: future-backlog

  # Epic F6: Analytics Dashboard & Scheduled Insights
  # Deferred features from Epic 10 architecture session (2025-12-17)
  # Includes: Weekly/Monthly Summary Views, Scheduled Push Notifications, Reports Section
  # Requires Cloud Functions for scheduling (beyond ADR-015 client-side scope)
  # Archived references: docs/sprint-artifacts/epic10/_archive/
  epic-f6-analytics-dashboard-scheduled-insights: future-backlog
