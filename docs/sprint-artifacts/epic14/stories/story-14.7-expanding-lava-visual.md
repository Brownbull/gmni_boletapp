# Story 14.7: Expanding Lava Visual

**Status:** ready-for-dev
**Points:** 3
**Epic:** 14 - Core Implementation
**Dependencies:** Story 14.5 (Dynamic Polygon Component), Story 14.6 (Polygon Dual Mode)

---

## Story

As a **user tracking my budget**,
I want **to see my spending polygon (lava) expand toward my budget polygon**,
so that **I can visually understand how close I am to my limits**.

## Acceptance Criteria

1. **Inner polygon** represents actual spending (warm colors: red/orange)
2. **Outer polygon** represents budget target (cool colors: green/blue)
3. **Visual tension** increases as spending approaches budget (color intensifies)
4. **Budget proximity indicators** show percentage at each vertex
5. **Over-budget state** - inner polygon exceeds outer with warning styling
6. **Animation on data change** - polygons animate when spending updates

## Tasks / Subtasks

- [ ] Task 1: Create LavaOverlay component (AC: #1, #2)
  - [ ] Create `src/components/polygon/LavaOverlay.tsx`
  - [ ] Render two nested polygons in SVG
  - [ ] Inner polygon = spending data
  - [ ] Outer polygon = budget data

- [ ] Task 2: Implement color system (AC: #1, #2)
  - [ ] Define LAVA_COLORS constants
  - [ ] Warm colors for spending (gradient red ‚Üí orange)
  - [ ] Cool colors for budget (gradient green ‚Üí blue)
  - [ ] Support dark mode variants

- [ ] Task 3: Add visual tension effect (AC: #3)
  - [ ] Calculate spending/budget ratio per vertex
  - [ ] Intensify spending color as ratio increases
  - [ ] Add glow effect when ratio > 80%

- [ ] Task 4: Implement proximity indicators (AC: #4)
  - [ ] Show percentage at each vertex (e.g., "75%")
  - [ ] Position indicators between polygons
  - [ ] Color code by threshold (green < 75%, yellow 75-90%, red > 90%)

- [ ] Task 5: Handle over-budget state (AC: #5)
  - [ ] Inner polygon exceeds outer visually
  - [ ] Solid red color for over-budget vertices
  - [ ] Pulsing warning animation
  - [ ] Clear visual indicator

- [ ] Task 6: Add data change animation (AC: #6)
  - [ ] Animate polygon expansion on spending update
  - [ ] Smooth transition between states
  - [ ] Use spring easing for natural feel

- [ ] Task 7: Write tests
  - [ ] Test polygon layering
  - [ ] Test proximity calculations
  - [ ] Test over-budget state
  - [ ] Test animations

## Dev Notes

### Color System

**From tech-context-epic14.md:**
```typescript
const LAVA_COLORS = {
  SPENDING: 'rgba(239, 68, 68, 0.7)',   // red-500 with opacity
  BUDGET: 'rgba(34, 197, 94, 0.3)',     // green-500 with opacity
  DANGER: 'rgba(239, 68, 68, 1)',       // solid red when over budget
  WARNING: 'rgba(245, 158, 11, 0.8)',   // amber-500 for approaching limit
};
```

### Visual Concept

```
       Budget (outer, green)
          /\
         /  \
        / ** \    ** = Spending (inner, red)
       /  **  \       Growing toward budget
      /   **   \
     /____**____\
```

### Proximity Calculation

```typescript
interface VertexProximity {
  category: string;
  spending: number;
  budget: number;
  ratio: number;  // 0-1+ (can exceed 1 if over budget)
  status: 'safe' | 'warning' | 'danger' | 'over';
}

function calculateProximity(spending: number, budget: number): VertexProximity['status'] {
  const ratio = spending / budget;
  if (ratio > 1) return 'over';
  if (ratio > 0.9) return 'danger';
  if (ratio > 0.75) return 'warning';
  return 'safe';
}
```

### SVG Layering

```svg
<svg>
  <!-- Outer budget polygon (background) -->
  <polygon class="budget-polygon" points="..." fill="var(--budget-fill)" />

  <!-- Inner spending polygon (foreground) -->
  <polygon class="spending-polygon" points="..." fill="var(--spending-fill)" />

  <!-- Proximity indicators at vertices -->
  <g class="proximity-indicators">
    <!-- Labels positioned between polygons -->
  </g>
</svg>
```

### References

- [Source: docs/sprint-artifacts/epic14/tech-context-epic14.md#Story 14.7]
- [Source: docs/uxui/mockups/01_views/home-dashboard.html]
- [Source: docs/uxui/motion-design-system.md#Breathing Effect Specification]

---

## Atlas Workflow Analysis

> üó∫Ô∏è This section was generated by Atlas workflow chain analysis

### Affected Workflows

- **Analytics Navigation Flow (#2)**: Lava visual is primary analytics entry point
- No direct workflow dependencies - this is a visualization enhancement

### Downstream Effects to Consider

- Budget data needs to be available (may need Story 15.1 for custom goals)
- For MVP, can use learned budget thresholds or default percentages
- Over-budget state may trigger insights (connects to Insight Generation)

### Testing Implications

- **Existing tests to verify:** DynamicPolygon tests from 14.5
- **New scenarios to add:** Dual polygon rendering, proximity calculations, over-budget state

### Workflow Chain Visualization

```
[14.5 Polygon] ‚Üí [14.6 Dual Mode] ‚Üí [THIS STORY: Lava Visual] ‚Üí [Analytics UX Complete]
```

---

## Dev Agent Record

### Agent Model Used

_To be filled by dev agent_

### Completion Notes List

_To be filled during implementation_

### File List

_To be filled during implementation_
