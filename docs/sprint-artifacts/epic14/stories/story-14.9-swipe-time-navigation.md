# Story 14.9: Swipe Time Navigation

**Status:** ready-for-dev
**Points:** 3
**Epic:** 14 - Core Implementation
**Dependencies:** Story 14.1 (Animation Framework)

---

## Story

As a **user browsing analytics or history**,
I want **to swipe left/right to navigate between time periods**,
so that **I can quickly browse through weeks or months of data**.

## Acceptance Criteria

1. **Swipe gesture detection** with configurable threshold (50px minimum travel)
2. **Time period change** - swipe left advances forward, swipe right goes back
3. **Visual feedback** during swipe showing direction and next period preview
4. **Integration with Analytics and History views** via HistoryFiltersContext
5. **Haptic feedback** on successful swipe navigation
6. **Conflict prevention** with vertical scroll

## Tasks / Subtasks

- [ ] Task 1: Create useSwipeNavigation hook (AC: #1)
  - [ ] Create `src/hooks/useSwipeNavigation.ts`
  - [ ] Track touch start/move/end events
  - [ ] Calculate swipe distance and direction
  - [ ] Configurable threshold (default 50px)

- [ ] Task 2: Implement time period change (AC: #2)
  - [ ] Swipe left ‚Üí next period (forward in time)
  - [ ] Swipe right ‚Üí previous period (back in time)
  - [ ] Call onSwipeLeft/onSwipeRight callbacks

- [ ] Task 3: Add visual feedback (AC: #3)
  - [ ] Show swipe direction indicator during gesture
  - [ ] Preview of next/previous period label
  - [ ] Elastic effect at boundaries (can't go beyond data range)

- [ ] Task 4: Integrate with HistoryFiltersContext (AC: #4)
  - [ ] Connect to goNextPeriod/goPrevPeriod actions
  - [ ] Respect current temporal level (week/month/etc.)
  - [ ] Update Analytics and History views

- [ ] Task 5: Add haptic feedback (AC: #5)
  - [ ] Use navigator.vibrate API
  - [ ] Brief vibration on successful navigation
  - [ ] Respect user haptic preferences

- [ ] Task 6: Prevent scroll conflicts (AC: #6)
  - [ ] Detect horizontal vs vertical intent
  - [ ] Lock direction after threshold
  - [ ] Don't interfere with normal scrolling

- [ ] Task 7: Write tests
  - [ ] Test swipe detection
  - [ ] Test threshold behavior
  - [ ] Test scroll conflict prevention

## Dev Notes

### Hook Interface

```typescript
interface SwipeNavigationOptions {
  onSwipeLeft?: () => void;
  onSwipeRight?: () => void;
  threshold?: number;  // default 50px
  enabled?: boolean;
}

interface SwipeNavigationResult {
  onTouchStart: (e: TouchEvent) => void;
  onTouchMove: (e: TouchEvent) => void;
  onTouchEnd: (e: TouchEvent) => void;
  isSwiping: boolean;
  swipeDirection: 'left' | 'right' | null;
  swipeProgress: number;  // 0-1
}
```

### Implementation Pattern

```typescript
export function useSwipeNavigation(options: SwipeNavigationOptions): SwipeNavigationResult {
  const { onSwipeLeft, onSwipeRight, threshold = 50, enabled = true } = options;
  const startX = useRef<number | null>(null);
  const startY = useRef<number | null>(null);
  const [isSwiping, setIsSwiping] = useState(false);

  const onTouchStart = (e: TouchEvent) => {
    if (!enabled) return;
    startX.current = e.touches[0].clientX;
    startY.current = e.touches[0].clientY;
  };

  const onTouchMove = (e: TouchEvent) => {
    if (!startX.current || !startY.current) return;

    const diffX = e.touches[0].clientX - startX.current;
    const diffY = e.touches[0].clientY - startY.current;

    // If vertical movement is greater, it's a scroll - abort
    if (Math.abs(diffY) > Math.abs(diffX)) {
      startX.current = null;
      return;
    }

    if (Math.abs(diffX) > 10) {
      setIsSwiping(true);
      e.preventDefault(); // Prevent scroll
    }
  };

  const onTouchEnd = (e: TouchEvent) => {
    if (!startX.current) return;

    const diffX = e.changedTouches[0].clientX - startX.current;

    if (Math.abs(diffX) >= threshold) {
      if (diffX < 0) onSwipeLeft?.();
      else onSwipeRight?.();

      // Haptic feedback
      if (navigator.vibrate) navigator.vibrate(10);
    }

    startX.current = null;
    setIsSwiping(false);
  };

  return { onTouchStart, onTouchMove, onTouchEnd, isSwiping, ... };
}
```

### Integration with History Filters

```typescript
// In Analytics or History view
const { goNextPeriod, goPrevPeriod } = useHistoryFilters();

const swipeHandlers = useSwipeNavigation({
  onSwipeLeft: goNextPeriod,
  onSwipeRight: goPrevPeriod,
});

return (
  <div {...swipeHandlers}>
    {/* View content */}
  </div>
);
```

### References

- [Source: docs/sprint-artifacts/epic14/tech-context-epic14.md#Story 14.9]
- [Source: src/contexts/HistoryFiltersContext.tsx - Time navigation]
- [Source: docs/uxui/motion-design-system.md#Screen Transitions]

---

## Atlas Workflow Analysis

> üó∫Ô∏è This section was generated by Atlas workflow chain analysis

### Affected Workflows

- **Analytics Navigation Flow (#2)**: New swipe navigation method
- **History Filter Flow (#4)**: Alternative to button-based time navigation

### Downstream Effects to Consider

- Must not break existing button-based navigation
- Story 14.10 (Reports) will reuse this hook for card swiping
- Consider edge cases at data boundaries (no more data to show)

### Testing Implications

- **Existing tests to verify:** HistoryFiltersContext tests
- **New scenarios to add:** Swipe detection, threshold behavior, scroll conflicts

### Workflow Chain Visualization

```
[14.1 Animation Framework] ‚Üí [THIS STORY: Swipe Navigation] ‚Üí [Analytics + History Views] ‚Üí [14.10 Reports]
```

---

## Dev Agent Record

### Agent Model Used

_To be filled by dev agent_

### Completion Notes List

_To be filled during implementation_

### File List

_To be filled during implementation_
