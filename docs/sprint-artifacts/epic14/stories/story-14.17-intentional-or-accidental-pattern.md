# Story 14.17: "Intentional or Accidental?" Pattern

**Status:** ready-for-dev
**Points:** 2
**Epic:** 14 - Core Implementation
**Dependencies:** Story 14.1 (Animation Framework)

---

## Story

As a **user who made an unusual purchase**,
I want **a non-judgmental prompt asking if it was intentional**,
so that **I can reflect on my spending without feeling guilty**.

## Acceptance Criteria

1. **IntentionalPrompt dialog** component with two-button response
2. **Non-judgmental language** - "Fue intencional" / "No me hab√≠a dado cuenta"
3. **Response storage** in transaction metadata or separate collection
4. **Pattern detection trigger** - shows for unusual spending patterns
5. **Dismissible** - user can close without responding
6. **Entry animation** - dialog slides up smoothly

## Tasks / Subtasks

- [ ] Task 1: Create IntentionalPrompt component (AC: #1, #6)
  - [ ] Create `src/components/insights/IntentionalPrompt.tsx`
  - [ ] Modal dialog with backdrop
  - [ ] Slide-up entry animation
  - [ ] Two primary buttons

- [ ] Task 2: Implement non-judgmental copy (AC: #2)
  - [ ] Title: "¬øFue intencional?" or context-specific
  - [ ] Button 1: "S√≠, fue intencional" (Yes, it was intentional)
  - [ ] Button 2: "No me hab√≠a dado cuenta" (I hadn't realized)
  - [ ] Optional context message about the pattern

- [ ] Task 3: Implement response storage (AC: #3)
  - [ ] Add 'intentional' field to transaction or insight
  - [ ] Store response with timestamp
  - [ ] Allow null for dismissed prompts

- [ ] Task 4: Integrate with pattern detection (AC: #4)
  - [ ] Listen for pattern-detected insights from InsightEngine
  - [ ] Trigger prompt for category_trend, spending_velocity insights
  - [ ] Don't show for every insight - only unusual patterns

- [ ] Task 5: Add dismissible behavior (AC: #5)
  - [ ] Backdrop click dismisses
  - [ ] X button in corner
  - [ ] No response stored on dismiss
  - [ ] Cooldown before showing again

- [ ] Task 6: Write tests
  - [ ] Test dialog rendering
  - [ ] Test response storage
  - [ ] Test dismiss behavior

## Dev Notes

### Non-Judgmental Voice

**From voice-tone-guidelines.md - Principle #1: Observes without judging:**

| Judgmental | Non-Judgmental |
|------------|----------------|
| "You overspent on restaurants" | "Restaurants up 23%" |
| "You should save more" | "This is different for you" |
| "Bad spending habit" | "¬øFue intencional?" |

### Component Interface

```typescript
interface IntentionalPromptProps {
  insight: InsightRecord;
  context: string;  // e.g., "Restaurantes subi√≥ 45% esta semana"
  onResponse: (intentional: boolean) => void;
  onDismiss: () => void;
}
```

### Trigger Conditions

Show IntentionalPrompt when:
1. `category_trend` insight shows >30% increase
2. `spending_velocity` insight shows unusual spike
3. `out_of_character` detection (future Epic 15)

```typescript
function shouldShowIntentionalPrompt(insight: InsightRecord): boolean {
  const triggerTypes = ['category_trend', 'spending_velocity'];
  if (!triggerTypes.includes(insight.type)) return false;

  // Only for increases, not decreases
  if (insight.metadata?.direction !== 'up') return false;

  // Only for significant changes (>30%)
  if ((insight.metadata?.percentChange || 0) < 30) return false;

  return true;
}
```

### Response Storage

```typescript
interface IntentionalResponse {
  insightId: string;
  transactionId?: string;
  response: 'intentional' | 'unintentional' | null;
  timestamp: Date;
}

// Store in user's insight profile
await saveIntentionalResponse(userId, response);
```

### Animation

```css
.intentional-prompt {
  animation: slideUp 300ms ease-out;
}

@keyframes slideUp {
  from {
    transform: translateY(100%);
    opacity: 0;
  }
  to {
    transform: translateY(0);
    opacity: 1;
  }
}
```

### References

- [Source: docs/sprint-artifacts/epic14/tech-context-epic14.md#Story 14.11]
- [Source: docs/uxui/voice-tone-guidelines.md#Non-judgmental prompts]
- [Source: docs/uxui/mockups/01_views/insights.html]

---

## Atlas Workflow Analysis

> üó∫Ô∏è This section was generated by Atlas workflow chain analysis

### Affected Workflows

- **Insight Generation Flow (#5)**: IntentionalPrompt triggered by insights
- **Quick Save Flow (#6)**: May show after unusual saves

### Downstream Effects to Consider

- Response data can inform future insight generation
- Story 15.7 (Out-of-Character Detection) builds on this pattern
- Don't overwhelm user - limit prompt frequency

### Testing Implications

- **Existing tests to verify:** InsightEngine tests
- **New scenarios to add:** Prompt triggers, response storage, cooldown

### Workflow Chain Visualization

```
[Insight Generation] ‚Üí [Pattern Detection] ‚Üí [THIS STORY: Intentional Prompt] ‚Üí [User Response] ‚Üí [Profile Learning]
```

---

## Dev Agent Record

### Agent Model Used

_To be filled by dev agent_

### Completion Notes List

_To be filled during implementation_

### File List

_To be filled during implementation_
