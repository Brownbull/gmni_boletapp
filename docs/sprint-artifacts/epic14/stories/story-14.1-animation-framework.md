# Story 14.1: Animation Framework

**Status:** ready-for-dev
**Points:** 5
**Epic:** 14 - Core Implementation
**Dependencies:** None (Foundation story)

---

## Story

As a **user**,
I want **smooth, consistent animations throughout the app**,
so that **the interface feels polished and alive without being distracting**.

## Acceptance Criteria

1. **AnimationContext provider** created and integrated at app root
2. **useBreathing hook** implements 3s breathing cycle with scale 1.02 and opacity 0.9-1.0
3. **useStagger hook** provides stagger delay calculations (100ms default)
4. **Animation constants** defined for all timing/easing values per motion-design-system.md
5. **prefers-reduced-motion** support - all animations disabled when user prefers reduced motion
6. **Existing hooks integrated** - useReducedMotion and useStaggeredReveal work with new context

## Tasks / Subtasks

- [ ] Task 1: Create AnimationContext provider (AC: #1)
  - [ ] Create `src/components/animation/AnimationContext.tsx`
  - [ ] Define animation state interface
  - [ ] Export AnimationProvider component
  - [ ] Integrate at App.tsx root

- [ ] Task 2: Create animation constants file (AC: #4)
  - [ ] Create `src/components/animation/constants.ts`
  - [ ] Define DURATION tokens (instant, fast, normal, slow, breathing, celebration)
  - [ ] Define EASING curves (default, out, in-out, spring)
  - [ ] Define STAGGER defaults

- [ ] Task 3: Implement useBreathing hook (AC: #2)
  - [ ] Create `src/components/animation/useBreathing.ts`
  - [ ] Implement 3s cycle with configurable duration
  - [ ] Support scale and opacity animation
  - [ ] Integrate with useReducedMotion

- [ ] Task 4: Create useStagger utility hook (AC: #3)
  - [ ] Create `src/components/animation/useStagger.ts`
  - [ ] Calculate stagger delays for item counts
  - [ ] Support max duration cap

- [ ] Task 5: Ensure reduced motion support (AC: #5, #6)
  - [ ] Verify existing useReducedMotion hook integration
  - [ ] Add animation context flag for global disable
  - [ ] Test with prefers-reduced-motion media query

- [ ] Task 6: Write unit tests
  - [ ] Test AnimationContext provider
  - [ ] Test useBreathing with mock timers
  - [ ] Test useStagger calculations
  - [ ] Test reduced motion behavior

## Dev Notes

### Architecture Patterns

**From tech-context-epic14.md:**
```typescript
// constants.ts pattern
export const ANIMATION = {
  DURATION: {
    INSTANT: 0,
    FAST: 150,
    NORMAL: 200,
    SLOW: 300,
    BREATHING: 3000,
    CELEBRATION: 500,
  },
  EASING: {
    DEFAULT: 'ease',
    OUT: 'ease-out',
    IN_OUT: 'ease-in-out',
    SPRING: 'cubic-bezier(0.34, 1.56, 0.64, 1)',
  },
  STAGGER: {
    DEFAULT: 100,
    FAST: 50,
  },
} as const;
```

**From motion-design-system.md:**
```css
@keyframes breathe {
  0%, 100% { transform: scale(1); opacity: 0.9; }
  50% { transform: scale(1.02); opacity: 1; }
}
.breathing { animation: breathe 3s ease-in-out infinite; }
```

### Existing Foundation (Epic 11)

- `src/hooks/useReducedMotion.ts` - Already exists, respects prefers-reduced-motion
- `src/hooks/useStaggeredReveal.ts` - Progressive reveal with stagger timing
- `src/components/AnimatedItem.tsx` - Fade-in slide-up wrapper

### Project Structure

```
src/components/animation/
‚îú‚îÄ‚îÄ AnimationContext.tsx    # NEW - Provider component
‚îú‚îÄ‚îÄ useBreathing.ts         # NEW - Breathing animation hook
‚îú‚îÄ‚îÄ useStagger.ts           # NEW - Stagger utility
‚îú‚îÄ‚îÄ constants.ts            # NEW - Animation tokens
‚îî‚îÄ‚îÄ index.ts                # NEW - Barrel export
```

### Testing Standards

- Unit tests for hooks with jest fake timers
- Integration test for context provider
- Accessibility test for reduced motion

### References

- [Source: docs/sprint-artifacts/epic14/tech-context-epic14.md#Story 14.1]
- [Source: docs/uxui/motion-design-system.md#Animation Categories]
- [Source: docs/uxui/motion-design-system.md#Breathing Effect Specification]
- [Source: src/hooks/useReducedMotion.ts - Existing pattern]

---

## Atlas Workflow Analysis

> üó∫Ô∏è This section was generated by Atlas workflow chain analysis

### Affected Workflows

- **All Animation Workflows**: This story creates the foundation for all Epic 14 animations
- **Insight Generation Flow (#5)**: InsightCard will use breathing animations
- **Quick Save Flow (#6)**: QuickSaveCard will use spring animations

### Downstream Effects to Consider

- All Epic 14 stories (14.2-14.14) depend on this foundation
- Existing AnimatedItem component should integrate with new context
- CSS animations in index.css should align with new constants

### Testing Implications

- **Existing tests to verify:** useReducedMotion.test.ts, AnimatedItem tests
- **New scenarios to add:** AnimationContext provider tests, useBreathing timer tests

### Workflow Chain Visualization

```
[EPIC 11 Animation Foundation] ‚Üí [THIS STORY: Animation Framework] ‚Üí [14.2, 14.3, 14.5, 14.8, 14.10, 14.12]
```

---

## Dev Agent Record

### Agent Model Used

_To be filled by dev agent_

### Completion Notes List

_To be filled during implementation_

### File List

_To be filled during implementation_
