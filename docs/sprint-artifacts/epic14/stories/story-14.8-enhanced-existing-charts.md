# Story 14.8: Enhanced Existing Charts

**Status:** ready-for-dev
**Points:** 3
**Epic:** 14 - Core Implementation
**Dependencies:** Story 14.1 (Animation Framework)

---

## Story

As a **user viewing analytics charts**,
I want **animated transitions and count-up effects on charts**,
so that **data visualization feels dynamic and engaging**.

## Acceptance Criteria

1. **Animated count-up** for money values when charts load (300-500ms)
2. **Entry animations** - charts fade in and scale up on initial render
3. **Breathing effects** on hover/focus for interactive chart elements
4. **Consistent styling** with new design system variables
5. **Reduced motion support** - instant display without animations when preferred
6. **Touch feedback** on chart segments with subtle scale animation

## Tasks / Subtasks

- [ ] Task 1: Add count-up animation for values (AC: #1)
  - [ ] Create useCountUp hook for animating numbers
  - [ ] Apply to total amounts in charts
  - [ ] CLP formatting during animation
  - [ ] Duration: 300-500ms per motion-design-system.md

- [ ] Task 2: Implement entry animations (AC: #2)
  - [ ] Add fade-in + scale animation to SimplePieChart
  - [ ] Add fade-in + scale animation to GroupedBarChart
  - [ ] Stagger bar animations in grouped charts
  - [ ] Use animation constants from 14.1

- [ ] Task 3: Add breathing on hover/focus (AC: #3)
  - [ ] Apply subtle scale on hover (1.02x)
  - [ ] Apply focus ring for keyboard navigation
  - [ ] Use useBreathing hook for subtle pulse

- [ ] Task 4: Update chart styling (AC: #4)
  - [ ] Use CSS variables from design system
  - [ ] Update colors to match mockup palette
  - [ ] Ensure dark mode compatibility

- [ ] Task 5: Add reduced motion support (AC: #5)
  - [ ] Use useReducedMotion hook
  - [ ] Instant count-up without animation
  - [ ] Static charts without entry animation

- [ ] Task 6: Implement touch feedback (AC: #6)
  - [ ] Add touchstart/touchend handlers
  - [ ] Scale segment on touch (0.95x press, 1.05x release)
  - [ ] Brief haptic feedback on tap

- [ ] Task 7: Write tests
  - [ ] Test count-up animation with mock timers
  - [ ] Test entry animation triggers
  - [ ] Test reduced motion behavior

## Dev Notes

### Existing Chart Components

- `src/components/charts/SimplePieChart.tsx` - Recharts pie chart
- `src/components/charts/GroupedBarChart.tsx` - Recharts bar chart

### Count-Up Hook Pattern

```typescript
function useCountUp(
  end: number,
  duration: number = 400,
  options?: { prefix?: string; suffix?: string }
): string {
  const [current, setCurrent] = useState(0);
  const prefersReducedMotion = useReducedMotion();

  useEffect(() => {
    if (prefersReducedMotion) {
      setCurrent(end);
      return;
    }

    const startTime = Date.now();
    const animate = () => {
      const elapsed = Date.now() - startTime;
      const progress = Math.min(elapsed / duration, 1);
      const eased = easeOut(progress);
      setCurrent(Math.round(end * eased));

      if (progress < 1) {
        requestAnimationFrame(animate);
      }
    };
    requestAnimationFrame(animate);
  }, [end, duration, prefersReducedMotion]);

  return formatCLP(current);
}
```

### Animation Timing

**From motion-design-system.md:**
- Count-up: 300-500ms, ease-out
- Entry: 200ms, ease-out
- Hover breathing: 150ms transition

### Recharts Integration

Recharts supports `isAnimationActive` prop - can disable animations for reduced motion:

```tsx
<PieChart>
  <Pie
    isAnimationActive={!prefersReducedMotion}
    animationDuration={ANIMATION.DURATION.SLOW}
    animationEasing="ease-out"
  />
</PieChart>
```

### References

- [Source: docs/sprint-artifacts/epic14/tech-context-epic14.md#Story 14.8]
- [Source: docs/uxui/motion-design-system.md#Animation Categories]
- [Source: src/components/charts/SimplePieChart.tsx]
- [Source: src/components/charts/GroupedBarChart.tsx]

---

## Atlas Workflow Analysis

> üó∫Ô∏è This section was generated by Atlas workflow chain analysis

### Affected Workflows

- **Analytics Navigation Flow (#2)**: Charts are core analytics visualization
- No workflow changes - enhancement to existing components

### Downstream Effects to Consider

- Chart performance should not degrade with animations
- Recharts animations may conflict with custom animations
- Test on low-end devices for performance

### Testing Implications

- **Existing tests to verify:** SimplePieChart tests, GroupedBarChart tests
- **New scenarios to add:** Animation timing, count-up accuracy, reduced motion

### Workflow Chain Visualization

```
[14.1 Animation Framework] ‚Üí [THIS STORY: Enhanced Charts] ‚Üí [Analytics UX]
```

---

## Dev Agent Record

### Agent Model Used

_To be filled by dev agent_

### Completion Notes List

_To be filled during implementation_

### File List

_To be filled during implementation_
