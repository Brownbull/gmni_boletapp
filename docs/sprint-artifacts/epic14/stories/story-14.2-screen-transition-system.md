# Story 14.2: Screen Transition System

**Status:** ready-for-dev
**Points:** 3
**Epic:** 14 - Core Implementation
**Dependencies:** Story 14.1 (Animation Framework)

---

## Story

As a **user**,
I want **smooth transitions between screens with staggered content entry**,
so that **navigation feels fluid and content appears naturally**.

## Acceptance Criteria

1. **PageTransition wrapper component** created for screen-level transitions
2. **Staggered child entry** animations using useStaggeredReveal hook
3. **Settings exception** - Settings screen loads instantly (no animation) per motion-design-system.md
4. **Navigation integration** with existing router (react-router)
5. **Slide direction** respects navigation direction (left for forward, right for back)
6. **Reduced motion support** - instant transitions when user prefers reduced motion

## Tasks / Subtasks

- [ ] Task 1: Create PageTransition component (AC: #1, #4)
  - [ ] Create `src/components/animation/PageTransition.tsx`
  - [ ] Wrap with AnimatePresence for exit animations
  - [ ] Detect route changes for animation triggers
  - [ ] Export from animation index

- [ ] Task 2: Implement staggered child entry (AC: #2)
  - [ ] Use existing useStaggeredReveal for child timing
  - [ ] Add TransitionChild wrapper for individual items
  - [ ] Apply fade-in + slide-up animation per item

- [ ] Task 3: Implement Settings exception (AC: #3)
  - [ ] Detect when navigating to/from Settings
  - [ ] Skip animation for Settings route
  - [ ] Document exception behavior

- [ ] Task 4: Handle navigation direction (AC: #5)
  - [ ] Track navigation history direction
  - [ ] Apply slide-left for forward navigation
  - [ ] Apply slide-right for back navigation

- [ ] Task 5: Ensure reduced motion support (AC: #6)
  - [ ] Use useReducedMotion hook
  - [ ] Instant transitions when reduced motion enabled
  - [ ] No cumulative layout shift

- [ ] Task 6: Integrate with App routes
  - [ ] Wrap route components with PageTransition
  - [ ] Test all navigation paths
  - [ ] Verify no animation jank

- [ ] Task 7: Write unit tests
  - [ ] Test PageTransition rendering
  - [ ] Test Settings exception
  - [ ] Test direction detection
  - [ ] Test reduced motion behavior

## Dev Notes

### Screen Transition Patterns

**From motion-design-system.md:**

| From | To | Animation |
|------|-----|-----------|
| Any | Settings | Instant (no animation) |
| Home | Analytics | Slide left with stagger |
| Analytics | Drill-down | Slide left |
| Drill-down | Back | Slide right |
| Any | Scan | Modal slide up |
| Scan | Result | Crossfade with reveal |

### Implementation Pattern

```typescript
interface PageTransitionProps {
  children: React.ReactNode;
  routeKey: string;
  skipAnimation?: boolean;
}

const PageTransition: React.FC<PageTransitionProps> = ({
  children,
  routeKey,
  skipAnimation = false
}) => {
  const prefersReducedMotion = useReducedMotion();
  const isSettings = routeKey.includes('settings');

  // Skip animation for Settings or reduced motion
  if (prefersReducedMotion || isSettings || skipAnimation) {
    return <>{children}</>;
  }

  // Apply transition animation
  return (
    <motion.div
      key={routeKey}
      initial={{ opacity: 0, x: 20 }}
      animate={{ opacity: 1, x: 0 }}
      exit={{ opacity: 0, x: -20 }}
      transition={{ duration: ANIMATION.DURATION.SLOW / 1000 }}
    >
      {children}
    </motion.div>
  );
};
```

### Project Structure

```
src/components/animation/
‚îú‚îÄ‚îÄ AnimationContext.tsx    # From 14.1
‚îú‚îÄ‚îÄ PageTransition.tsx      # NEW - Screen transitions
‚îú‚îÄ‚îÄ TransitionChild.tsx     # NEW - Staggered child wrapper
‚îú‚îÄ‚îÄ useBreathing.ts         # From 14.1
‚îú‚îÄ‚îÄ constants.ts            # From 14.1
‚îî‚îÄ‚îÄ index.ts
```

### Animation Library Decision

Consider using CSS-only animations first (existing pattern from Epic 11). If more complex orchestration needed, consider framer-motion as it's already in the ecosystem.

### References

- [Source: docs/sprint-artifacts/epic14/tech-context-epic14.md#Story 14.2]
- [Source: docs/uxui/motion-design-system.md#Screen Transitions]
- [Source: src/hooks/useStaggeredReveal.ts - Existing stagger pattern]

---

## Atlas Workflow Analysis

> üó∫Ô∏è This section was generated by Atlas workflow chain analysis

### Affected Workflows

- **Analytics Navigation Flow (#2)**: Drill-down transitions need smooth animations
- **History Filter Flow (#4)**: Filter changes may trigger content re-entry
- **Insight History Flow (#8)**: InsightsView navigation

### Downstream Effects to Consider

- All view components will be wrapped with PageTransition
- May affect perceived load time (animations add duration)
- Settings instant load is critical for user experience

### Testing Implications

- **Existing tests to verify:** Route navigation tests
- **New scenarios to add:** Transition animation timing, Settings exception, reduced motion

### Workflow Chain Visualization

```
[14.1 Animation Framework] ‚Üí [THIS STORY: Screen Transitions] ‚Üí [All Views, Navigation UX]
```

---

## Dev Agent Record

### Agent Model Used

_To be filled by dev agent_

### Completion Notes List

_To be filled during implementation_

### File List

_To be filled during implementation_
