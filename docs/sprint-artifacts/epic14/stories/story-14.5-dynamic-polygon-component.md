# Story 14.5: Dynamic Polygon Component

**Status:** ready-for-dev
**Points:** 5
**Epic:** 14 - Core Implementation
**Dependencies:** Story 14.1 (Animation Framework)

---

## Story

As a **user viewing my spending overview**,
I want **a dynamic polygon visualization that shows my top spending categories**,
so that **I can quickly understand where my money is going at a glance**.

## Acceptance Criteria

1. **DynamicPolygon component** renders SVG-based polygon with 3-6 vertices
2. **Dynamic side count** based on number of significant spending categories
3. **Breathing animation** applied using useBreathing hook (3s cycle)
4. **Category labeling** shown at each vertex with category name and amount
5. **Touch/click interactivity** - tapping a vertex drills into that category
6. **Responsive sizing** - polygon scales appropriately on different screen sizes
7. **Reduced motion support** - static polygon without breathing when preferred

## Tasks / Subtasks

- [ ] Task 1: Create DynamicPolygon component (AC: #1)
  - [ ] Create `src/components/polygon/DynamicPolygon.tsx`
  - [ ] Use SVG for rendering polygon shape
  - [ ] Calculate polygon points on unit circle
  - [ ] Scale radii by spending ratio per category

- [ ] Task 2: Implement dynamic vertex count (AC: #2)
  - [ ] Determine top 3-6 categories from spending data
  - [ ] Minimum 3 vertices (triangle)
  - [ ] Maximum 6 vertices (hexagon)
  - [ ] Handle edge cases (0-2 categories)

- [ ] Task 3: Add breathing animation (AC: #3)
  - [ ] Use useBreathing hook from 14.1
  - [ ] Apply scale transform to polygon container
  - [ ] 3s breathing cycle per motion-design-system.md

- [ ] Task 4: Implement category labels (AC: #4)
  - [ ] Position labels at each vertex
  - [ ] Show category name (short form)
  - [ ] Show amount in CLP format
  - [ ] Use category colors from design system

- [ ] Task 5: Add touch/click interactivity (AC: #5)
  - [ ] onVertexClick callback prop
  - [ ] Visual feedback on touch (scale vertex)
  - [ ] Navigate to category drill-down

- [ ] Task 6: Ensure responsive sizing (AC: #6)
  - [ ] Use viewBox for SVG scaling
  - [ ] Maintain aspect ratio
  - [ ] Minimum size for touch targets

- [ ] Task 7: Add reduced motion support (AC: #7)
  - [ ] Use useReducedMotion hook
  - [ ] Static polygon without animation
  - [ ] Still interactive

- [ ] Task 8: Write tests
  - [ ] Test polygon point calculations
  - [ ] Test vertex count based on data
  - [ ] Test click handlers
  - [ ] Test reduced motion behavior

## Dev Notes

### Mockup Reference

**From analytics-polygon.html:**
- Pentagon shape for 5 categories
- Category labels at each vertex
- Gradient fill with category colors
- Breathing pulse effect

### Polygon Point Calculation

```typescript
interface CategorySpending {
  name: string;
  amount: number;
  color: string;
}

function calculatePolygonPoints(
  categories: CategorySpending[],
  centerX: number,
  centerY: number,
  maxRadius: number
): string {
  const count = categories.length;
  const maxAmount = Math.max(...categories.map(c => c.amount));

  return categories.map((cat, i) => {
    const angle = (2 * Math.PI * i) / count - Math.PI / 2; // Start from top
    const ratio = cat.amount / maxAmount;
    const radius = maxRadius * (0.3 + 0.7 * ratio); // Min 30%, max 100%
    const x = centerX + radius * Math.cos(angle);
    const y = centerY + radius * Math.sin(angle);
    return `${x},${y}`;
  }).join(' ');
}
```

### Category Colors

**From analytics-polygon.html:**
```css
--cat-groceries: #22c55e;
--cat-restaurant: #ef4444;
--cat-transport: #3b82f6;
--cat-entertainment: #8b5cf6;
--cat-utilities: #f59e0b;
--cat-other: #6b7280;
```

### Component Interface

```typescript
interface DynamicPolygonProps {
  categories: CategorySpending[];
  maxVertices?: 3 | 4 | 5 | 6;
  breathing?: boolean;
  onVertexClick?: (category: string) => void;
  className?: string;
}
```

### References

- [Source: docs/sprint-artifacts/epic14/tech-context-epic14.md#Story 14.5]
- [Source: docs/uxui/mockups/01_views/analytics-polygon.html]
- [Source: docs/uxui/mockups/01_views/home-dashboard.html]

---

## Atlas Workflow Analysis

> üó∫Ô∏è This section was generated by Atlas workflow chain analysis

### Affected Workflows

- **Analytics Navigation Flow (#2)**: Polygon is new entry point for analytics
- **History Filter Flow (#4)**: Vertex click leads to filtered history

### Downstream Effects to Consider

- Stories 14.6 and 14.7 depend on this component
- Analytics view will integrate polygon as primary visualization
- Home dashboard will show polygon as spending overview

### Testing Implications

- **Existing tests to verify:** Analytics context tests
- **New scenarios to add:** Polygon rendering, vertex calculations, click navigation

### Workflow Chain Visualization

```
[14.1 Animation Framework] ‚Üí [THIS STORY: Dynamic Polygon] ‚Üí [14.6 Dual Mode] ‚Üí [14.7 Lava Visual]
```

---

## Dev Agent Record

### Agent Model Used

_To be filled by dev agent_

### Completion Notes List

_To be filled during implementation_

### File List

_To be filled during implementation_
