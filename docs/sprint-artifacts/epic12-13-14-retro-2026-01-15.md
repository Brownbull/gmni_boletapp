# Retrospective: Epics 12, 13, and 14

**Date:** 2026-01-15
**Facilitator:** Bob (Scrum Master)
**Participants:** Gabe (Product Owner), Dev Team (AI Agents)
**Duration Covered:** December 22, 2025 - January 15, 2026 (~25 days)
**Production URL:** https://boletapp-d609f.web.app

---

## Epic Summary

| Epic | Theme | Stories | Points | Duration | Key Deliverable |
|------|-------|---------|--------|----------|-----------------|
| **Epic 12** | Batch Mode | 6 stories | ~25 pts | Dec 22-23 | Multi-image capture, parallel processing, batch review |
| **Epic 13** | UX Design & Mockups | 14 stories | ~41 pts | Dec 23-31 | Design system, 10 HTML mockups, motion specs |
| **Epic 14** | Core Implementation | 50+ stories | ~150 pts | Dec 31 - Jan 15 | Animation framework, polygon, charts, insights, celebrations, settings, 14d refactor |
| **TOTAL** | | **~70+ stories** | **~216+ pts** | **~25 days** | **~8.6 pts/day velocity** |

---

## Key Innovations Delivered

### Epic 12: Batch Mode
1. **Parallel Processing Service** - Up to 3 concurrent API calls for faster batch completion
2. **Batch Review Queue** - Summary cards with individual edit capability
3. **Credit Warning System** - Transparency before processing
4. **Batch Insights** - Aggregate insight after multi-receipt save

### Epic 13: UX Design & Mockups
1. **Design System HTML Components** - `design-system-final.html` with ALL reusable components
2. **10 View Mockups** - Complete interactive prototypes for every major view
3. **Motion Design System** - "Everything Breathes" animation specifications
4. **Voice & Tone Guidelines** - Non-judgmental messaging patterns
5. **Design Review Gate** - Comprehensive approval before implementation

### Epic 14: Core Implementation
1. **Animation Framework** - `AnimationContext`, `useBreathing`, CSS animation constants
2. **Dynamic Polygon** - 3-6 sided spending visualization with breathing
3. **Scan State Machine (14d)** - 31 variables â†’ unified state machine, massive App.tsx cleanup
4. **Insight Card Types** - 5 distinct styling types (quirky, celebration, actionable, tradeoff, trend)
5. **Airlock Sequence** - Progressive reveal UI for insights
6. **Celebration System** - Confetti, haptics, personal records
7. **Weekly Reports** - Story-format swipeable cards
8. **Settings Redesign** - Hierarchical navigation with sub-views
9. **React Query Migration** - Modern data fetching/caching pattern
10. **Firestore Cost Optimization** - Listener limits, pagination, query optimization
11. **Tiered CI/CD** - Branch-specific testing (develop=smoke ~3min, main=full ~5min)

---

## What Went Well

### From Gabe (Product Owner)

1. **Atlas Agent Integration**
   - Consistent code reviews with adversarial approach
   - Architectural memory - patterns documented and carried forward
   - Quick issue identification and fixes during reviews
   - Traffic development management

2. **Design-First Workflow (Mockups)**
   - HTML mockups as source of truth for implementation
   - Grounded requirements - no ambiguity about what we were building
   - Design system extraction made component building consistent

3. **CI/CD Testing Resolution**
   - Identified and fixed infinite loops (LearnMerchantDialog, useBatchReview)
   - Clean test suite now in place
   - Tiered testing approach (develop=smoke, main=full)

4. **Prompt Iteration Workflow**
   - Fast feedback loop using Epic 8 test harness
   - Ability to iterate quickly on scan prompts (v2.6 â†’ v3)
   - Core differentiating feature for the product
   - A/B comparison capability for prompt versions

### From the Team

1. **Exceptional Velocity** - ~216 points in ~25 days = ~8.6 points/day
2. **All Stories Passed Code Review** - Adversarial reviews with formal approval
3. **Pattern Documentation** - Lessons captured in Atlas 06-lessons.md
4. **Design System Success** - Mockups guided implementation seamlessly

---

## What Challenged Us

### 1. Testing Infrastructure Pain
- **Infinite loops hard to detect** - `LearnMerchantDialog` (default array param), `useBatchReview` (useMemo in useEffect deps)
- **CI timeouts masked root cause** - 7+ minute timeouts didn't point to specific component
- **Resolution took investigation** - not obvious from error messages
- **Fixed in Story 14.30.8** - Now heavy-1 tests complete in ~1s

### 2. Cost Monitoring Gap
- **Firestore $19/week spike** - discovered mid-epic, not proactively monitored
- **Unlimited listeners** - 6+ listeners fetching entire collections without limits
- **Reactive vs proactive** - had to create Stories 14.25-14.29 to fix
- **Resolution:** Firebase budget alerts now in place

### 3. Scan Architecture Technical Debt
- **Legacy model couldn't extend** - adding batch mode created fragility
- **31 scattered state variables** - no single source of truth
- **Bug fixes caused regressions** - interdependencies weren't visible
- **Full refactor required** - Epic 14d (52 points) to clean it up properly
- **Lesson:** Refactor legacy before extending it

### 4. Codebase Size & Modularity
- **Large files = large context** - App.tsx was 3,800+ lines
- **Ripple effects** - modifications touch other parts unexpectedly
- **Need for modularization** - extract concerns to contexts/hooks
- **Big files are tricky** - hard to modify and understand

---

## Previous Retro Follow-Through (Epic 10/11)

| Epic 10/11 Commitment | Status in Epics 12/13/14 |
|----------------------|---------------------------|
| Address bundle size (~948KB) | ðŸ”„ DEFERRED - Still pending |
| Epic 12 planning | âœ… DONE - Batch Mode shipped |
| Epic 13 UX research & mockups | âœ… DONE - Full design system |
| Animation library evaluation | âœ… DONE - CSS + existing hooks |
| Continue Atlas pattern documentation | âœ… DONE - 06-lessons.md maintained |

**Result:** 4/5 commitments completed

---

## Process Improvements Adopted

### 1. Epic Completion Checklist (New Standard)
Every epic must include before marking complete:
- **Cost Audit** - Document Firestore reads/writes, check for cost anomalies
- **Test Health Check** - Verify no infinite loops, all tests complete in reasonable time
- **Bundle Size Check** - Document bundle size delta

### 2. Infinite Loop Detection
- Add specific test patterns for component stability
- CI check that flags any test taking >30 seconds as warning

### 3. Codebase Modularization (Ongoing)
- Target large files for extraction (App.tsx, large views)
- Single responsibility per service file
- 1-2 modularization stories per epic

### 4. Refactor-First Policy
> When a feature touches legacy code with >3 interconnected state variables or >500 lines, create a refactor story first before the feature story.

---

## Action Items

| # | Action Item | Owner | Priority | Status |
|---|-------------|-------|----------|--------|
| 1 | Set up Firebase budget alerts | Gabe | HIGH | âœ… ALREADY DONE |
| 2 | Add infinite loop test pattern to test utils | Dev Team | HIGH | Next epic |
| 3 | Create `X.99-epic-completion-gates` story template | SM | MEDIUM | Before next epic |
| 4 | Run brainstorming for Epic 14C (Household Sharing) | Gabe + Team | HIGH | Before 14C stories |
| 5 | Run architecture review for Epic 14E (Refactoring) | Architect | HIGH | Before 14E stories |
| 6 | Define Epic 14F requirements (Invite-Only Access) | Gabe + PM | MEDIUM | After 14C/14E scoped |

---

## Next Epics Roadmap

### Epic 14C: Household Sharing (~34 points)
- **Status:** Backlog â†’ Needs Brainstorm
- **Prep:** Run brainstorming session to rethink sharing model
- **Topics:** Share individual vs all, household model, privacy controls, invitation flow

### Epic 14E: Codebase Refactoring (NEW)
- **Status:** To be defined
- **Prep:** Architecture review to identify refactoring priorities
- **Targets:** App.tsx, large views, service file organization, module boundaries

### Epic 14F: Invite-Only Access System (NEW)
- **Status:** To be defined
- **Vision:** Control early user access through invite codes/QR links
- **Requirements:**
  - Generate QR codes or shareable links
  - Only invited users can register/login with Google OAuth
  - Prevent uncontrolled signups
  - Hand-pick beta testers

---

## Closing Thoughts

> "This app is already very useful. We are close to being out in the wild."
> â€” Gabe, Product Owner

The team has transformed Boletapp from a data entry tool into a comprehensive financial awareness companion. With:
- Batch scanning for power users
- Beautiful animated visualizations
- Insightful, non-judgmental feedback
- Solid technical foundation

We are ready for controlled beta launch with the invite-only system planned for Epic 14F.

---

## References

- [Epic 12 Tech Context](./epic12/tech-context-epic12.md)
- [Epic 13 Tech Context](./epic13/tech-context-epic13.md)
- [Epic 14 Tech Context](./epic14/tech-context-epic14.md)
- [Epic 14d Scan Architecture Refactor](./epic14d/epic-14d-scan-architecture-refactor.md)
- [Design System Reference](../uxui/mockups/00_components/design-system-reference.md)
- [Sprint Status](./sprint-status.yaml)
- [Atlas Lessons](../../_bmad/agents/atlas/atlas-sidecar/knowledge/06-lessons.md)
- [Previous Retro (Epics 10/10a/11)](./epic11/epic10-11-retro-2025-12-22.md)

---

*Generated by BMAD Retrospective Workflow*
*Epics: batch-mode, ux-design-mockups, core-implementation*
*Retrospective Date: 2026-01-15*
