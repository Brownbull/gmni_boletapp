<!DOCTYPE html>
<html lang="es" data-theme="mono" data-font="outfit" data-mode="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gastify - Reports Hub</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700&family=Space+Grotesk:wght@400;500;600;700&family=Baloo+2:wght@700&display=swap" rel="stylesheet">
  <style>
    /* ============================================
       DESIGN TOKENS FROM REFERENCE
       ============================================ */
    :root {
      /* Primary Palette */
      --primary: #2563eb;
      --primary-hover: #1d4ed8;
      --primary-light: #dbeafe;
      --primary-dark: #1e40af;
      /* Secondary */
      --secondary: #64748b;
      --secondary-light: #f1f5f9;
      --accent: #0ea5e9;
      /* Backgrounds */
      --bg-primary: #f8fafc;
      --bg-secondary: #ffffff;
      --bg-tertiary: #f1f5f9;
      --bg-inverse: #0f172a;
      /* Text */
      --text-primary: #0f172a;
      --text-secondary: #475569;
      --text-tertiary: #94a3b8;
      --text-inverse: #f8fafc;
      /* Borders */
      --border-light: #e2e8f0;
      --border-medium: #cbd5e1;
      --border-dark: #94a3b8;
      /* Semantic */
      --success: #22c55e;
      --success-light: #dcfce7;
      --warning: #f59e0b;
      --warning-light: #fef3c7;
      --error: #ef4444;
      --error-light: #fee2e2;
      /* Shadows */
      --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
      --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
      --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
      /* Spacing */
      --space-1: 4px; --space-2: 8px; --space-3: 12px; --space-4: 16px;
      --space-5: 20px; --space-6: 24px; --space-8: 32px; --space-10: 40px;
      /* Radii */
      --radius-sm: 6px; --radius-md: 10px; --radius-lg: 12px;
      --radius-xl: 16px; --radius-2xl: 20px; --radius-full: 9999px;
      /* Typography */
      --font-family: 'Outfit', ui-sans-serif, system-ui, sans-serif;
      --transition-fast: 150ms ease;
      --transition-normal: 200ms ease;
      --transition-slow: 300ms ease;
    }

    /* THEME 1: Professional Blue (Default) */
    [data-theme="professional"] {
      --primary: #2563eb;
      --primary-hover: #1d4ed8;
      --primary-light: #dbeafe;
      --primary-dark: #1e40af;
      --secondary: #64748b;
      --secondary-light: #f1f5f9;
      --accent: #0ea5e9;
      --bg-primary: #f8fafc;
      --bg-secondary: #ffffff;
      --bg-tertiary: #f1f5f9;
      --bg-inverse: #0f172a;
      --text-primary: #0f172a;
      --text-secondary: #475569;
      --text-tertiary: #94a3b8;
      --border-light: #e2e8f0;
      --border-medium: #cbd5e1;
    }

    /* THEME 2: Monochrome Minimal */
    [data-theme="mono"] {
      --primary: #18181b;
      --primary-hover: #27272a;
      --primary-light: #f4f4f5;
      --primary-dark: #09090b;
      --secondary: #52525b;
      --secondary-light: #e4e4e7;
      --accent: #3b82f6;
      --bg-primary: #fafafa;
      --bg-secondary: #ffffff;
      --bg-tertiary: #f4f4f5;
      --bg-inverse: #18181b;
      --text-primary: #18181b;
      --text-secondary: #52525b;
      --text-tertiary: #a1a1aa;
      --border-light: #e4e4e7;
      --border-medium: #d4d4d8;
    }

    /* THEME 3: Ni No Kuni / Studio Ghibli */
    [data-theme="ninokuni"] {
      --primary: #4a7c59;
      --primary-hover: #3d6b4a;
      --primary-light: #d4e5d9;
      --primary-dark: #2d5438;
      --secondary: #5b8fa8;
      --secondary-light: #d5e8f0;
      --accent: #e8a87c;
      --bg-primary: #f5f0e8;
      --bg-secondary: #ffffff;
      --bg-tertiary: #f1dbb6;
      --bg-inverse: #2d3a4a;
      --text-primary: #2d3a4a;
      --text-secondary: #4a5568;
      --text-tertiary: #7d9b5f;
      --border-light: #e3bba1;
      --border-medium: #d4a574;
      --success: #7d9b5f;
      --success-light: #d4e5d9;
    }

    /* ============================================
       DARK MODE VARIANTS
       ============================================ */

    /* Professional Blue - Dark Mode */
    [data-theme="professional"][data-mode="dark"] {
      --primary: #3b82f6;
      --primary-hover: #2563eb;
      --primary-light: #1e3a5f;
      --primary-dark: #60a5fa;
      --secondary: #94a3b8;
      --secondary-light: #334155;
      --accent: #38bdf8;
      --bg-primary: #0f172a;
      --bg-secondary: #1e293b;
      --bg-tertiary: #334155;
      --bg-inverse: #f8fafc;
      --text-primary: #f1f5f9;
      --text-secondary: #cbd5e1;
      --text-tertiary: #64748b;
      --text-inverse: #0f172a;
      --border-light: #334155;
      --border-medium: #475569;
      --border-dark: #64748b;
    }

    /* Mono - Dark Mode */
    [data-theme="mono"][data-mode="dark"] {
      --primary: #a1a1aa;
      --primary-hover: #d4d4d8;
      --primary-light: #27272a;
      --primary-dark: #e4e4e7;
      --secondary: #71717a;
      --secondary-light: #3f3f46;
      --accent: #60a5fa;
      --bg-primary: #09090b;
      --bg-secondary: #18181b;
      --bg-tertiary: #27272a;
      --bg-inverse: #fafafa;
      --text-primary: #fafafa;
      --text-secondary: #d4d4d8;
      --text-tertiary: #71717a;
      --text-inverse: #09090b;
      --border-light: #27272a;
      --border-medium: #3f3f46;
    }

    /* Ni No Kuni - Dark Mode */
    [data-theme="ninokuni"][data-mode="dark"] {
      --primary: #6b9e7a;
      --primary-hover: #5a8a68;
      --primary-light: #2d3d32;
      --primary-dark: #8fbf9c;
      --secondary: #7ba8be;
      --secondary-light: #2d3d4a;
      --accent: #d4a574;
      --bg-primary: #1a2420;
      --bg-secondary: #243028;
      --bg-tertiary: #2d3d32;
      --bg-inverse: #f5f0e8;
      --text-primary: #e8e4dc;
      --text-secondary: #b8c4a8;
      --text-tertiary: #6b8b5f;
      --text-inverse: #2d3a4a;
      --border-light: #3d4d42;
      --border-medium: #4d5d52;
      --success: #8fbf9c;
      --success-light: #2d3d32;
    }

    /* Font Definitions */
    body[data-font="outfit"] { --font-family: 'Outfit', ui-sans-serif, system-ui, sans-serif; }
    body[data-font="space"] { --font-family: 'Space Grotesk', ui-sans-serif, system-ui, sans-serif; }

    /* Logo Style Definitions - Paired with themes */
    body[data-theme="professional"] .g-logo-circle { background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%) !important; }
    body[data-theme="mono"] .g-logo-circle { background: linear-gradient(135deg, #18181b 0%, #3f3f46 100%) !important; }
    body[data-theme="ninokuni"] .g-logo-circle { background: linear-gradient(135deg, #4a7c59 0%, #5b8fa8 100%) !important; }

    /* Logo Style Definitions - Dark Mode Variants */
    body[data-theme="professional"][data-mode="dark"] .g-logo-circle { background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%) !important; }
    body[data-theme="mono"][data-mode="dark"] .g-logo-circle { background: linear-gradient(135deg, #a1a1aa 0%, #71717a 100%) !important; }
    body[data-theme="ninokuni"][data-mode="dark"] .g-logo-circle { background: linear-gradient(135deg, #6b9e7a 0%, #7ba8be 100%) !important; }

    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: var(--font-family);
      background: #1a1a2e;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 40px 20px;
      gap: 24px;
    }

    /* Page Layout - Stack phone and controls vertically */
    .page-wrapper {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 20px;
    }

    /* Global Controls Panel - Horizontal bar below phone */
    .global-controls {
      background: rgba(30, 41, 59, 0.95);
      backdrop-filter: blur(8px);
      border-radius: 12px;
      padding: 12px 20px;
      display: flex;
      flex-direction: row;
      gap: 24px;
      border: 1px solid rgba(255,255,255,0.1);
      align-items: center;
      flex-wrap: wrap;
      justify-content: center;
    }
    .control-group { display: flex; align-items: center; gap: 10px; }
    .control-label {
      font-size: 10px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: #94a3b8;
      white-space: nowrap;
    }
    .control-options { display: flex; gap: 6px; flex-wrap: wrap; }

    /* Theme Swatches */
    .theme-swatch {
      width: 28px;
      height: 28px;
      border-radius: 8px;
      cursor: pointer;
      border: 2px solid transparent;
      transition: all 150ms ease;
    }
    .theme-swatch:hover { transform: scale(1.1); }
    .theme-swatch.active {
      border-color: white;
      box-shadow: 0 0 0 2px rgba(255,255,255,0.3);
    }
    .theme-swatch[data-theme="professional"] { background: linear-gradient(135deg, #2563eb 50%, #64748b 50%); }
    .theme-swatch[data-theme="mono"] { background: linear-gradient(135deg, #18181b 50%, #52525b 50%); }
    .theme-swatch[data-theme="ninokuni"] { background: linear-gradient(135deg, #4a7c59 50%, #5b8fa8 50%); }

    /* Font Pills */
    .font-pill {
      padding: 4px 10px;
      border-radius: 9999px;
      font-size: 11px;
      font-weight: 500;
      cursor: pointer;
      border: 1px solid rgba(255,255,255,0.2);
      background: transparent;
      color: #94a3b8;
      transition: all 150ms ease;
    }
    .font-pill:hover { background: rgba(255,255,255,0.1); }
    .font-pill.active {
      background: white;
      color: #0f172a;
      border-color: white;
    }

    /* Mode Toggle */
    .mode-toggle {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 6px 12px;
      border-radius: 9999px;
      cursor: pointer;
      border: 1px solid rgba(255,255,255,0.2);
      background: transparent;
      color: #94a3b8;
      transition: all 150ms ease;
      font-size: 11px;
      font-weight: 500;
    }
    .mode-toggle:hover { background: rgba(255,255,255,0.1); }
    .mode-toggle.active {
      background: #1e293b;
      border-color: #3b82f6;
      color: #f1f5f9;
    }
    .mode-toggle svg {
      width: 14px;
      height: 14px;
      fill: currentColor;
    }

    /* Phone Frame */
    .phone-frame {
      width: 375px;
      min-height: 812px;
      background: #1e293b;
      border-radius: 54px;
      padding: 14px;
      box-shadow: 0 25px 50px -12px rgb(0 0 0 / 0.25),
        inset 0 0 0 2px #334155, inset 0 0 0 4px #475569;
    }
    .phone-screen {
      width: 100%;
      height: 784px;
      background: var(--bg-primary);
      border-radius: 44px;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    /* Status Bar */
    .status-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 24px 8px;
      background: var(--bg-primary);
    }
    .status-time { font-size: 14px; font-weight: 600; color: var(--text-primary); }
    .status-icons { display: flex; gap: 4px; align-items: center; }
    .status-icons svg { width: 16px; height: 16px; fill: var(--text-primary); }

    /* Header Bar */
    .header-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 16px 12px;
      background: var(--bg-primary);
    }
    .g-logo-circle {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      transition: background 300ms ease;
    }
    .header-wordmark {
      font-family: 'Baloo 2', cursive;
      font-size: 24px;
      font-weight: 700;
      color: var(--text-primary);
    }
    .header-menu {
      width: 36px; height: 36px;
      border-radius: var(--radius-md);
      background: var(--bg-secondary);
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .header-menu svg {
      width: 18px; height: 18px;
      stroke: var(--text-primary);
      fill: none;
      stroke-width: 2;
    }

    /* Main Content */
    .main-content {
      flex: 1;
      overflow-y: auto;
      padding: 12px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    /* ============================================
       REPORTS HUB SPECIFIC STYLES
       ============================================ */

    /* Report Section - Collapsible */
    .report-section {
      background: var(--bg-secondary);
      border-radius: var(--radius-lg);
      border: 1px solid var(--border-light);
      overflow: hidden;
    }

    .report-section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 14px;
      cursor: pointer;
      transition: background var(--transition-fast);
    }
    .report-section-header:hover {
      background: var(--bg-tertiary);
    }

    .report-section-left {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .section-chevron {
      width: 18px;
      height: 18px;
      stroke: var(--text-tertiary);
      fill: none;
      stroke-width: 2;
      transition: transform var(--transition-fast);
    }
    .report-section.collapsed .section-chevron {
      transform: rotate(-90deg);
    }

    .section-title {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-primary);
    }

    /* Time Selector */
    .time-selector {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .time-arrow {
      width: 24px;
      height: 24px;
      border: none;
      background: var(--bg-tertiary);
      border-radius: var(--radius-sm);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: background var(--transition-fast);
    }
    .time-arrow:hover {
      background: var(--border-light);
    }
    .time-arrow svg {
      width: 14px;
      height: 14px;
      stroke: var(--text-secondary);
      fill: none;
      stroke-width: 2;
    }
    .time-value {
      font-size: 12px;
      font-weight: 500;
      color: var(--text-secondary);
      min-width: 70px;
      text-align: center;
    }

    /* Report Cards Container */
    .report-cards {
      display: flex;
      flex-direction: column;
      gap: 6px;
      padding: 0 10px 10px;
    }
    .report-section.collapsed .report-cards {
      display: none;
    }

    /* Placeholder for empty sections */
    .report-placeholder {
      padding: 16px;
      text-align: center;
      color: var(--text-tertiary);
      font-size: 13px;
    }
    .report-section.collapsed .report-placeholder {
      display: none;
    }

    /* Report Card Row */
    .report-card {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px;
      border-radius: var(--radius-md);
      cursor: pointer;
      transition: all var(--transition-fast);
    }
    .report-card:hover {
      transform: translateX(2px);
    }

    /* Background gradient by time dimension (light mode defaults) */
    .report-card.weekly { background: var(--primary-light); }
    .report-card.monthly {
      background: color-mix(in srgb, var(--primary) 20%, var(--bg-secondary) 80%);
    }
    .report-card.quarterly {
      background: color-mix(in srgb, var(--primary) 35%, var(--bg-secondary) 65%);
    }
    .report-card.yearly {
      background: color-mix(in srgb, var(--primary) 50%, var(--bg-secondary) 50%);
    }

    /* Read/Unread States */
    .report-card.unread {
      font-weight: 600;
    }
    .report-card.unread .report-title {
      font-weight: 700;
    }
    .report-card.read {
      opacity: 0.75;
    }

    /* Unread Indicator Dot */
    .unread-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--primary);
      flex-shrink: 0;
    }
    .report-card.read .unread-dot {
      display: none;
    }

    /* Logo in Card */
    .report-logo {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-hover) 100%);
    }
    .report-logo span {
      color: white;
      font-weight: 700;
      font-size: 14px;
      font-family: 'Baloo 2', sans-serif;
    }

    /* Report Content */
    .report-content {
      flex: 1;
      min-width: 0;
    }
    .report-title {
      font-size: 13px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 2px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    /* Transaction Count Badge (Story 14.16 Enhancement) */
    .tx-count-badge {
      display: inline-flex;
      align-items: center;
      gap: 3px;
      font-size: 10px;
      font-weight: 500;
      padding: 2px 6px;
      border-radius: 9999px;
      background: var(--bg-tertiary);
      color: var(--text-secondary);
    }
    .tx-count-badge svg {
      width: 10px;
      height: 10px;
      stroke: currentColor;
      fill: none;
      stroke-width: 2;
    }
    .report-meta {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 11px;
    }

    /* Amount and Trend */
    .report-amount {
      font-weight: 600;
      color: var(--text-primary);
    }
    .report-trend {
      display: flex;
      align-items: center;
      gap: 2px;
      font-weight: 600;
    }
    .report-trend.up {
      color: var(--error);
    }
    .report-trend.down {
      color: var(--success);
    }
    .report-trend svg {
      width: 12px;
      height: 12px;
      stroke: currentColor;
      fill: none;
      stroke-width: 2.5;
    }

    /* First Report Text */
    .report-first {
      color: var(--text-tertiary);
      font-style: italic;
    }

    /* Persona Hook (Quarterly/Yearly only) */
    .report-hook {
      font-size: 10px;
      color: var(--text-secondary);
      font-style: italic;
      margin-top: 2px;
    }

    /* Back Header (Subsection Navigation) */
    .back-header {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 16px 12px;
      background: var(--bg-primary);
    }
    .back-arrow {
      cursor: pointer;
      transition: transform var(--transition-fast);
    }
    .back-arrow:hover {
      transform: translateX(-2px);
    }
    .back-title {
      font-size: 20px;
      font-weight: 700;
      color: var(--text-primary);
      margin: 0;
    }

    /* Phone screen needs relative positioning for overlay */
    .phone-screen {
      position: relative;
    }

    /* ============================================
       REPORT OVERLAY (Story-Style Content)
       ============================================ */
    .report-overlay {
      position: absolute;
      top: 80px; /* Below status bar + back header */
      left: 0;
      right: 0;
      bottom: 92px; /* Above bottom nav */
      background: var(--bg-primary);
      z-index: 50;
      display: none;
      flex-direction: column;
      overflow: hidden;
      border-radius: var(--radius-lg);
      margin: 0 8px;
      box-shadow: var(--shadow-lg);
      border: 1px solid var(--border-light);
    }
    .report-overlay.active {
      display: flex;
    }

    /* Overlay Header */
    .overlay-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 16px 12px;
      background: var(--bg-primary);
      border-bottom: 1px solid var(--border-light);
    }
    .overlay-back {
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
    }
    .overlay-back svg {
      width: 20px;
      height: 20px;
      stroke: var(--text-primary);
      fill: none;
      stroke-width: 2;
    }
    .overlay-title {
      font-size: 16px;
      font-weight: 600;
      color: var(--text-primary);
    }
    .overlay-close {
      width: 32px;
      height: 32px;
      border: none;
      background: var(--bg-tertiary);
      border-radius: var(--radius-full);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }
    .overlay-close svg {
      width: 18px;
      height: 18px;
      stroke: var(--text-secondary);
      fill: none;
      stroke-width: 2;
    }

    /* Overlay Content - Story Cards */
    .overlay-content {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    /* Story Card */
    .story-card {
      background: var(--bg-secondary);
      border-radius: var(--radius-lg);
      padding: 20px;
      border: 1px solid var(--border-light);
    }
    .story-card.hero {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-hover) 100%);
      color: white;
      border: none;
      text-align: center;
      padding: 32px 20px;
    }
    .story-card.hero .story-label {
      color: rgba(255,255,255,0.8);
    }
    .story-card.hero .story-amount {
      font-size: 36px;
      color: white;
    }
    .story-card.hero .story-trend {
      color: rgba(255,255,255,0.9);
      background: rgba(255,255,255,0.2);
      padding: 4px 12px;
      border-radius: var(--radius-full);
      display: inline-flex;
      align-items: center;
      gap: 4px;
      margin-top: 8px;
    }

    .story-label {
      font-size: 12px;
      color: var(--text-tertiary);
      margin-bottom: 4px;
    }
    .story-amount {
      font-size: 28px;
      font-weight: 700;
      color: var(--text-primary);
    }
    .story-subtitle {
      font-size: 13px;
      color: var(--text-secondary);
      margin-top: 4px;
    }

    /* Category Breakdown in Story */
    .story-categories {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .story-category-row {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .story-category-icon {
      width: 32px;
      height: 32px;
      border-radius: var(--radius-md);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
    }
    .story-category-info {
      flex: 1;
    }
    .story-category-name {
      font-size: 13px;
      font-weight: 600;
      color: var(--text-primary);
    }
    .story-category-count {
      font-size: 11px;
      color: var(--text-tertiary);
    }
    .story-category-amount {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-primary);
    }

    /* ============================================
       CATEGORY GROUPS (Story 14.15c / 14.16)
       Semantic grouping with background colors

       Updated 2026-01: Full support for:
       - Transaction Categories (StoreCategory - 32 values)
       - Transaction Groups (StoreCategoryGroup - 8 groups)
       - Item Categories (ItemCategory - 37 values)
       - Item Groups (ItemCategoryGroup - 7 groups)
       ============================================ */

    /* Category Group Container */
    .category-group {
      border-radius: var(--radius-md);
      overflow: hidden;
      margin-bottom: 8px;
    }

    /* Category Group Header */
    .category-group-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 12px;
      font-family: var(--font-family);
    }
    .category-group-header-left {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .category-group-emoji {
      font-size: 16px;
    }
    .category-group-name {
      font-family: var(--font-family);
      font-size: 13px;
      font-weight: 600;
    }
    .category-group-amount {
      font-family: var(--font-family);
      font-size: 14px;
      font-weight: 700;
    }

    /* Category Group Items */
    .category-group-items {
      padding: 0 12px 12px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    /* Individual Category in Group */
    .category-group-item {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 10px;
      border-radius: var(--radius-sm);
      background: rgba(255,255,255,0.5);
      font-family: var(--font-family);
    }
    .category-group-item-icon {
      width: 24px;
      height: 24px;
      border-radius: var(--radius-sm);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
    }
    .category-group-item-info {
      flex: 1;
    }
    .category-group-item-name {
      font-family: var(--font-family);
      font-size: 12px;
      font-weight: 500;
      color: var(--text-primary);
    }
    .category-group-item-count {
      font-family: var(--font-family);
      font-size: 10px;
      color: var(--text-tertiary);
    }
    .category-group-item-amount {
      font-family: var(--font-family);
      font-size: 12px;
      font-weight: 600;
      color: var(--text-primary);
    }

    /* ============================================
       STORE CATEGORY GROUPS (Transaction Level)
       8 groups: food-dining, health-wellness,
       retail-general, retail-specialty, automotive,
       services, hospitality, other
       ============================================ */

    /* Food & Dining Group */
    .category-group.food-dining {
      background: #fef3c7; /* Warm yellow */
    }
    .category-group.food-dining .category-group-name,
    .category-group.food-dining .category-group-amount {
      color: #92400e;
    }

    /* Health & Wellness Group */
    .category-group.health-wellness {
      background: #fce7f3; /* Pink */
    }
    .category-group.health-wellness .category-group-name,
    .category-group.health-wellness .category-group-amount {
      color: #9d174d;
    }

    /* Retail General Group */
    .category-group.retail-general {
      background: #ccfbf1; /* Teal */
    }
    .category-group.retail-general .category-group-name,
    .category-group.retail-general .category-group-amount {
      color: #0f766e;
    }

    /* Retail Specialty Group */
    .category-group.retail-specialty {
      background: #ede9fe; /* Purple */
    }
    .category-group.retail-specialty .category-group-name,
    .category-group.retail-specialty .category-group-amount {
      color: #5b21b6;
    }

    /* Automotive Group */
    .category-group.automotive {
      background: #f3f4f6; /* Gray */
    }
    .category-group.automotive .category-group-name,
    .category-group.automotive .category-group-amount {
      color: #374151;
    }
    /* Alias for backward compatibility */
    .category-group.transport-auto {
      background: #dbeafe; /* Blue */
    }
    .category-group.transport-auto .category-group-name,
    .category-group.transport-auto .category-group-amount {
      color: #1e40af;
    }

    /* Services Group */
    .category-group.services {
      background: #dbeafe; /* Blue */
    }
    .category-group.services .category-group-name,
    .category-group.services .category-group-amount {
      color: #1e40af;
    }

    /* Hospitality Group */
    .category-group.hospitality {
      background: #f5f3ff; /* Light purple */
    }
    .category-group.hospitality .category-group-name,
    .category-group.hospitality .category-group-amount {
      color: #7c3aed;
    }
    /* Alias for backward compatibility */
    .category-group.entertainment-leisure {
      background: #ede9fe; /* Purple */
    }
    .category-group.entertainment-leisure .category-group-name,
    .category-group.entertainment-leisure .category-group-amount {
      color: #5b21b6;
    }

    /* Other Group (Store) */
    .category-group.other-store {
      background: #d1fae5; /* Green */
    }
    .category-group.other-store .category-group-name,
    .category-group.other-store .category-group-amount {
      color: #047857;
    }

    /* Legacy aliases */
    .category-group.home-living {
      background: #d1fae5; /* Green */
    }
    .category-group.home-living .category-group-name,
    .category-group.home-living .category-group-amount {
      color: #065f46;
    }
    .category-group.shopping-retail {
      background: #fee2e2; /* Red/Coral */
    }
    .category-group.shopping-retail .category-group-name,
    .category-group.shopping-retail .category-group-amount {
      color: #991b1b;
    }

    /* ============================================
       ITEM CATEGORY GROUPS (Line Item Level)
       7 groups: food-fresh, food-packaged,
       health-personal, household, nonfood-retail,
       services-fees, other-item
       ============================================ */

    /* Food Fresh Group */
    .item-group.food-fresh {
      background: #dcfce7; /* Light green */
    }
    .item-group.food-fresh .category-group-name,
    .item-group.food-fresh .category-group-amount {
      color: #15803d;
    }

    /* Food Packaged Group */
    .item-group.food-packaged {
      background: #fef3c7; /* Yellow/amber */
    }
    .item-group.food-packaged .category-group-name,
    .item-group.food-packaged .category-group-amount {
      color: #92400e;
    }

    /* Health & Personal Group */
    .item-group.health-personal {
      background: #fae8ff; /* Light magenta */
    }
    .item-group.health-personal .category-group-name,
    .item-group.health-personal .category-group-amount {
      color: #a21caf;
    }

    /* Household Group */
    .item-group.household {
      background: #ccfbf1; /* Teal */
    }
    .item-group.household .category-group-name,
    .item-group.household .category-group-amount {
      color: #0f766e;
    }

    /* Non-Food Retail Group */
    .item-group.nonfood-retail {
      background: #dbeafe; /* Blue */
    }
    .item-group.nonfood-retail .category-group-name,
    .item-group.nonfood-retail .category-group-amount {
      color: #1e40af;
    }

    /* Services & Fees Group */
    .item-group.services-fees {
      background: #f1f5f9; /* Slate */
    }
    .item-group.services-fees .category-group-name,
    .item-group.services-fees .category-group-amount {
      color: #64748b;
    }

    /* Other Item Group */
    .item-group.other-item {
      background: #f1f5f9; /* Slate */
    }
    .item-group.other-item .category-group-name,
    .item-group.other-item .category-group-amount {
      color: #64748b;
    }

    /* ============================================
       USER-DEFINED TRANSACTION GROUPS
       Custom groups created by users with
       user-defined colors
       ============================================ */

    .user-group {
      border-radius: var(--radius-md);
      overflow: hidden;
      margin-bottom: 8px;
      border-left: 4px solid var(--group-color, var(--primary));
    }
    .user-group .category-group-header {
      background: color-mix(in srgb, var(--group-color, var(--primary)) 15%, var(--bg-secondary) 85%);
    }
    .user-group .category-group-name,
    .user-group .category-group-amount {
      color: var(--text-primary);
    }
    .user-group .category-group-items {
      background: color-mix(in srgb, var(--group-color, var(--primary)) 8%, var(--bg-secondary) 92%);
    }

    /* Section Divider for Reports */
    .report-section-divider {
      height: 1px;
      background: var(--border-light);
      margin: 16px 0;
    }

    /* Section Title for Report Breakdown */
    .report-section-title {
      font-family: var(--font-family);
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: var(--text-tertiary);
      margin: 16px 0 8px;
    }

    /* Report Content - Scrollable */
    .report-content-scroll {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    /* Bottom Nav */
    .bottom-nav {
      display: flex;
      align-items: flex-end;
      justify-content: space-around;
      padding: 8px 12px 24px;
      background: var(--bg-secondary);
      border-top: 1px solid var(--border-light);
    }
    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      padding: 6px 10px;
      cursor: pointer;
    }
    .nav-item svg {
      width: 24px; height: 24px;
      stroke: var(--text-tertiary);
      fill: none;
      stroke-width: 1.8;
    }
    .nav-item span {
      font-size: 10px;
      color: var(--text-tertiary);
      font-weight: 500;
    }
    .nav-item.active svg { stroke: var(--primary); }
    .nav-item.active span { color: var(--primary); font-weight: 600; }
    .scan-center { margin-top: -56px; padding: 0; }
    .scan-btn {
      width: 52px; height: 52px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-hover) 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.25);
      cursor: pointer;
      transition: background 300ms ease;
    }
    .scan-btn svg {
      width: 24px; height: 24px;
      stroke: white;
      fill: none;
      stroke-width: 2;
    }

    /* Reduced Motion */
    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
    }
  </style>
</head>
<body data-theme="mono" data-font="outfit">
  <div class="page-wrapper">
    <div class="phone-frame">
    <div class="phone-screen">
      <!-- Status Bar -->
      <div class="status-bar">
        <span class="status-time">9:41</span>
        <div class="status-icons">
          <svg viewBox="0 0 24 24"><path d="M18 10a6 6 0 0 0-12 0c0 7 6 13 6 13s6-6 6-13z"/></svg>
          <svg viewBox="0 0 24 24"><path d="M5 12.55a11 11 0 0 1 14.08 0M8.53 16.11a6 6 0 0 1 6.95 0M12 20h.01"/></svg>
          <svg viewBox="0 0 24 24"><rect x="2" y="7" width="18" height="10" rx="2"/><path d="M22 11v2"/></svg>
        </div>
      </div>

      <!-- Back Header (Subsection Navigation) -->
      <div class="back-header">
        <svg class="back-arrow" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="var(--text-primary)" stroke-width="2" onclick="goBack()">
          <path d="M15 18l-6-6 6-6"/>
        </svg>
        <h2 class="back-title">Resumen</h2>
      </div>

      <!-- Main Content -->
      <div class="main-content">

        <!-- Weekly Section (Expanded - has reports) -->
        <div class="report-section" id="section-weekly">
          <div class="report-section-header" onclick="toggleSection('weekly')">
            <div class="report-section-left">
              <svg class="section-chevron" viewBox="0 0 24 24"><path d="m6 9 6 6 6-6"/></svg>
              <span class="section-title">Semanal</span>
            </div>
            <div class="time-selector" onclick="event.stopPropagation()">
              <button class="time-arrow" onclick="prevTime('weekly')">
                <svg viewBox="0 0 24 24"><path d="M15 18l-6-6 6-6"/></svg>
              </button>
              <span class="time-value" id="time-weekly">Diciembre</span>
              <button class="time-arrow" onclick="nextTime('weekly')">
                <svg viewBox="0 0 24 24"><path d="M9 18l6-6-6-6"/></svg>
              </button>
            </div>
          </div>
          <div class="report-cards">
            <!-- Unread Report with Transaction Count Badge -->
            <div class="report-card weekly unread" onclick="openReport('weekly', 'S23')">
              <div class="unread-dot"></div>
              <div class="report-logo"><span>G</span></div>
              <div class="report-content">
                <div class="report-title">
                  <span>Semana 23</span>
                  <span class="tx-count-badge">
                    <svg viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><path d="M14 2v6h6"/><path d="M16 13H8"/><path d="M16 17H8"/><path d="M10 9H8"/></svg>
                    12
                  </span>
                </div>
                <div class="report-meta">
                  <span class="report-amount">$45.200</span>
                  <span class="report-trend up">
                    <svg viewBox="0 0 24 24"><polyline points="18 15 12 9 6 15"/></svg>
                    +8% vs S22
                  </span>
                </div>
              </div>
            </div>
            <!-- Read Report with Transaction Count Badge -->
            <div class="report-card weekly read" onclick="openReport('weekly', 'S22')">
              <div class="unread-dot"></div>
              <div class="report-logo"><span>G</span></div>
              <div class="report-content">
                <div class="report-title">
                  <span>Semana 22</span>
                  <span class="tx-count-badge">
                    <svg viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><path d="M14 2v6h6"/><path d="M16 13H8"/><path d="M16 17H8"/><path d="M10 9H8"/></svg>
                    11
                  </span>
                </div>
                <div class="report-meta">
                  <span class="report-amount">$42.000</span>
                  <span class="report-trend down">
                    <svg viewBox="0 0 24 24"><polyline points="6 9 12 15 18 9"/></svg>
                    -3% vs S21
                  </span>
                </div>
              </div>
            </div>
            <!-- First Report with Transaction Count Badge -->
            <div class="report-card weekly read" onclick="openReport('weekly', 'S21')">
              <div class="unread-dot"></div>
              <div class="report-logo"><span>G</span></div>
              <div class="report-content">
                <div class="report-title">
                  <span>Semana 21</span>
                  <span class="tx-count-badge">
                    <svg viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><path d="M14 2v6h6"/><path d="M16 13H8"/><path d="M16 17H8"/><path d="M10 9H8"/></svg>
                    8
                  </span>
                </div>
                <div class="report-meta">
                  <span class="report-amount">$38.500</span>
                  <span class="report-first">· Tu primera semana</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Monthly Section (Expanded - has reports) -->
        <div class="report-section" id="section-monthly">
          <div class="report-section-header" onclick="toggleSection('monthly')">
            <div class="report-section-left">
              <svg class="section-chevron" viewBox="0 0 24 24"><path d="m6 9 6 6 6-6"/></svg>
              <span class="section-title">Mensual</span>
            </div>
            <div class="time-selector" onclick="event.stopPropagation()">
              <button class="time-arrow" onclick="prevTime('monthly')">
                <svg viewBox="0 0 24 24"><path d="M15 18l-6-6 6-6"/></svg>
              </button>
              <span class="time-value" id="time-monthly">Diciembre</span>
              <button class="time-arrow" onclick="nextTime('monthly')">
                <svg viewBox="0 0 24 24"><path d="M9 18l6-6-6-6"/></svg>
              </button>
            </div>
          </div>
          <div class="report-cards">
            <!-- Unread Report -->
            <div class="report-card monthly unread" onclick="openReport('monthly', 'Dic')">
              <div class="unread-dot"></div>
              <div class="report-logo"><span>G</span></div>
              <div class="report-content">
                <div class="report-title">Diciembre</div>
                <div class="report-meta">
                  <span class="report-amount">$185.400</span>
                  <span class="report-trend up">
                    <svg viewBox="0 0 24 24"><polyline points="18 15 12 9 6 15"/></svg>
                    +12% vs Nov
                  </span>
                </div>
              </div>
            </div>
            <!-- Read Report -->
            <div class="report-card monthly read" onclick="openReport('monthly', 'Nov')">
              <div class="unread-dot"></div>
              <div class="report-logo"><span>G</span></div>
              <div class="report-content">
                <div class="report-title">Noviembre</div>
                <div class="report-meta">
                  <span class="report-amount">$165.200</span>
                  <span class="report-trend down">
                    <svg viewBox="0 0 24 24"><polyline points="6 9 12 15 18 9"/></svg>
                    -5% vs Oct
                  </span>
                </div>
              </div>
            </div>
            <!-- First Report -->
            <div class="report-card monthly read" onclick="openReport('monthly', 'Oct')">
              <div class="unread-dot"></div>
              <div class="report-logo"><span>G</span></div>
              <div class="report-content">
                <div class="report-title">Octubre</div>
                <div class="report-meta">
                  <span class="report-amount">$174.000</span>
                  <span class="report-first">· Tu primer mes</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Quarterly Section (Expanded - has reports with persona hooks) -->
        <div class="report-section" id="section-quarterly">
          <div class="report-section-header" onclick="toggleSection('quarterly')">
            <div class="report-section-left">
              <svg class="section-chevron" viewBox="0 0 24 24"><path d="m6 9 6 6 6-6"/></svg>
              <span class="section-title">Trimestral</span>
            </div>
            <div class="time-selector" onclick="event.stopPropagation()">
              <button class="time-arrow" onclick="prevTime('quarterly')">
                <svg viewBox="0 0 24 24"><path d="M15 18l-6-6 6-6"/></svg>
              </button>
              <span class="time-value" id="time-quarterly">Q4 2025</span>
              <button class="time-arrow" onclick="nextTime('quarterly')">
                <svg viewBox="0 0 24 24"><path d="M9 18l6-6-6-6"/></svg>
              </button>
            </div>
          </div>
          <div class="report-cards">
            <!-- Quarterly Report with Persona Hook -->
            <div class="report-card quarterly unread" onclick="openReport('quarterly', 'Q4')">
              <div class="unread-dot"></div>
              <div class="report-logo"><span>G</span></div>
              <div class="report-content">
                <div class="report-title">Q4 2025</div>
                <div class="report-meta">
                  <span class="report-amount">$524.600</span>
                  <span class="report-trend up">
                    <svg viewBox="0 0 24 24"><polyline points="18 15 12 9 6 15"/></svg>
                    +15% vs Q3
                  </span>
                </div>
                <div class="report-hook">"Descubre qué categoría dominó tu trimestre"</div>
              </div>
            </div>
            <!-- First Quarter Report -->
            <div class="report-card quarterly read" onclick="openReport('quarterly', 'Q3')">
              <div class="unread-dot"></div>
              <div class="report-logo"><span>G</span></div>
              <div class="report-content">
                <div class="report-title">Q3 2025</div>
                <div class="report-meta">
                  <span class="report-amount">$456.200</span>
                  <span class="report-first">· Tu primer trimestre</span>
                </div>
                <div class="report-hook">"Tu historia financiera comienza aquí"</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Yearly Section (Expanded - has reports with persona hooks) -->
        <div class="report-section" id="section-yearly">
          <div class="report-section-header" onclick="toggleSection('yearly')">
            <div class="report-section-left">
              <svg class="section-chevron" viewBox="0 0 24 24"><path d="m6 9 6 6 6-6"/></svg>
              <span class="section-title">Anual</span>
            </div>
            <div class="time-selector" onclick="event.stopPropagation()">
              <button class="time-arrow" onclick="prevTime('yearly')">
                <svg viewBox="0 0 24 24"><path d="M15 18l-6-6 6-6"/></svg>
              </button>
              <span class="time-value" id="time-yearly">2025</span>
              <button class="time-arrow" onclick="nextTime('yearly')">
                <svg viewBox="0 0 24 24"><path d="M9 18l6-6-6-6"/></svg>
              </button>
            </div>
          </div>
          <div class="report-cards">
            <!-- Yearly Report with Persona Hook -->
            <div class="report-card yearly unread" onclick="openReport('yearly', '2025')">
              <div class="unread-dot"></div>
              <div class="report-logo"><span>G</span></div>
              <div class="report-content">
                <div class="report-title">2025</div>
                <div class="report-meta">
                  <span class="report-amount">$2.145.800</span>
                  <span class="report-first">· Tu primer año completo</span>
                </div>
                <div class="report-hook">"Un año de decisiones financieras inteligentes"</div>
              </div>
            </div>
          </div>
        </div>

      </div>

      <!-- Report Overlay (Story-Style Content) -->
      <div class="report-overlay" id="reportOverlay">
        <!-- Overlay Header -->
        <div class="overlay-header">
          <div class="overlay-back" onclick="closeReport()">
            <svg viewBox="0 0 24 24"><path d="M15 18l-6-6 6-6"/></svg>
            <span class="overlay-title" id="overlayTitle">Semana 23</span>
          </div>
          <button class="overlay-close" onclick="closeReport()">
            <svg viewBox="0 0 24 24"><path d="M18 6L6 18"/><path d="M6 6l12 12"/></svg>
          </button>
        </div>

        <!-- Report Content - Scrollable -->
        <div class="report-content-scroll" id="reportContentScroll">
          <!-- Content is dynamically loaded -->
        </div>
      </div>

      <!-- Bottom Nav -->
      <nav class="bottom-nav" role="navigation" aria-label="Navegación principal">
        <div class="nav-item">
          <svg viewBox="0 0 24 24"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/></svg>
          <span>Inicio</span>
        </div>
        <div class="nav-item active">
          <svg viewBox="0 0 24 24"><path d="M3 3v18h18"/><path d="m19 9-5 5-4-4-3 3"/></svg>
          <span>Analíticas</span>
        </div>
        <div class="scan-center">
          <div class="scan-btn">
            <svg viewBox="0 0 24 24">
              <path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"/>
              <circle cx="12" cy="13" r="3"/>
            </svg>
          </div>
        </div>
        <div class="nav-item">
          <svg viewBox="0 0 24 24"><path d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/></svg>
          <span>Ideas</span>
        </div>
        <div class="nav-item" style="position: relative;">
          <svg viewBox="0 0 24 24"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>
          <!-- Notification badge -->
          <div style="position: absolute; top: 2px; right: 8px; min-width: 16px; height: 16px; background: var(--error); border-radius: var(--radius-full); display: flex; align-items: center; justify-content: center; font-size: 10px; font-weight: 600; color: white; border: 2px solid var(--bg-secondary);">4</div>
          <span>Alertas</span>
        </div>
      </nav>
    </div>
  </div>

  <!-- Global Controls Panel - Below Phone -->
  <div class="global-controls">
    <div class="control-group">
      <div class="control-label">Theme</div>
      <div class="control-options">
        <div class="theme-swatch" data-theme="professional" title="Professional Blue" onclick="setTheme('professional', this)"></div>
        <div class="theme-swatch active" data-theme="mono" title="Mono" onclick="setTheme('mono', this)"></div>
        <div class="theme-swatch" data-theme="ninokuni" title="Ni No Kuni" onclick="setTheme('ninokuni', this)"></div>
      </div>
    </div>
    <div class="control-group">
      <div class="control-label">Mode</div>
      <div class="control-options">
        <button class="mode-toggle" id="darkModeToggle" onclick="toggleDarkMode(this)">
          <svg viewBox="0 0 24 24"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
          Dark
        </button>
      </div>
    </div>
    <div class="control-group">
      <div class="control-label">Font</div>
      <div class="control-options">
        <div class="font-pill active" data-font="outfit" onclick="setFont('outfit', this)">Outfit</div>
        <div class="font-pill" data-font="space" onclick="setFont('space', this)">Space</div>
      </div>
    </div>
  </div>
  </div><!-- end page-wrapper -->

  <script>
    // Toggle section collapse/expand
    function toggleSection(sectionId) {
      const section = document.getElementById('section-' + sectionId);
      section.classList.toggle('collapsed');
    }

    // Time navigation (mock functionality)
    function prevTime(sectionId) {
      console.log('Previous time for', sectionId);
    }
    function nextTime(sectionId) {
      console.log('Next time for', sectionId);
    }

    // Go back to Analytics
    function goBack() {
      console.log('Navigating back to Analytics');
      // Would navigate to analytics.html
    }

    // ============================================================================
    // DATA MODEL - 2026-01 Update
    // Full support for:
    // - Transaction Categories (StoreCategory - 32 values)
    // - Transaction Groups (StoreCategoryGroup - 8 groups)
    // - Item Categories (ItemCategory - 37 values)
    // - Item Groups (ItemCategoryGroup - 7 groups)
    // - User-defined Transaction Groups (custom groups with colors)
    // ============================================================================

    // Store Category Group mappings (8 groups)
    const STORE_CATEGORY_GROUPS = {
      'food-dining': {
        name: { en: 'Food & Dining', es: 'Alimentación' },
        emoji: '🍽️',
        categories: ['Supermarket', 'Restaurant', 'Bakery', 'Butcher', 'StreetVendor']
      },
      'health-wellness': {
        name: { en: 'Health & Wellness', es: 'Salud y Bienestar' },
        emoji: '💊',
        categories: ['Pharmacy', 'Medical', 'Veterinary', 'HealthBeauty']
      },
      'retail-general': {
        name: { en: 'General Retail', es: 'Tiendas General' },
        emoji: '🛒',
        categories: ['Bazaar', 'Clothing', 'Electronics', 'HomeGoods', 'Furniture', 'Hardware', 'GardenCenter']
      },
      'retail-specialty': {
        name: { en: 'Specialty Retail', es: 'Tiendas Especializadas' },
        emoji: '🎁',
        categories: ['PetShop', 'BooksMedia', 'OfficeSupplies', 'SportsOutdoors', 'ToysGames', 'Jewelry', 'Optical', 'MusicStore']
      },
      'automotive': {
        name: { en: 'Automotive', es: 'Automotriz' },
        emoji: '⛽',
        categories: ['Automotive', 'GasStation', 'Transport']
      },
      'services': {
        name: { en: 'Services', es: 'Servicios' },
        emoji: '🏢',
        categories: ['Services', 'BankingFinance', 'Education', 'TravelAgency', 'Subscription', 'Government']
      },
      'hospitality': {
        name: { en: 'Hospitality', es: 'Hospitalidad' },
        emoji: '🏨',
        categories: ['HotelLodging', 'Entertainment', 'Gambling']
      },
      'other': {
        name: { en: 'Other', es: 'Otros' },
        emoji: '📦',
        categories: ['CharityDonation', 'Other']
      }
    };

    // Item Category Group mappings (7 groups)
    const ITEM_CATEGORY_GROUPS = {
      'food-fresh': {
        name: { en: 'Food - Fresh', es: 'Alimentos Frescos' },
        emoji: '🥬',
        categories: ['Produce', 'Meat & Seafood', 'Bakery', 'Dairy & Eggs']
      },
      'food-packaged': {
        name: { en: 'Food - Packaged', es: 'Alimentos Envasados' },
        emoji: '🥫',
        categories: ['Pantry', 'Frozen Foods', 'Snacks', 'Beverages', 'Alcohol', 'Prepared Food']
      },
      'health-personal': {
        name: { en: 'Health & Personal', es: 'Salud y Personal' },
        emoji: '💄',
        categories: ['Health & Beauty', 'Personal Care', 'Pharmacy', 'Supplements', 'Baby Products']
      },
      'household': {
        name: { en: 'Household', es: 'Hogar' },
        emoji: '🏠',
        categories: ['Cleaning Supplies', 'Household', 'Pet Supplies']
      },
      'nonfood-retail': {
        name: { en: 'Non-Food Retail', es: 'Retail No Alimentario' },
        emoji: '🛍️',
        categories: ['Clothing', 'Electronics', 'Hardware', 'Garden', 'Automotive', 'Sports & Outdoors', 'Toys & Games', 'Books & Media', 'Office & Stationery', 'Crafts & Hobbies', 'Furniture', 'Musical Instruments']
      },
      'services-fees': {
        name: { en: 'Services & Fees', es: 'Servicios y Cargos' },
        emoji: '📋',
        categories: ['Service', 'Tax & Fees', 'Subscription', 'Insurance', 'Loan Payment', 'Tickets & Events', 'Tobacco', 'Gambling']
      },
      'other-item': {
        name: { en: 'Other', es: 'Otros' },
        emoji: '📦',
        categories: ['Other']
      }
    };

    // Category emoji mappings for display
    const CATEGORY_EMOJIS = {
      // Store Categories
      'Supermarket': '🛒', 'Restaurant': '🍔', 'Bakery': '🥖', 'Butcher': '🥩', 'StreetVendor': '🌮',
      'Pharmacy': '💊', 'Medical': '🏥', 'Veterinary': '🐾', 'HealthBeauty': '💄',
      'Bazaar': '🏪', 'Clothing': '👕', 'Electronics': '📱', 'HomeGoods': '🏠', 'Furniture': '🛋️',
      'Hardware': '🔧', 'GardenCenter': '🌱', 'PetShop': '🐕', 'BooksMedia': '📚',
      'OfficeSupplies': '📎', 'SportsOutdoors': '⚽', 'ToysGames': '🎮', 'Jewelry': '💎',
      'Optical': '👓', 'MusicStore': '🎵', 'Automotive': '🔧', 'GasStation': '⛽', 'Transport': '🚌',
      'Services': '🏢', 'BankingFinance': '🏦', 'Education': '🎓', 'TravelAgency': '✈️',
      'Subscription': '📱', 'Government': '🏛️', 'HotelLodging': '🏨', 'Entertainment': '🎬',
      'Gambling': '🎰', 'CharityDonation': '❤️', 'Other': '📦',
      // Item Categories
      'Produce': '🥬', 'Meat & Seafood': '🥩', 'Dairy & Eggs': '🥛', 'Pantry': '🥫',
      'Frozen Foods': '🧊', 'Snacks': '🍿', 'Beverages': '🥤', 'Alcohol': '🍷',
      'Prepared Food': '🍱', 'Health & Beauty': '💄', 'Personal Care': '🧴',
      'Supplements': '💪', 'Baby Products': '👶', 'Cleaning Supplies': '🧹',
      'Household': '🏠', 'Pet Supplies': '🐕', 'Garden': '🌱',
      'Sports & Outdoors': '⚽', 'Toys & Games': '🎮', 'Books & Media': '📚',
      'Office & Stationery': '📎', 'Crafts & Hobbies': '🎨', 'Musical Instruments': '🎸',
      'Service': '🏢', 'Tax & Fees': '📋', 'Insurance': '🛡️', 'Loan Payment': '💳',
      'Tickets & Events': '🎟️', 'Tobacco': '🚬'
    };

    // Report content templates with full temporal context
    // Story 14.16: Updated with transaction groups, item groups, and user groups
    const reportContent = {
      weekly: {
        S23: {
          title: 'Semana 23',
          fullTitle: 'Semana 23 · Diciembre · Q4 2025',
          amount: '$45.200',
          trend: '+8%',
          trendDirection: 'up',
          transactionCount: 12,

          // View Mode 1: Transaction Categories (StoreCategory - flat list)
          transactionCategories: [
            { key: 'Supermarket', name: 'Supermercado', count: '5 compras', amount: '$22.500' },
            { key: 'Restaurant', name: 'Restaurantes', count: '3 compras', amount: '$12.800' },
            { key: 'GasStation', name: 'Bencinera', count: '2 compras', amount: '$6.500' },
            { key: 'Transport', name: 'Transporte', count: '2 compras', amount: '$3.400' }
          ],

          // View Mode 2: Transaction Groups (StoreCategoryGroup - grouped)
          transactionGroups: [
            {
              key: 'food-dining',
              name: 'Alimentación',
              emoji: '🍽️',
              cssClass: 'food-dining',
              totalAmount: '$35.300',
              categories: [
                { key: 'Supermarket', name: 'Supermercado', count: '5 compras', amount: '$22.500' },
                { key: 'Restaurant', name: 'Restaurantes', count: '3 compras', amount: '$12.800' }
              ]
            },
            {
              key: 'automotive',
              name: 'Automotriz',
              emoji: '⛽',
              cssClass: 'automotive',
              totalAmount: '$9.900',
              categories: [
                { key: 'GasStation', name: 'Bencinera', count: '2 compras', amount: '$6.500' },
                { key: 'Transport', name: 'Transporte', count: '2 compras', amount: '$3.400' }
              ]
            }
          ],

          // View Mode 3: Item Categories (ItemCategory - flat list)
          itemCategories: [
            { key: 'Produce', name: 'Frutas y Verduras', count: '8 items', amount: '$8.200' },
            { key: 'Meat & Seafood', name: 'Carnes y Mariscos', count: '4 items', amount: '$12.100' },
            { key: 'Dairy & Eggs', name: 'Lácteos y Huevos', count: '6 items', amount: '$4.800' },
            { key: 'Pantry', name: 'Despensa', count: '5 items', amount: '$6.500' },
            { key: 'Beverages', name: 'Bebidas', count: '4 items', amount: '$3.200' },
            { key: 'Prepared Food', name: 'Comida Preparada', count: '3 items', amount: '$10.400' }
          ],

          // View Mode 4: Item Groups (ItemCategoryGroup - grouped)
          itemGroups: [
            {
              key: 'food-fresh',
              name: 'Alimentos Frescos',
              emoji: '🥬',
              cssClass: 'food-fresh',
              totalAmount: '$25.100',
              categories: [
                { key: 'Produce', name: 'Frutas y Verduras', count: '8 items', amount: '$8.200' },
                { key: 'Meat & Seafood', name: 'Carnes y Mariscos', count: '4 items', amount: '$12.100' },
                { key: 'Dairy & Eggs', name: 'Lácteos y Huevos', count: '6 items', amount: '$4.800' }
              ]
            },
            {
              key: 'food-packaged',
              name: 'Alimentos Envasados',
              emoji: '🥫',
              cssClass: 'food-packaged',
              totalAmount: '$20.100',
              categories: [
                { key: 'Pantry', name: 'Despensa', count: '5 items', amount: '$6.500' },
                { key: 'Beverages', name: 'Bebidas', count: '4 items', amount: '$3.200' },
                { key: 'Prepared Food', name: 'Comida Preparada', count: '3 items', amount: '$10.400' }
              ]
            }
          ],

          // View Mode 5: User-Defined Transaction Groups
          userGroups: [
            {
              id: 'christmas-2025',
              name: '🎄 Navidad 2025',
              color: '#ef4444',
              totalAmount: '$18.500',
              transactionCount: 4,
              transactions: [
                { merchant: 'Jumbo', amount: '$12.500', date: '22 dic' },
                { merchant: 'Casa Ideas', amount: '$6.000', date: '21 dic' }
              ]
            },
            {
              id: 'trip-valparaiso',
              name: '🚗 Viaje Valparaíso',
              color: '#3b82f6',
              totalAmount: '$9.900',
              transactionCount: 3,
              transactions: [
                { merchant: 'Copec', amount: '$6.500', date: '20 dic' },
                { merchant: 'Peaje Costanera', amount: '$3.400', date: '20 dic' }
              ]
            }
          ],

          // Legacy: Keep categoryGroups for backward compatibility
          categoryGroups: [
            {
              name: 'Alimentación',
              emoji: '🍽️',
              cssClass: 'food-dining',
              totalAmount: '$35.300',
              items: [
                { icon: '🛒', name: 'Supermercado', count: '5 compras', amount: '$22.500' },
                { icon: '🍔', name: 'Restaurantes', count: '3 compras', amount: '$12.800' }
              ]
            },
            {
              name: 'Transporte',
              emoji: '🚗',
              cssClass: 'transport-auto',
              totalAmount: '$9.900',
              items: [
                { icon: '⛽', name: 'Gasolinera', count: '2 compras', amount: '$6.500' },
                { icon: '🚌', name: 'Transporte público', count: '2 compras', amount: '$3.400' }
              ]
            }
          ]
        },
        S22: {
          title: 'Semana 22',
          fullTitle: 'Semana 22 · Diciembre · Q4 2025',
          amount: '$42.000',
          trend: '-3%',
          trendDirection: 'down',
          transactionCount: 11,
          transactionGroups: [
            {
              key: 'food-dining',
              name: 'Alimentación',
              emoji: '🍽️',
              cssClass: 'food-dining',
              totalAmount: '$31.300',
              categories: [
                { key: 'Supermarket', name: 'Supermercado', count: '4 compras', amount: '$20.100' },
                { key: 'Restaurant', name: 'Restaurantes', count: '2 compras', amount: '$11.200' }
              ]
            },
            {
              key: 'automotive',
              name: 'Automotriz',
              emoji: '⛽',
              cssClass: 'automotive',
              totalAmount: '$10.700',
              categories: [
                { key: 'GasStation', name: 'Bencinera', count: '3 compras', amount: '$7.200' },
                { key: 'Transport', name: 'Transporte', count: '2 compras', amount: '$3.500' }
              ]
            }
          ],
          categories: [
            { icon: '🛒', name: 'Supermercado', count: '4 compras', amount: '$20.100', color: 'var(--primary-light)' },
            { icon: '🍔', name: 'Restaurantes', count: '2 compras', amount: '$11.200', color: '#fef3c7' },
            { icon: '🚗', name: 'Transporte', count: '5 compras', amount: '$10.700', color: '#dbeafe' }
          ]
        },
        S21: {
          title: 'Semana 21',
          fullTitle: 'Semana 21 · Diciembre · Q4 2025',
          amount: '$38.500',
          trend: null,
          trendDirection: null,
          isFirst: true,
          transactionCount: 8,
          transactionGroups: [
            {
              key: 'food-dining',
              name: 'Alimentación',
              emoji: '🍽️',
              cssClass: 'food-dining',
              totalAmount: '$30.500',
              categories: [
                { key: 'Supermarket', name: 'Supermercado', count: '3 compras', amount: '$18.200' },
                { key: 'Restaurant', name: 'Restaurantes', count: '2 compras', amount: '$12.300' }
              ]
            },
            {
              key: 'automotive',
              name: 'Automotriz',
              emoji: '⛽',
              cssClass: 'automotive',
              totalAmount: '$8.000',
              categories: [
                { key: 'GasStation', name: 'Bencinera', count: '2 compras', amount: '$5.200' },
                { key: 'Transport', name: 'Transporte', count: '1 compra', amount: '$2.800' }
              ]
            }
          ],
          categories: [
            { icon: '🛒', name: 'Supermercado', count: '3 compras', amount: '$18.200', color: 'var(--primary-light)' },
            { icon: '🍔', name: 'Restaurantes', count: '2 compras', amount: '$12.300', color: '#fef3c7' },
            { icon: '🚗', name: 'Transporte', count: '3 compras', amount: '$8.000', color: '#dbeafe' }
          ]
        }
      },
      monthly: {
        Dic: {
          title: 'Diciembre',
          fullTitle: 'Diciembre · Q4 2025',
          amount: '$185.400',
          trend: '+12%',
          trendDirection: 'up',
          transactionCount: 48,
          persona: 'Las fiestas se notaron: Restaurantes subió 25% este mes.',

          // Full transaction groups breakdown
          transactionGroups: [
            {
              key: 'food-dining',
              name: 'Alimentación',
              emoji: '🍽️',
              cssClass: 'food-dining',
              totalAmount: '$129.800',
              categories: [
                { key: 'Supermarket', name: 'Supermercado', count: '18 compras', amount: '$74.200' },
                { key: 'Restaurant', name: 'Restaurantes', count: '12 compras', amount: '$55.600' }
              ]
            },
            {
              key: 'automotive',
              name: 'Automotriz',
              emoji: '⛽',
              cssClass: 'automotive',
              totalAmount: '$37.100',
              categories: [
                { key: 'GasStation', name: 'Bencinera', count: '8 compras', amount: '$24.500' },
                { key: 'Transport', name: 'Transporte', count: '7 compras', amount: '$12.600' }
              ]
            },
            {
              key: 'health-wellness',
              name: 'Salud y Bienestar',
              emoji: '💊',
              cssClass: 'health-wellness',
              totalAmount: '$18.500',
              categories: [
                { key: 'Pharmacy', name: 'Farmacia', count: '3 compras', amount: '$18.500' }
              ]
            }
          ],

          // Item groups for monthly detail
          itemGroups: [
            {
              key: 'food-fresh',
              name: 'Alimentos Frescos',
              emoji: '🥬',
              cssClass: 'food-fresh',
              totalAmount: '$52.300',
              categories: [
                { key: 'Produce', name: 'Frutas y Verduras', count: '32 items', amount: '$18.400' },
                { key: 'Meat & Seafood', name: 'Carnes y Mariscos', count: '18 items', amount: '$24.100' },
                { key: 'Dairy & Eggs', name: 'Lácteos y Huevos', count: '22 items', amount: '$9.800' }
              ]
            },
            {
              key: 'food-packaged',
              name: 'Alimentos Envasados',
              emoji: '🥫',
              cssClass: 'food-packaged',
              totalAmount: '$38.200',
              categories: [
                { key: 'Pantry', name: 'Despensa', count: '15 items', amount: '$12.500' },
                { key: 'Beverages', name: 'Bebidas', count: '12 items', amount: '$8.200' },
                { key: 'Alcohol', name: 'Alcohol', count: '6 items', amount: '$17.500' }
              ]
            },
            {
              key: 'health-personal',
              name: 'Salud y Personal',
              emoji: '💄',
              cssClass: 'health-personal',
              totalAmount: '$18.500',
              categories: [
                { key: 'Pharmacy', name: 'Farmacia', count: '4 items', amount: '$14.200' },
                { key: 'Personal Care', name: 'Cuidado Personal', count: '3 items', amount: '$4.300' }
              ]
            }
          ],

          categories: [
            { icon: '🛒', name: 'Supermercado', count: '18 compras', amount: '$74.200', color: 'var(--primary-light)' },
            { icon: '🍔', name: 'Restaurantes', count: '12 compras', amount: '$55.600', color: '#fef3c7' },
            { icon: '🚗', name: 'Transporte', count: '15 compras', amount: '$37.100', color: '#dbeafe' },
            { icon: '💊', name: 'Salud', count: '3 compras', amount: '$18.500', color: '#fce7f3' }
          ]
        },
        Nov: {
          title: 'Noviembre',
          fullTitle: 'Noviembre · Q4 2025',
          amount: '$165.200',
          trend: '-5%',
          trendDirection: 'down',
          transactionCount: 42,
          persona: 'Buen control este mes. Gastaste menos que Octubre.',
          transactionGroups: [
            {
              key: 'food-dining',
              name: 'Alimentación',
              emoji: '🍽️',
              cssClass: 'food-dining',
              totalAmount: '$116.600',
              categories: [
                { key: 'Supermarket', name: 'Supermercado', count: '16 compras', amount: '$68.400' },
                { key: 'Restaurant', name: 'Restaurantes', count: '10 compras', amount: '$48.200' }
              ]
            },
            {
              key: 'automotive',
              name: 'Automotriz',
              emoji: '⛽',
              cssClass: 'automotive',
              totalAmount: '$32.600',
              categories: [
                { key: 'GasStation', name: 'Bencinera', count: '7 compras', amount: '$21.400' },
                { key: 'Transport', name: 'Transporte', count: '5 compras', amount: '$11.200' }
              ]
            },
            {
              key: 'health-wellness',
              name: 'Salud y Bienestar',
              emoji: '💊',
              cssClass: 'health-wellness',
              totalAmount: '$16.000',
              categories: [
                { key: 'Pharmacy', name: 'Farmacia', count: '2 compras', amount: '$16.000' }
              ]
            }
          ],
          categories: [
            { icon: '🛒', name: 'Supermercado', count: '16 compras', amount: '$68.400', color: 'var(--primary-light)' },
            { icon: '🍔', name: 'Restaurantes', count: '10 compras', amount: '$48.200', color: '#fef3c7' },
            { icon: '🚗', name: 'Transporte', count: '12 compras', amount: '$32.600', color: '#dbeafe' },
            { icon: '💊', name: 'Salud', count: '2 compras', amount: '$16.000', color: '#fce7f3' }
          ]
        },
        Oct: {
          title: 'Octubre',
          fullTitle: 'Octubre · Q4 2025',
          amount: '$174.000',
          trend: null,
          trendDirection: null,
          isFirst: true,
          transactionCount: 44,
          persona: 'Tu primer mes completo con Gastify.',
          transactionGroups: [
            {
              key: 'food-dining',
              name: 'Alimentación',
              emoji: '🍽️',
              cssClass: 'food-dining',
              totalAmount: '$122.800',
              categories: [
                { key: 'Supermarket', name: 'Supermercado', count: '15 compras', amount: '$70.800' },
                { key: 'Restaurant', name: 'Restaurantes', count: '11 compras', amount: '$52.000' }
              ]
            },
            {
              key: 'automotive',
              name: 'Automotriz',
              emoji: '⛽',
              cssClass: 'automotive',
              totalAmount: '$35.200',
              categories: [
                { key: 'GasStation', name: 'Bencinera', count: '8 compras', amount: '$23.200' },
                { key: 'Transport', name: 'Transporte', count: '6 compras', amount: '$12.000' }
              ]
            },
            {
              key: 'health-wellness',
              name: 'Salud y Bienestar',
              emoji: '💊',
              cssClass: 'health-wellness',
              totalAmount: '$16.000',
              categories: [
                { key: 'Pharmacy', name: 'Farmacia', count: '2 compras', amount: '$16.000' }
              ]
            }
          ],
          categories: [
            { icon: '🛒', name: 'Supermercado', count: '15 compras', amount: '$70.800', color: 'var(--primary-light)' },
            { icon: '🍔', name: 'Restaurantes', count: '11 compras', amount: '$52.000', color: '#fef3c7' },
            { icon: '🚗', name: 'Transporte', count: '14 compras', amount: '$35.200', color: '#dbeafe' },
            { icon: '💊', name: 'Salud', count: '2 compras', amount: '$16.000', color: '#fce7f3' }
          ]
        }
      },
      quarterly: {
        Q4: {
          title: 'Q4',
          fullTitle: 'Q4 · 2025',
          amount: '$524.600',
          trend: '+15%',
          trendDirection: 'up',
          transactionCount: 134,
          persona: 'Este trimestre, Supermercado fue tu categoría estrella con 40% del gasto total. Las fiestas de fin de año impulsaron Restaurantes.',
          highlights: [
            { label: 'Mes más alto', value: 'Diciembre · $185.400' },
            { label: 'Mes más bajo', value: 'Noviembre · $165.200' },
            { label: 'Categoría líder', value: 'Supermercado · 40%' }
          ],
          transactionGroups: [
            {
              key: 'food-dining',
              name: 'Alimentación',
              emoji: '🍽️',
              cssClass: 'food-dining',
              totalAmount: '$367.220',
              categories: [
                { key: 'Supermarket', name: 'Supermercado', count: '52 compras', amount: '$209.840' },
                { key: 'Restaurant', name: 'Restaurantes', count: '36 compras', amount: '$157.380' }
              ]
            },
            {
              key: 'automotive',
              name: 'Automotriz',
              emoji: '⛽',
              cssClass: 'automotive',
              totalAmount: '$104.920',
              categories: [
                { key: 'GasStation', name: 'Bencinera', count: '25 compras', amount: '$68.200' },
                { key: 'Transport', name: 'Transporte', count: '20 compras', amount: '$36.720' }
              ]
            },
            {
              key: 'health-wellness',
              name: 'Salud y Bienestar',
              emoji: '💊',
              cssClass: 'health-wellness',
              totalAmount: '$52.460',
              categories: [
                { key: 'Pharmacy', name: 'Farmacia', count: '8 compras', amount: '$52.460' }
              ]
            }
          ],
          categories: [
            { icon: '🛒', name: 'Supermercado', count: '52 compras', amount: '$209.840', color: 'var(--primary-light)' },
            { icon: '🍔', name: 'Restaurantes', count: '36 compras', amount: '$157.380', color: '#fef3c7' },
            { icon: '🚗', name: 'Transporte', count: '45 compras', amount: '$104.920', color: '#dbeafe' },
            { icon: '💊', name: 'Salud', count: '8 compras', amount: '$52.460', color: '#fce7f3' }
          ]
        },
        Q3: {
          title: 'Q3',
          fullTitle: 'Q3 · 2025',
          amount: '$498.200',
          trend: '+8%',
          trendDirection: 'up',
          transactionCount: 126,
          persona: 'El verano trajo más gastos en Restaurantes. ¡Disfrutaste bien! Tu categoría de Transporte se mantuvo estable.',
          highlights: [
            { label: 'Mes más alto', value: 'Septiembre · $178.500' },
            { label: 'Mes más bajo', value: 'Julio · $156.200' },
            { label: 'Mayor aumento', value: 'Restaurantes · +22%' }
          ],
          transactionGroups: [
            {
              key: 'food-dining',
              name: 'Alimentación',
              emoji: '🍽️',
              cssClass: 'food-dining',
              totalAmount: '$357.900',
              categories: [
                { key: 'Supermarket', name: 'Supermercado', count: '48 compras', amount: '$189.500' },
                { key: 'Restaurant', name: 'Restaurantes', count: '42 compras', amount: '$168.400' }
              ]
            },
            {
              key: 'automotive',
              name: 'Automotriz',
              emoji: '⛽',
              cssClass: 'automotive',
              totalAmount: '$89.800',
              categories: [
                { key: 'GasStation', name: 'Bencinera', count: '22 compras', amount: '$58.200' },
                { key: 'Transport', name: 'Transporte', count: '16 compras', amount: '$31.600' }
              ]
            },
            {
              key: 'health-wellness',
              name: 'Salud y Bienestar',
              emoji: '💊',
              cssClass: 'health-wellness',
              totalAmount: '$50.500',
              categories: [
                { key: 'Pharmacy', name: 'Farmacia', count: '6 compras', amount: '$50.500' }
              ]
            }
          ],
          categories: [
            { icon: '🛒', name: 'Supermercado', count: '48 compras', amount: '$189.500', color: 'var(--primary-light)' },
            { icon: '🍔', name: 'Restaurantes', count: '42 compras', amount: '$168.400', color: '#fef3c7' },
            { icon: '🚗', name: 'Transporte', count: '38 compras', amount: '$89.800', color: '#dbeafe' },
            { icon: '💊', name: 'Salud', count: '6 compras', amount: '$50.500', color: '#fce7f3' }
          ]
        }
      },
      yearly: {
        2025: {
          title: '2025',
          fullTitle: '2025',
          amount: '$2.145.800',
          trend: null,
          trendDirection: null,
          transactionCount: 520,
          persona: 'Un año completo de decisiones inteligentes. Tu mayor inversión fue en bienestar y alimentación.',
          highlights: [
            { label: 'Mes más alto', value: 'Diciembre · $185.400' },
            { label: 'Mes más bajo', value: 'Febrero · $142.300' },
            { label: 'Categoría #1', value: 'Supermercado · 38%' }
          ],
          transactionGroups: [
            {
              key: 'food-dining',
              name: 'Alimentación',
              emoji: '🍽️',
              cssClass: 'food-dining',
              totalAmount: '$1.351.850',
              categories: [
                { key: 'Supermarket', name: 'Supermercado', count: '208 compras', amount: '$815.400' },
                { key: 'Restaurant', name: 'Restaurantes', count: '144 compras', amount: '$536.450' }
              ]
            },
            {
              key: 'automotive',
              name: 'Automotriz',
              emoji: '⛽',
              cssClass: 'automotive',
              totalAmount: '$429.160',
              categories: [
                { key: 'GasStation', name: 'Bencinera', count: '102 compras', amount: '$278.500' },
                { key: 'Transport', name: 'Transporte', count: '78 compras', amount: '$150.660' }
              ]
            },
            {
              key: 'health-wellness',
              name: 'Salud y Bienestar',
              emoji: '💊',
              cssClass: 'health-wellness',
              totalAmount: '$214.580',
              categories: [
                { key: 'Pharmacy', name: 'Farmacia', count: '32 compras', amount: '$214.580' }
              ]
            },
            {
              key: 'hospitality',
              name: 'Hospitalidad',
              emoji: '🏨',
              cssClass: 'hospitality',
              totalAmount: '$150.210',
              categories: [
                { key: 'Entertainment', name: 'Entretenimiento', count: '48 compras', amount: '$150.210' }
              ]
            }
          ],
          itemGroups: [
            {
              key: 'food-fresh',
              name: 'Alimentos Frescos',
              emoji: '🥬',
              cssClass: 'food-fresh',
              totalAmount: '$512.300',
              categories: [
                { key: 'Produce', name: 'Frutas y Verduras', count: '312 items', amount: '$148.400' },
                { key: 'Meat & Seafood', name: 'Carnes y Mariscos', count: '186 items', amount: '$264.100' },
                { key: 'Dairy & Eggs', name: 'Lácteos y Huevos', count: '224 items', amount: '$99.800' }
              ]
            },
            {
              key: 'food-packaged',
              name: 'Alimentos Envasados',
              emoji: '🥫',
              cssClass: 'food-packaged',
              totalAmount: '$382.500',
              categories: [
                { key: 'Pantry', name: 'Despensa', count: '156 items', amount: '$125.200' },
                { key: 'Beverages', name: 'Bebidas', count: '124 items', amount: '$82.100' },
                { key: 'Alcohol', name: 'Alcohol', count: '52 items', amount: '$175.200' }
              ]
            },
            {
              key: 'health-personal',
              name: 'Salud y Personal',
              emoji: '💄',
              cssClass: 'health-personal',
              totalAmount: '$214.580',
              categories: [
                { key: 'Pharmacy', name: 'Farmacia', count: '42 items', amount: '$142.200' },
                { key: 'Personal Care', name: 'Cuidado Personal', count: '36 items', amount: '$72.380' }
              ]
            },
            {
              key: 'household',
              name: 'Hogar',
              emoji: '🏠',
              cssClass: 'household',
              totalAmount: '$86.420',
              categories: [
                { key: 'Cleaning Supplies', name: 'Productos de Limpieza', count: '48 items', amount: '$52.100' },
                { key: 'Household', name: 'Hogar', count: '24 items', amount: '$34.320' }
              ]
            }
          ],
          userGroups: [
            {
              id: 'christmas-2025',
              name: '🎄 Navidad 2025',
              color: '#ef4444',
              totalAmount: '$125.400',
              transactionCount: 18
            },
            {
              id: 'summer-vacation',
              name: '☀️ Vacaciones de Verano',
              color: '#f59e0b',
              totalAmount: '$285.600',
              transactionCount: 32
            },
            {
              id: 'home-renovation',
              name: '🏠 Renovación Casa',
              color: '#10b981',
              totalAmount: '$342.100',
              transactionCount: 24
            }
          ],
          categories: [
            { icon: '🛒', name: 'Supermercado', count: '208 compras', amount: '$815.400', color: 'var(--primary-light)' },
            { icon: '🍔', name: 'Restaurantes', count: '144 compras', amount: '$536.450', color: '#fef3c7' },
            { icon: '🚗', name: 'Transporte', count: '180 compras', amount: '$429.160', color: '#dbeafe' },
            { icon: '💊', name: 'Salud', count: '32 compras', amount: '$214.580', color: '#fce7f3' },
            { icon: '🎬', name: 'Entretenimiento', count: '48 compras', amount: '$150.210', color: '#ede9fe' }
          ]
        }
      }
    };

    // Open report overlay with scrollable content
    function openReport(type, id) {
      const report = reportContent[type]?.[id];
      if (!report) {
        console.log('Report not found:', type, id);
        return;
      }

      // Mark the card as read
      event.currentTarget.classList.remove('unread');
      event.currentTarget.classList.add('read');

      // Set overlay title with full temporal context
      document.getElementById('overlayTitle').textContent = report.fullTitle || report.title;

      // Build content
      let html = '';

      // Hero card
      const periodLabel = type === 'weekly' ? 'de la semana' :
                          type === 'monthly' ? 'del mes' :
                          type === 'quarterly' ? 'del trimestre' : 'del año';

      html += `
        <div class="story-card hero">
          <div class="story-label">Total ${periodLabel}</div>
          <div class="story-amount">${report.amount}</div>
          ${report.trend ? `
            <div class="story-trend">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                <polyline points="${report.trendDirection === 'up' ? '18 15 12 9 6 15' : '6 9 12 15 18 9'}"/>
              </svg>
              ${report.trend} vs período anterior
            </div>
          ` : `<div class="story-subtitle">${report.isFirst ? 'Tu primer ' + (type === 'weekly' ? 'semana' : type === 'monthly' ? 'mes' : type === 'quarterly' ? 'trimestre' : 'año completo') : ''}</div>`}
        </div>
      `;

      // Persona insight (if exists)
      if (report.persona) {
        html += `
          <div class="story-card">
            <div class="story-label">💡 Insight personalizado</div>
            <div class="story-subtitle" style="font-size: 14px; color: var(--text-primary); margin-top: 8px;">${report.persona}</div>
          </div>
        `;
      }

      // Highlights (monthly, quarterly, yearly)
      if (report.highlights) {
        const highlightLabel = type === 'monthly' ? 'Highlights del mes' :
                               type === 'quarterly' ? 'Highlights del trimestre' : 'Highlights del año';
        html += `
          <div class="story-card">
            <div class="story-label">🏆 ${highlightLabel}</div>
            <div style="display: flex; flex-direction: column; gap: 12px; margin-top: 12px;">
              ${report.highlights.map(h => `
                <div style="display: flex; justify-content: space-between; align-items: center;">
                  <span style="font-size: 12px; color: var(--text-tertiary);">${h.label}</span>
                  <span style="font-size: 13px; font-weight: 600; color: var(--text-primary);">${h.value}</span>
                </div>
              `).join('')}
            </div>
          </div>
        `;
      }

      // ============================================
      // BREAKDOWN SECTION - 2026-01 Update
      // Non-interactive, progressive information by report type:
      // - Weekly: Transaction groups only (high-level summary)
      // - Monthly: Transaction groups + item groups
      // - Quarterly: Transaction groups + item groups + trends
      // - Yearly: Everything (all groups + user groups + detailed breakdown)
      // ============================================

      const hasTransactionGroups = report.transactionGroups && report.transactionGroups.length > 0;
      const hasItemGroups = report.itemGroups && report.itemGroups.length > 0;
      const hasUserGroups = report.userGroups && report.userGroups.length > 0;
      const hasLegacyCategories = report.categories && report.categories.length > 0;

      // Helper function to render a category group (non-interactive, always expanded)
      function renderCategoryGroup(group, isItemGroup = false) {
        return `
          <div class="category-group ${isItemGroup ? 'item-group ' : ''}${group.cssClass}">
            <div class="category-group-header">
              <div class="category-group-header-left">
                <span class="category-group-emoji">${group.emoji}</span>
                <span class="category-group-name">${group.name}</span>
              </div>
              <span class="category-group-amount">${group.totalAmount}</span>
            </div>
            <div class="category-group-items">
              ${group.categories.map(cat => `
                <div class="category-group-item">
                  <div class="category-group-item-icon">${CATEGORY_EMOJIS[cat.key] || '📦'}</div>
                  <div class="category-group-item-info">
                    <div class="category-group-item-name">${cat.name}</div>
                    <div class="category-group-item-count">${cat.count}</div>
                  </div>
                  <div class="category-group-item-amount">${cat.amount}</div>
                </div>
              `).join('')}
            </div>
          </div>
        `;
      }

      // Helper function to render user group (non-interactive, always expanded)
      function renderUserGroup(group) {
        return `
          <div class="user-group" style="--group-color: ${group.color};">
            <div class="category-group-header">
              <div class="category-group-header-left">
                <span class="category-group-name">${group.name}</span>
              </div>
              <span class="category-group-amount">${group.totalAmount}</span>
            </div>
            <div class="category-group-items">
              <div style="font-family: var(--font-family); font-size: 11px; color: var(--text-tertiary); padding: 4px 0;">
                ${group.transactionCount} transacciones
              </div>
              ${group.transactions ? group.transactions.map(tx => `
                <div class="category-group-item">
                  <div class="category-group-item-info">
                    <div class="category-group-item-name">${tx.merchant}</div>
                    <div class="category-group-item-count">${tx.date}</div>
                  </div>
                  <div class="category-group-item-amount">${tx.amount}</div>
                </div>
              `).join('') : ''}
            </div>
          </div>
        `;
      }

      // ============================================
      // WEEKLY REPORT: Transaction Groups only
      // ============================================
      if (type === 'weekly') {
        if (hasTransactionGroups) {
          html += `
            <div class="story-card">
              <div class="story-label">🏪 Gasto por tipo de tienda</div>
              <div style="margin-top: 12px;">
                ${report.transactionGroups.map(g => renderCategoryGroup(g, false)).join('')}
              </div>
            </div>
          `;
        } else if (hasLegacyCategories) {
          // Fallback for legacy data
          html += `
            <div class="story-card">
              <div class="story-label">📊 Desglose por categoría</div>
              <div class="story-categories" style="margin-top: 12px;">
                ${report.categories.map(cat => `
                  <div class="story-category-row">
                    <div class="story-category-icon" style="background: ${cat.color};">${cat.icon}</div>
                    <div class="story-category-info">
                      <div class="story-category-name">${cat.name}</div>
                      <div class="story-category-count">${cat.count}</div>
                    </div>
                    <div class="story-category-amount">${cat.amount}</div>
                  </div>
                `).join('')}
              </div>
            </div>
          `;
        }
      }

      // ============================================
      // MONTHLY REPORT: Transaction Groups + Item Groups
      // ============================================
      if (type === 'monthly') {
        // Transaction Groups Section
        if (hasTransactionGroups) {
          html += `
            <div class="story-card">
              <div class="story-label">🏪 Gasto por tipo de tienda</div>
              <div style="margin-top: 12px;">
                ${report.transactionGroups.map(g => renderCategoryGroup(g, false)).join('')}
              </div>
            </div>
          `;
        }

        // Item Groups Section (monthly adds this)
        if (hasItemGroups) {
          html += `
            <div class="story-card">
              <div class="story-label">📦 Gasto por tipo de producto</div>
              <div style="margin-top: 12px;">
                ${report.itemGroups.map(g => renderCategoryGroup(g, true)).join('')}
              </div>
            </div>
          `;
        }

        // Fallback for legacy
        if (!hasTransactionGroups && hasLegacyCategories) {
          html += `
            <div class="story-card">
              <div class="story-label">📊 Desglose por categoría</div>
              <div class="story-categories" style="margin-top: 12px;">
                ${report.categories.map(cat => `
                  <div class="story-category-row">
                    <div class="story-category-icon" style="background: ${cat.color};">${cat.icon}</div>
                    <div class="story-category-info">
                      <div class="story-category-name">${cat.name}</div>
                      <div class="story-category-count">${cat.count}</div>
                    </div>
                    <div class="story-category-amount">${cat.amount}</div>
                  </div>
                `).join('')}
              </div>
            </div>
          `;
        }
      }

      // ============================================
      // QUARTERLY REPORT: Transaction Groups + Item Groups + More detail
      // ============================================
      if (type === 'quarterly') {
        // Transaction Groups Section
        if (hasTransactionGroups) {
          html += `
            <div class="story-card">
              <div class="story-label">🏪 Gasto por tipo de tienda</div>
              <div style="margin-top: 12px;">
                ${report.transactionGroups.map(g => renderCategoryGroup(g, false)).join('')}
              </div>
            </div>
          `;
        }

        // Item Groups Section
        if (hasItemGroups) {
          html += `
            <div class="story-card">
              <div class="story-label">📦 Gasto por tipo de producto</div>
              <div style="margin-top: 12px;">
                ${report.itemGroups.map(g => renderCategoryGroup(g, true)).join('')}
              </div>
            </div>
          `;
        }

        // Fallback for legacy
        if (!hasTransactionGroups && hasLegacyCategories) {
          html += `
            <div class="story-card">
              <div class="story-label">📊 Desglose por categoría</div>
              <div class="story-categories" style="margin-top: 12px;">
                ${report.categories.map(cat => `
                  <div class="story-category-row">
                    <div class="story-category-icon" style="background: ${cat.color};">${cat.icon}</div>
                    <div class="story-category-info">
                      <div class="story-category-name">${cat.name}</div>
                      <div class="story-category-count">${cat.count}</div>
                    </div>
                    <div class="story-category-amount">${cat.amount}</div>
                  </div>
                `).join('')}
              </div>
            </div>
          `;
        }
      }

      // ============================================
      // YEARLY REPORT: Everything - All groups + User groups
      // ============================================
      if (type === 'yearly') {
        // Transaction Groups Section
        if (hasTransactionGroups) {
          html += `
            <div class="story-card">
              <div class="story-label">🏪 Gasto por tipo de tienda</div>
              <div style="margin-top: 12px;">
                ${report.transactionGroups.map(g => renderCategoryGroup(g, false)).join('')}
              </div>
            </div>
          `;
        }

        // Item Groups Section
        if (hasItemGroups) {
          html += `
            <div class="story-card">
              <div class="story-label">📦 Gasto por tipo de producto</div>
              <div style="margin-top: 12px;">
                ${report.itemGroups.map(g => renderCategoryGroup(g, true)).join('')}
              </div>
            </div>
          `;
        }

        // User-Defined Groups Section (yearly exclusive)
        if (hasUserGroups) {
          html += `
            <div class="story-card">
              <div class="story-label">📁 Mis grupos personalizados</div>
              <div style="margin-top: 12px;">
                ${report.userGroups.map(g => renderUserGroup(g)).join('')}
              </div>
            </div>
          `;
        }

        // Fallback for legacy
        if (!hasTransactionGroups && hasLegacyCategories) {
          html += `
            <div class="story-card">
              <div class="story-label">📊 Desglose por categoría</div>
              <div class="story-categories" style="margin-top: 12px;">
                ${report.categories.map(cat => `
                  <div class="story-category-row">
                    <div class="story-category-icon" style="background: ${cat.color};">${cat.icon}</div>
                    <div class="story-category-info">
                      <div class="story-category-name">${cat.name}</div>
                      <div class="story-category-count">${cat.count}</div>
                    </div>
                    <div class="story-category-amount">${cat.amount}</div>
                  </div>
                `).join('')}
              </div>
            </div>
          `;
        }
      }

      document.getElementById('reportContentScroll').innerHTML = html;

      // Show overlay
      document.getElementById('reportOverlay').classList.add('active');
    }

    // Close report overlay
    function closeReport() {
      document.getElementById('reportOverlay').classList.remove('active');
    }

    // Theme switcher
    function setTheme(theme, el) {
      document.body.setAttribute('data-theme', theme);
      document.querySelectorAll('.theme-swatch').forEach(s => s.classList.remove('active'));
      el.classList.add('active');
    }

    // Font switcher
    function setFont(font, el) {
      document.body.setAttribute('data-font', font);
      document.querySelectorAll('.font-pill').forEach(p => p.classList.remove('active'));
      el.classList.add('active');
    }

    // Dark mode toggle
    function toggleDarkMode(el) {
      const currentMode = document.body.getAttribute('data-mode') || 'light';
      const newMode = currentMode === 'light' ? 'dark' : 'light';
      document.body.setAttribute('data-mode', newMode);
      el.classList.toggle('active', newMode === 'dark');
    }
  </script>
</body>
</html>
